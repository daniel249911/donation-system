<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×—×™×¤×•×© ×ª×•×¨××™× - ×˜×œ×¤×Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --border-color: #dee2e6;
            --text-muted: #6c757d;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            direction: rtl;
            transition: all 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: #ecf0f1;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        /* Header */
        .header { 
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .dark-mode .header {
            background: #34495e;
            color: #ecf0f1;
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dark-mode .header h1 {
            color: #3498db;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .user-welcome {
            background: var(--light-bg);
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        .dark-mode .user-welcome {
            background: #2c3e50;
            color: #3498db;
            border-color: #3498db;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .btn-sm { padding: 8px 15px; font-size: 12px; }
        .btn-danger { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .btn-warning { background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); color: #212529; }
        .btn-info { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); }
        .btn-secondary { background: linear-gradient(135deg, #6c757d 0%, #545b62 100%); }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .dark-mode .card {
            background: #34495e;
            color: #ecf0f1;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        /* Search Section */
        .search-section {
            text-align: center;
            padding: 40px 25px;
        }
        
        .search-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 32px;
        }
        
        .dark-mode .search-section h2 {
            color: #3498db;
        }
        
        .search-description {
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .search-container {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 20px 25px;
            border: 3px solid var(--primary-color);
            border-radius: 50px;
            font-size: 18px;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }
        
        .dark-mode .search-input {
            background: #2c3e50;
            color: #ecf0f1;
        }
        
        .search-input:focus {
            outline: none;
            transform: scale(1.02);
            box-shadow: 0 0 0 5px rgba(102, 126, 234, 0.2);
        }
        
        .search-input.error {
            border-color: var(--danger-color);
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .char-counter {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
        }
        
        .char-counter.warning {
            color: var(--warning-color);
            font-weight: bold;
        }
        
        /* Recent Searches */
        .recent-searches {
            margin-top: 25px;
            padding: 20px;
            background: var(--light-bg);
            border-radius: 12px;
        }
        
        .dark-mode .recent-searches {
            background: #2c3e50;
        }
        
        .recent-searches h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .recent-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .dark-mode .recent-item {
            background: #34495e;
            border-color: #4a5568;
            color: #ecf0f1;
        }
        
        .recent-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Results */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .results-count {
            font-size: 18px;
            font-weight: 600;
            color: var(--success-color);
        }
        
        .donor-card {
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            background: var(--light-bg);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .dark-mode .donor-card {
            background: #2c3e50;
            border-color: #34495e;
        }
        
        .donor-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .donor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .donor-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .dark-mode .donor-title {
            color: #3498db;
        }
        
        .donor-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .donor-field {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            gap: 15px;
        }
        
        .donor-field:last-child {
            border-bottom: none;
        }
        
        .field-icon {
            font-size: 18px;
            width: 25px;
            text-align: center;
        }
        
        .field-label {
            font-weight: 600;
            color: var(--primary-color);
            min-width: 100px;
            font-size: 14px;
        }
        
        .dark-mode .field-label {
            color: #3498db;
        }
        
.field-value {
           flex: 1;
           padding: 10px 15px;
           background: white;
           border: 1px solid var(--border-color);
           border-radius: 8px;
           font-family: 'Courier New', monospace;
           font-size: 14px;
           transition: all 0.3s ease;
       }
       
       .dark-mode .field-value {
           background: #34495e;
           border-color: #4a5568;
           color: #ecf0f1;
       }
       
       .field-value:hover {
           border-color: var(--primary-color);
       }
       
       .copy-feedback {
           position: absolute;
           top: -30px;
           right: 0;
           background: var(--success-color);
           color: white;
           padding: 5px 10px;
           border-radius: 5px;
           font-size: 12px;
           opacity: 0;
           animation: copyFeedback 2s;
       }
       
       @keyframes copyFeedback {
           0% { opacity: 0; transform: translateY(10px); }
           50% { opacity: 1; transform: translateY(0); }
           100% { opacity: 0; transform: translateY(-10px); }
       }
       
       /* Notes Section */
       .notes-section {
           margin-top: 15px;
           padding: 15px;
           background: #fff3cd;
           border-radius: 8px;
           border-right: 4px solid var(--warning-color);
       }
       
       .dark-mode .notes-section {
           background: #3d4043;
       }
       
       .notes-header {
           font-weight: 600;
           color: #856404;
           margin-bottom: 10px;
           display: flex;
           align-items: center;
           gap: 8px;
       }
       
       .notes-content {
           color: #856404;
           font-size: 14px;
           line-height: 1.5;
       }
       
       /* Stats Cards */
       .stats-grid {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
           gap: 20px;
           margin-bottom: 30px;
       }
       
       .stat-card {
           background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
           color: white;
           padding: 25px;
           border-radius: 15px;
           text-align: center;
           transition: all 0.3s ease;
           position: relative;
           overflow: hidden;
       }
       
       .stat-card::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           right: 0;
           bottom: 0;
           background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
           transform: translateX(-100%);
           transition: transform 0.6s;
       }
       
       .stat-card:hover::before {
           transform: translateX(100%);
       }
       
       .stat-card:hover {
           transform: translateY(-5px);
       }
       
       .stat-number {
           font-size: 36px;
           font-weight: 700;
           margin-bottom: 10px;
           display: block;
       }
       
       .stat-label {
           font-size: 14px;
           opacity: 0.9;
       }
       
       /* Navigation Tabs */
       .nav-tabs {
           display: flex;
           gap: 5px;
           margin-bottom: 30px;
           background: white;
           padding: 10px;
           border-radius: 15px;
           box-shadow: 0 4px 20px rgba(0,0,0,0.1);
           overflow-x: auto;
       }
       
       .dark-mode .nav-tabs {
           background: #34495e;
       }
       
       .nav-tab {
           padding: 15px 25px;
           border-radius: 10px;
           cursor: pointer;
           transition: all 0.3s ease;
           white-space: nowrap;
           font-weight: 500;
           color: #666;
           display: flex;
           align-items: center;
           gap: 8px;
       }
       
       .nav-tab:hover {
           background: var(--light-bg);
           color: var(--primary-color);
       }
       
       .nav-tab.active {
           background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
           color: white;
       }
       
       .dark-mode .nav-tab {
           color: #bdc3c7;
       }
       
       .dark-mode .nav-tab:hover {
           background: #2c3e50;
           color: #3498db;
       }
       
       /* Table Styles */
       .table-container {
           overflow-x: auto;
           border-radius: 10px;
           background: white;
       }
       
       .dark-mode .table-container {
           background: #34495e;
       }
       
       .table {
           width: 100%;
           border-collapse: collapse;
       }
       
       .table th,
       .table td {
           padding: 15px;
           text-align: right;
           border-bottom: 1px solid var(--border-color);
       }
       
       .table th {
           background: var(--light-bg);
           font-weight: 600;
           color: var(--primary-color);
           position: sticky;
           top: 0;
       }
       
       .dark-mode .table th {
           background: #2c3e50;
           color: #3498db;
       }
       
       .table tbody tr:hover {
           background: var(--light-bg);
       }
       
       .dark-mode .table tbody tr:hover {
           background: #2c3e50;
       }
       
       /* Messages */
       .message {
           padding: 15px 20px;
           border-radius: 10px;
           margin-bottom: 15px;
           border-right: 5px solid;
           display: flex;
           align-items: center;
           gap: 15px;
           animation: slideIn 0.3s ease;
       }
       
       @keyframes slideIn {
           from { opacity: 0; transform: translateY(-20px); }
           to { opacity: 1; transform: translateY(0); }
       }
       
       .message.success {
           background: #d4edda;
           color: #155724;
           border-color: var(--success-color);
       }
       
       .message.error {
           background: #f8d7da;
           color: #721c24;
           border-color: var(--danger-color);
       }
       
       .message.warning {
           background: #fff3cd;
           color: #856404;
           border-color: var(--warning-color);
       }
       
       .message.info {
           background: #d1ecf1;
           color: #0c5460;
           border-color: var(--info-color);
       }
       
       /* Modal */
       .modal {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.7);
           z-index: 1000;
           justify-content: center;
           align-items: center;
           backdrop-filter: blur(5px);
       }
       
       .modal.show {
           display: flex;
       }
       
       .modal-content {
           background: white;
           border-radius: 15px;
           padding: 30px;
           max-width: 600px;
           width: 90%;
           max-height: 90vh;
           overflow-y: auto;
           position: relative;
           animation: modalSlide 0.3s ease;
       }
       
       @keyframes modalSlide {
           from { opacity: 0; transform: scale(0.8); }
           to { opacity: 1; transform: scale(1); }
       }
       
       .dark-mode .modal-content {
           background: #34495e;
       }
       
       .modal-header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 25px;
           padding-bottom: 15px;
           border-bottom: 2px solid var(--border-color);
       }
       
       .modal-close {
           background: none;
           border: none;
           font-size: 24px;
           cursor: pointer;
           color: #999;
           transition: all 0.3s ease;
       }
       
       .modal-close:hover {
           color: var(--danger-color);
           transform: scale(1.2);
       }
       
       /* Form Controls */
       .form-group {
           margin-bottom: 20px;
       }
       
       .form-group label {
           display: block;
           margin-bottom: 8px;
           font-weight: 600;
           color: #555;
       }
       
       .dark-mode .form-group label {
           color: #bdc3c7;
       }
       
       .form-control {
           width: 100%;
           padding: 12px 15px;
           border: 2px solid var(--border-color);
           border-radius: 8px;
           font-size: 14px;
           transition: all 0.3s ease;
           background: white;
       }
       
       .dark-mode .form-control {
           background: #2c3e50;
           border-color: #34495e;
           color: #ecf0f1;
       }
       
       .form-control:focus {
           outline: none;
           border-color: var(--primary-color);
           box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
       }
       
       /* Loading States */
       .loading {
           text-align: center;
           padding: 40px;
           color: var(--text-muted);
       }
       
       .loading-spinner {
           display: inline-block;
           width: 40px;
           height: 40px;
           border: 4px solid #f3f3f3;
           border-top: 4px solid var(--primary-color);
           border-radius: 50%;
           animation: spin 1s linear infinite;
           margin-bottom: 15px;
       }
       
       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
       
       /* Empty States */
       .empty-state {
           text-align: center;
           padding: 60px 20px;
           color: var(--text-muted);
       }
       
       .empty-state-icon {
           font-size: 64px;
           margin-bottom: 20px;
           opacity: 0.5;
       }
       
       .empty-state h3 {
           margin-bottom: 10px;
           color: var(--text-muted);
       }
       
       /* Utility Classes */
       .hidden { display: none !important; }
       .text-center { text-align: center; }
       .text-muted { color: var(--text-muted); }
       .mb-0 { margin-bottom: 0; }
       .mb-10 { margin-bottom: 10px; }
       .mb-20 { margin-bottom: 20px; }
       .mt-20 { margin-top: 20px; }
       .p-20 { padding: 20px; }
       
       /* Dark Mode Toggle */
       .dark-mode-toggle {
           background: var(--primary-color);
           color: white;
           border: none;
           border-radius: 50px;
           padding: 10px 15px;
           cursor: pointer;
           font-size: 14px;
           transition: all 0.3s ease;
       }
       
       .dark-mode-toggle:hover {
           background: var(--secondary-color);
           transform: scale(1.05);
       }
       
       /* Responsive */
       @media (max-width: 768px) {
           .container { padding: 15px; }
           .header { flex-direction: column; text-align: center; }
           .header-controls { width: 100%; justify-content: center; }
           .search-container { flex-direction: column; }
           .search-input { min-width: auto; }
           .donor-field { flex-direction: column; align-items: stretch; gap: 10px; }
           .field-label { min-width: auto; }
           .stats-grid { grid-template-columns: 1fr; }
           .nav-tabs { flex-direction: column; }
           .modal-content { width: 95%; padding: 20px; }
           .results-header { flex-direction: column; align-items: stretch; }
           .donor-header { flex-direction: column; align-items: stretch; }
           .donor-actions { justify-content: center; }
       }
       
       @media (max-width: 480px) {
           .header h1 { font-size: 24px; }
           .search-section h2 { font-size: 28px; }
           .search-input { font-size: 16px; padding: 15px 20px; }
           .stat-number { font-size: 28px; }
       }
	   
	   @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

@keyframes newResponse {
    0% { box-shadow: 0 0 15px rgba(76, 175, 80, 0.3); }
    50% { box-shadow: 0 0 25px rgba(76, 175, 80, 0.6); }
    100% { box-shadow: 0 0 15px rgba(76, 175, 80, 0.3); }
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4444;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    animation: pulse 1.5s infinite;
}

/* ×¡×’× ×•× ×•×ª ×œ×˜××‘ ×”×ª×¨××” */
.donation-types-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
   gap: 20px;
   margin-top: 20px;
}

.donation-type-card {
   background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
   border: 2px solid var(--border-color);
   border-radius: 15px;
   padding: 25px;
   text-align: center;
   transition: all 0.3s ease;
   cursor: pointer;
   position: relative;
   overflow: hidden;
}

.donation-type-card::before {
   content: '';
   position: absolute;
   top: 0;
   left: -100%;
   width: 100%;
   height: 100%;
   background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
   transition: left 0.6s;
}

.donation-type-card:hover::before {
   left: 100%;
}

.donation-type-card:hover {
   transform: translateY(-5px);
   border-color: var(--primary-color);
   box-shadow: 0 15px 40px rgba(0,0,0,0.15);
   background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
   color: white;
}

.dark-mode .donation-type-card {
   background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
   color: #ecf0f1;
}

.dark-mode .donation-type-card:hover {
   background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
}

.donation-type-icon {
   font-size: 48px;
   margin-bottom: 15px;
   display: block;
   filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}

.donation-type-title {
   font-size: 18px;
   font-weight: 700;
   margin-bottom: 10px;
   color: var(--primary-color);
}

.donation-type-card:hover .donation-type-title {
   color: white;
}

.donation-type-description {
   font-size: 14px;
   color: var(--text-muted);
   line-height: 1.5;
}

.donation-type-card:hover .donation-type-description {
   color: rgba(255,255,255,0.9);
}

.donation-page-header {
   background: var(--light-bg);
   padding: 20px;
   border-radius: 12px;
   margin-bottom: 20px;
   border: 1px solid var(--border-color);
}

.dark-mode .donation-page-header {
   background: #2c3e50;
}

.donation-iframe-container {
   position: relative;
   background: white;
   border-radius: 12px;
   box-shadow: var(--shadow-lg);
   overflow: hidden;
   margin-bottom: 20px;
}

.donation-info-panel {
   background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
   padding: 20px;
   border-radius: 12px;
   border-right: 4px solid var(--info-color);
   margin-top: 20px;
}

.dark-mode .donation-info-panel {
   background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
}

.donation-stats {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
   gap: 15px;
   margin-top: 20px;
}

.donation-stat-item {
   text-align: center;
   padding: 15px;
   background: white;
   border-radius: 10px;
   border: 1px solid var(--border-color);
   transition: all 0.3s ease;
}

.dark-mode .donation-stat-item {
   background: #34495e;
   border-color: #4a5568;
}

.donation-stat-item:hover {
   transform: translateY(-2px);
   box-shadow: var(--shadow-md);
}

.donation-stat-number {
   font-size: 24px;
   font-weight: 700;
   color: var(--primary-color);
   display: block;
   margin-bottom: 5px;
}

.donation-stat-label {
   font-size: 12px;
   color: var(--text-muted);
   text-transform: uppercase;
   letter-spacing: 0.5px;
}

/* ×”×•×¡×£ ××ª ×”×¡×’× ×•× ×•×ª ×”××œ×” ×œ×ª×•×š ×ª×’ <style> ×”×§×™×™× */

/* ×¤×¨×™×¡×” ××¤×•×¦×œ×ª ××¢×•×“×›× ×ª */
.donation-split-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-top: 20px;
}

/* ×¦×“ ×”×—×™×¤×•×© - ×¢×™×¦×•×‘ ××•×“×¨× ×™ */
.donation-search-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafb 100%);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
    max-height: 700px;
    overflow-y: auto;
}

.dark-mode .donation-search-section {
    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
    border-color: #4a5568;
}

.search-header {
    text-align: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #e2e8f0;
}

.dark-mode .search-header {
    border-bottom-color: #4a5568;
}

.search-header h4 {
    color: #2d3748;
    margin: 0 0 8px 0;
    font-size: 20px;
    font-weight: 700;
}

.dark-mode .search-header h4 {
    color: #e2e8f0;
}

.search-subtitle {
    color: #718096;
    margin: 0;
    font-size: 14px;
    font-weight: 500;
}

.dark-mode .search-subtitle {
    color: #a0aec0;
}

.donation-search-container {
    margin-bottom: 24px;
}

.search-input-wrapper {
    position: relative;
    margin-bottom: 12px;
}

.donation-search-input {
    width: 100%;
    padding: 16px 50px 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    background: white;
    transition: all 0.3s ease;
    color: #2d3748;
}

.dark-mode .donation-search-input {
    background: #1a202c;
    border-color: #4a5568;
    color: #e2e8f0;
}

.donation-search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-1px);
}

.donation-search-input::placeholder {
    color: #a0aec0;
}

.search-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #a0aec0;
    font-size: 18px;
}

.donation-char-counter {
    font-size: 12px;
    color: #718096;
    text-align: center;
    font-weight: 500;
}

.donation-char-counter.warning {
    color: #f56565;
    font-weight: 600;
}

/* ×ª×•×¦××•×ª ×—×™×¤×•×© ××•×“×¨× ×™×•×ª */
.search-results {
    margin-top: 20px;
}

.results-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.donation-donor-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.dark-mode .donation-donor-card {
    background: #1a202c;
    border-color: #4a5568;
}

.donation-donor-card:hover {
    border-color: #667eea;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    transform: translateY(-2px);
}

.donation-donor-summary {
    padding: 16px 20px;
    cursor: pointer;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    border-bottom: 1px solid #e2e8f0;
    transition: all 0.3s ease;
}

.dark-mode .donation-donor-summary {
    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
    border-bottom-color: #4a5568;
}

.donation-donor-summary:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.donor-summary-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.donor-info {
    flex: 1;
}

.donor-name {
    font-size: 16px;
    font-weight: 700;
    margin: 0 0 6px 0;
    color: #2d3748;
    display: flex;
    align-items: center;
    gap: 10px;
}

.dark-mode .donor-name {
    color: #e2e8f0;
}

.donation-donor-summary:hover .donor-name {
    color: white;
}

.donor-number {
    background: #667eea;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
}

.donor-meta {
    font-size: 13px;
    color: #718096;
    margin: 0;
}

.dark-mode .donor-meta {
    color: #a0aec0;
}

.donation-donor-summary:hover .donor-meta {
    color: rgba(255, 255, 255, 0.9);
}

.expand-icon-donation {
    font-size: 20px;
    color: #a0aec0;
    transition: transform 0.3s ease;
}

.donation-donor-summary:hover .expand-icon-donation {
    color: white;
}

.donation-donor-details {
    display: none;
    padding: 20px;
    background: #fafafa;
}

.dark-mode .donation-donor-details {
    background: #1a1a1a;
}

.donation-donor-field {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #e2e8f0;
    gap: 16px;
}

.dark-mode .donation-donor-field {
    border-bottom-color: #4a5568;
}

.donation-donor-field:last-child {
    border-bottom: none;
}

.donation-field-icon {
    font-size: 16px;
    color: #667eea;
    width: 20px;
    text-align: center;
}

.donation-field-label {
    font-weight: 600;
    color: #4a5568;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.dark-mode .donation-field-label {
    color: #a0aec0;
}

.donation-field-value {
    padding: 8px 12px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    font-family: 'Inter', system-ui, sans-serif;
    font-size: 14px;
    color: #2d3748;
    min-width: 0;
}

.dark-mode .donation-field-value {
    background: #2d3748;
    border-color: #4a5568;
    color: #e2e8f0;
}

.donation-actions {
    display: flex;
    gap: 8px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid #e2e8f0;
    justify-content: center;
}

.dark-mode .donation-actions {
    border-top-color: #4a5568;
}

/* ×¦×“ ×”-iframe - ×¢×™×¦×•×‘ ××•×“×¨× ×™ */
.donation-iframe-section {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
}

.dark-mode .donation-iframe-section {
    background: #1a202c;
    border-color: #4a5568;
}

.iframe-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    border-bottom: 1px solid #e2e8f0;
}

.dark-mode .iframe-header {
    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
    border-bottom-color: #4a5568;
}

.iframe-header h4 {
    margin: 0;
    color: #2d3748;
    font-size: 18px;
    font-weight: 700;
}

.dark-mode .iframe-header h4 {
    color: #e2e8f0;
}

.iframe-controls {
    display: flex;
    gap: 8px;
}

.control-btn {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 16px;
    color: #4a5568;
}

.dark-mode .control-btn {
    background: #2d3748;
    border-color: #4a5568;
    color: #a0aec0;
}

.control-btn:hover {
    background: #667eea;
    border-color: #667eea;
    color: white;
    transform: scale(1.05);
}

.donation-iframe-container {
    padding: 16px;
}

/* ×¡×¤×™× ×¨ ××•×“×¨× ×™ */
.modern-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #e2e8f0;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: modernSpin 1s linear infinite;
    margin: 0 auto 16px;
}

@keyframes modernSpin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.donation-loading {
    text-align: center;
    padding: 40px 20px;
    color: #718096;
}

.empty-results {
    text-align: center;
    padding: 40px 20px;
    color: #718096;
}

.empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.6;
}

.empty-results h5 {
    margin: 0 0 8px 0;
    color: #4a5568;
    font-size: 16px;
}

.dark-mode .empty-results h5 {
    color: #a0aec0;
}

.empty-results p {
    margin: 0;
    font-size: 14px;
}

/* ×¨×¡×¤×•× ×¡×™×‘×™×•×ª */
@media (max-width: 1024px) {
    .donation-split-layout {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .donation-iframe-section iframe {
        height: 500px !important;
    }
    
    .donation-search-section {
        max-height: 500px;
    }
}

@media (max-width: 768px) {
    .donation-search-section {
        padding: 16px;
        max-height: 400px;
    }
    
    .donation-donor-field {
        grid-template-columns: 1fr;
        gap: 8px;
        text-align: center;
    }
    
    .donation-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .iframe-header {
        padding: 12px 16px;
    }
    
    .donation-iframe-container {
        padding: 12px;
    }
}

/* ×× ×™××¦×™×•×ª ×˜×¢×™× ×” */
.donation-loading {
text-align: center;
   padding: 60px 20px;
   color: var(--text-muted);
}

.donation-loading-spinner {
   display: inline-block;
   width: 50px;
   height: 50px;
   border: 4px solid var(--border-color);
   border-top: 4px solid var(--primary-color);
   border-radius: 50%;
   animation: spin 1s linear infinite;
   margin-bottom: 20px;
}

/* Empty state */
.donation-empty-state {
   text-align: center;
   padding: 80px 20px;
   color: var(--text-muted);
}

.donation-empty-icon {
   font-size: 80px;
   margin-bottom: 24px;
   opacity: 0.6;
}

/* ×”×•×“×¢×•×ª ×¡×˜×˜×•×¡ */
.donation-status-active {
   background: #d4edda;
   color: #155724;
   padding: 8px 15px;
   border-radius: 20px;
   font-size: 12px;
   font-weight: 600;
   display: inline-block;
   margin-top: 10px;
}

.donation-status-inactive {
   background: #f8d7da;
   color: #721c24;
   padding: 8px 15px;
   border-radius: 20px;
   font-size: 12px;
   font-weight: 600;
   display: inline-block;
   margin-top: 10px;
}

/* ×¨×¡×¤×•× ×¡×™×‘×™×•×ª */
@media (max-width: 768px) {
   .donation-types-grid {
       grid-template-columns: 1fr;
   }
   
   .donation-page-header > div {
       flex-direction: column;
       gap: 15px;
       align-items: stretch;
   }
   
   #donationIframe {
       height: 600px;
   }
   
   .donation-stats {
       grid-template-columns: repeat(2, 1fr);
   }
}

@media (max-width: 480px) {
   .donation-type-card {
       padding: 20px;
   }
   
   .donation-type-icon {
       font-size: 36px;
   }
   
   .donation-type-title {
       font-size: 16px;
   }
   
   #donationIframe {
       height: 500px;
   }
   
   .donation-stats {
       grid-template-columns: 1fr;
   }
}
   </style>
</head>
<body>
   <!-- ×›×•×ª×¨×ª -->
   <div class="container">
       <div class="header">
           <h1>
               <span>ğŸ”</span>
               ××¢×¨×›×ª ×—×™×¤×•×© ×ª×•×¨××™×
           </h1>
           <div class="header-controls">
               <div class="user-welcome" id="userWelcome">
                   ×©×œ×•× ××©×ª××©
               </div>
               <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                   ğŸŒ™ ××¦×‘ ×œ×™×œ×”
               </button>
               <button class="btn btn-info btn-sm" onclick="showMyTickets()">
                   ğŸ« ×”×ª××™×›×” ×©×œ×™
               </button>
               <button class="btn btn-warning btn-sm" onclick="showMessages()">
                   ğŸ’¬ ×”×•×“×¢×•×ª
               </button>
               <button class="btn btn-danger" onclick="logout()">
                   ğŸšª ×”×ª× ×ª×§
               </button>
           </div>
       </div>

       <!-- ×”×•×“×¢×•×ª ××¢×¨×›×ª -->
       <div id="systemMessages"></div>

       <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
       <div class="stats-grid">
           <div class="stat-card">
               <span class="stat-number" id="totalSearches">0</span>
               <span class="stat-label">×”×—×™×¤×•×©×™× ×©×œ×™ ×”×™×•×</span>
           </div>
           <div class="stat-card">
               <span class="stat-number" id="totalResults">0</span>
               <span class="stat-label">×ª×•×¦××•×ª ×©××¦××ª×™</span>
           </div>
       </div>

      <!-- × ×™×•×•×˜ -->
      <div class="nav-tabs">
          <div class="nav-tab active" onclick="showTab('search')">
              ğŸ” ×—×™×¤×•×© ×ª×•×¨××™×
          </div>
          <div class="nav-tab" onclick="showTab('donations')">
              ğŸ’³ ×”×ª×¨××”
          </div>
          <div class="nav-tab" onclick="showTab('history')">
              ğŸ“Š ×”×”×™×¡×˜×•×¨×™×” ×©×œ×™
          </div>
          <div class="nav-tab" onclick="showTab('notes')">
              ğŸ“ ×”×”×¢×¨×•×ª ×©×œ×™
          </div>
      </div>

       <!-- ×ª×•×›×Ÿ ×”×œ×©×•× ×™×•×ª -->
       
       <!-- ×œ×©×•× ×™×ª ×—×™×¤×•×© -->
       <div id="searchTab" class="tab-content">
           <div class="card search-section">
               <h2>ğŸ” ×—×™×¤×•×© ×ª×•×¨×</h2>
               <p class="search-description">
                   ×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ×—×™×¤×•×© (× ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™×)
               </p>
               
               <div class="search-container">
                   <input type="text" 
                          id="phoneSearch" 
                          class="search-input" 
                          placeholder="×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ..." 
                          onkeypress="handleEnterKey(event)"
                          oninput="handleSearchInput(this)"
                          minlength="7"
                          maxlength="15">
                   
                   <button class="btn" onclick="searchDonor()">
                       ğŸ” ×—×¤×©
                   </button>
                   
                   <button class="btn btn-secondary" onclick="clearSearch()">
                       ğŸ—‘ï¸ × ×§×”
                   </button>
               </div>
               
               <div class="char-counter" id="charCounter">
                   × ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™×
               </div>
               
               <!-- ×—×™×¤×•×©×™× ××—×¨×•× ×™× -->
               <div id="recentSearches" class="recent-searches hidden">
                   <h4>ğŸ•’ ×—×™×¤×•×©×™× ××—×¨×•× ×™×:</h4>
                   <div id="recentSearchesList"></div>
               </div>
           </div>
           
           <!-- ×ª×•×¦××•×ª ×—×™×¤×•×© -->
           <div id="resultsContainer" class="hidden">
               <div id="loadingMessage" class="card loading hidden">
                   <div class="loading-spinner"></div>
                   <p>××—×¤×© ×‘×™×Ÿ ×ª×•×¨××™×...</p>
               </div>
               
               <div id="noResults" class="card empty-state hidden">
                   <div class="empty-state-icon">âŒ</div>
                   <h3>×œ× × ××¦××• ×ª×•×¦××•×ª</h3>
                   <p>× ×¡×” ×œ×—×¤×© ×¢× ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ××—×¨ ××• ×‘×“×•×§ ×©×”××¡×¤×¨ × ×›×•×Ÿ</p>
               </div>
               
               <div id="searchResults">
                   <div class="results-header hidden" id="resultsHeader">
                       <div class="results-count" id="resultsCount">
                           × ××¦××• 0 ×ª×•×¦××•×ª
                       </div>
                       <div>
                           <button class="btn btn-info btn-sm" onclick="exportResults()">
                               ğŸ“‹ ×”×¢×ª×§ ×”×›×œ
                           </button>
                       </div>
                   </div>
                   <div id="resultsData"></div>
               </div>
           </div>
       </div>

      <!-- ×˜××‘ ×”×ª×¨××” -->
<!-- ×˜××‘ ×”×ª×¨××” -->
<div id="donationsTab" class="tab-content hidden">
    <div class="card">
        <h2>ğŸ’³ ××¢×¨×›×ª ×”×ª×¨××”</h2>
        <p class="search-description">×‘×—×¨ ×¡×•×’ ×ª×¨×•××” ×›×“×™ ×œ×”×ª×—×™×œ ×ª×”×œ×™×š ×—×™×•×‘</p>
        
        <!-- ×¨×©×™××ª ×¡×•×’×™ ×ª×¨×•××•×ª -->
        <div id="donationTypesContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                ×˜×•×¢×Ÿ ×¡×•×’×™ ×ª×¨×•××•×ª...
            </div>
        </div>
        
        <div id="donationTypesList" class="hidden">
            <div class="donation-types-grid" id="donationTypesGrid">
                <!-- ×›××Ÿ ×™×•×¦×’×• ×¡×•×’×™ ×”×ª×¨×•××•×ª -->
            </div>
        </div>
        
        <!-- ××–×•×¨ ×ª×¦×•×’×ª ×“×£ ×”×ª×¨××” ×¢× ×—×™×¤×•×© -->
        <div id="donationPageContainer" class="hidden">
            <div class="donation-page-header">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="selectedDonationTitle">×“×£ ×”×ª×¨××”</h3>
                    <div>
                        <button class="btn btn-secondary btn-sm" onclick="closeDonationPage()">
                            ğŸ”™ ×—×–×•×¨ ×œ×¨×©×™××”
                        </button>
                        <button class="btn btn-info btn-sm" onclick="refreshDonationPage()">
                            ğŸ”„ ×¨×¢× ×Ÿ ×“×£
                        </button>
                    </div>
                </div>
                <div class="message info" style="margin-bottom: 20px;">
                    <span>ğŸ’¡ ×—×¤×© ×ª×•×¨× ×‘×¦×“ ×©×××œ ×•×”×¢×ª×§ ××ª ×”×¤×¨×˜×™× ×”× ×“×¨×©×™× ×œ×“×£ ×”×”×ª×¨××”.</span>
                </div>
            </div>
            
            <!-- ×¤×¨×™×¡×” ××¤×•×¦×œ×ª -->
            <div class="donation-split-layout">
                <!-- ×¦×“ ×©×××œ - ×—×™×¤×•×© ×ª×•×¨××™× -->
                <div class="donation-search-section">
                    <div class="donation-search-card">
                        <div class="search-header">
                            <h4>ğŸ” ×—×™×¤×•×© ×ª×•×¨×</h4>
                            <p class="search-subtitle">××¦× ×¤×¨×˜×™ ×ª×•×¨× ×œ×¦×•×¨×š ××™×œ×•×™</p>
                        </div>
                        
                        <div class="donation-search-container">
                            <div class="search-input-wrapper">
                                <input type="text" 
                                       id="donationPhoneSearch" 
                                       class="donation-search-input" 
                                       placeholder="ğŸ“ ×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ..." 
                                       oninput="handleDonationSearchInput(this)"
                                       minlength="7"
                                       maxlength="15">
                                <div class="search-icon">ğŸ”</div>
                            </div>
                            
                            <div class="donation-char-counter" id="donationCharCounter">
                                × ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™×
                            </div>
                        </div>
                        
                        <!-- ×ª×•×¦××•×ª ×”×—×™×¤×•×© -->
                        <div id="donationSearchResults" class="search-results hidden">
                            <div id="donationLoadingMessage" class="donation-loading hidden">
                                <div class="modern-spinner"></div>
                                <p>××—×¤×© ×ª×•×¨××™×...</p>
                            </div>
                            
                            <div id="donationNoResults" class="empty-results hidden">
                                <div class="empty-icon">ğŸ”</div>
                                <h5>×œ× × ××¦××• ×ª×•×¦××•×ª</h5>
                                <p>× ×¡×” ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ××—×¨</p>
                            </div>
                            
                            <div id="donationResultsData" class="results-container"></div>
                        </div>
                    </div>
                </div>
                
                <!-- ×¦×“ ×™××™×Ÿ - iframe ×“×£ ×”×ª×¨××” -->
                <div class="donation-iframe-section">
                    <div class="iframe-header">
                        <h4>ğŸ’³ ×“×£ ×”×ª×¨××”</h4>
                        <div class="iframe-controls">
                            <button class="control-btn" onclick="refreshDonationPage()" title="×¨×¢× ×Ÿ ×“×£">
                                ğŸ”„
                            </button>
                        </div>
                    </div>
                    <div class="donation-iframe-container">
                        <iframe id="donationIframe" 
                                src="" 
                                style="width: 100%; height: 650px; border: none; border-radius: 8px;">
                        </iframe>
                    </div>
                </div>
            </div>
            
            <!-- ××™×“×¢ × ×•×¡×£ ×¢×œ ×”×ª×¨×•××” -->
            <div id="donationInfo" class="donation-info-panel">
                <!-- ××™×“×¢ × ×•×¡×£ ×™×•×¦×’ ×›××Ÿ -->
            </div>
        </div>
    </div>
</div>

       <!-- ×œ×©×•× ×™×ª ×”×™×¡×˜×•×¨×™×” -->
       <div id="historyTab" class="tab-content hidden">
           <div class="card">
               <h2>ğŸ“Š ×”×”×™×¡×˜×•×¨×™×” ×©×œ×™</h2>
               <p class="search-description">×›×œ ×”×—×™×¤×•×©×™× ×©×‘×™×¦×¢×ª ×‘××¢×¨×›×ª</p>
               
               <div class="table-container">
                   <table class="table">
                       <thead>
                           <tr>
                               <th>ğŸ” ××¡×¤×¨ ×˜×œ×¤×•×Ÿ</th>
                               <th>ğŸ“Š ×ª×•×¦××•×ª</th>
                               <th>ğŸ“… ×ª××¨×™×š ×•×–××Ÿ</th>
                               <th>âš¡ ×¤×¢×•×œ×•×ª</th>
                           </tr>
                       </thead>
                       <tbody id="historyTableBody">
                           <tr>
                               <td colspan="4" class="text-center">
                                   <div class="loading">
                                       <div class="loading-spinner"></div>
                                       ×˜×•×¢×Ÿ ×”×™×¡×˜×•×¨×™×”...
                                   </div>
                               </td>
                           </tr>
                       </tbody>
                   </table>
               </div>
           </div>
       </div>

       <!-- ×œ×©×•× ×™×ª ×”×¢×¨×•×ª -->
       <div id="notesTab" class="tab-content hidden">
           <div class="card">
               <h2>ğŸ“ ×”×”×¢×¨×•×ª ×©×œ×™</h2>
               <p class="search-description">×›×œ ×”×”×¢×¨×•×ª ×”××™×©×™×•×ª ×©×›×ª×‘×ª ×¢×œ ×ª×•×¨××™×</p>
               
               <div id="myNotesContainer">
                   <div class="loading">
                       <div class="loading-spinner"></div>
                       ×˜×•×¢×Ÿ ×”×¢×¨×•×ª...
                   </div>
               </div>
           </div>
       </div>
   </div>

   <!-- ××•×“×œ×™× -->
   
   <!-- ××•×“×œ ×”×•×“×¢×•×ª -->
   <div id="messagesModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ’¬ ×”×•×“×¢×•×ª ××”××¢×¨×›×ª</h3>
               <button class="modal-close" onclick="closeModal('messagesModal')">&times;</button>
           </div>
           <div id="messagesContent">
               <div class="loading">
                   <div class="loading-spinner"></div>
                   ×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...
               </div>
           </div>
       </div>
   </div>

   <!-- ××•×“×œ ×›×¨×˜×™×¡×™ ×ª××™×›×” -->
   <div id="ticketsModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ« ×›×¨×˜×™×¡×™ ×”×ª××™×›×” ×©×œ×™</h3>
               <button class="modal-close" onclick="closeModal('ticketsModal')">&times;</button>
           </div>
           <div class="mb-20">
               <button class="btn btn-success" onclick="showNewTicketForm()">
                   â• ×›×¨×˜×™×¡ ×ª××™×›×” ×—×“×©
               </button>
           </div>
           <div id="ticketsContent">
               <div class="loading">
                   <div class="loading-spinner"></div>
                   ×˜×•×¢×Ÿ ×›×¨×˜×™×¡×™×...
               </div>
           </div>
       </div>
   </div>

   <!-- ××•×“×œ ×›×¨×˜×™×¡ ×ª××™×›×” ×—×“×© -->
   <div id="newTicketModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ« ×›×¨×˜×™×¡ ×ª××™×›×” ×—×“×©</h3>
               <button class="modal-close" onclick="closeModal('newTicketModal')">&times;</button>
           </div>
           <form id="newTicketForm">
               <div class="form-group">
                   <label for="ticketTitle">×›×•×ª×¨×ª ×”×‘×¢×™×”:</label>
                   <input type="text" id="ticketTitle" class="form-control" required 
                          placeholder="×œ×“×•×’××”: ×œ× ××•×¦× ×ª×•×¨× ×‘××¢×¨×›×ª">
               </div>
               <div class="form-group">
                   <label for="ticketCategory">×§×˜×’×•×¨×™×”:</label>
                   <select id="ticketCategory" class="form-control">
                       <option value="technical">×‘×¢×™×” ×˜×›× ×™×ª</option>
                       <option value="data">×‘×¢×™×” ×‘× ×ª×•× ×™×</option>
                       <option value="access">×‘×¢×™×™×ª ×’×™×©×”</option>
                       <option value="training">×¦×¨×™×š ×”×“×¨×›×”</option>
                       <option value="other">××—×¨</option>
                   </select>
               </div>
               <div class="form-group">
                   <label for="ticketPriority">×¢×“×™×¤×•×ª:</label>
                   <select id="ticketPriority" class="form-control">
                       <option value="low">× ××•×›×”</option>
                       <option value="medium">×‘×™× ×•× ×™×ª</option>
                       <option value="high">×’×‘×•×”×”</option>
                       <option value="urgent">×“×—×•×£</option>
                   </select>
               </div>
               <div class="form-group">
                   <label for="ticketDescription">×ª×™××•×¨ ××¤×•×¨×˜ ×©×œ ×”×‘×¢×™×”:</label>
                   <textarea id="ticketDescription" class="form-control" rows="5" required 
                             placeholder="×ª××¨ ×‘×¤×™×¨×•×˜ ××” ×”×‘×¢×™×”, ××” × ×™×¡×™×ª ×œ×¢×©×•×ª, ×•××” ×§×¨×”..."></textarea>
               </div>
               <button type="submit" class="btn">
                   ğŸ“¨ ×©×œ×— ×›×¨×˜×™×¡ ×ª××™×›×”
               </button>
           </form>
       </div>
   </div>

   <!-- ××•×“×œ ×”×¢×¨×” ××™×©×™×ª -->
   <div id="noteModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ“ ×”×•×¡×¤×ª ×”×¢×¨×” ××™×©×™×ª</h3>
               <button class="modal-close" onclick="closeModal('noteModal')">&times;</button>
           </div>
           <form id="noteForm">
               <div class="form-group">
                   <label for="noteContent">×”×¢×¨×” ×¢×œ ×”×ª×•×¨×:</label>
                   <textarea id="noteContent" class="form-control" rows="4" 
                             placeholder="×›×ª×‘ ×”×¢×¨×” ××™×©×™×ª ×¢×œ ×”×ª×•×¨× (×œ××©×œ: ××¢×“×™×£ ×§×‘×œ×•×ª ×‘××™×™×œ, ×œ× ×œ×˜×œ×¤×Ÿ ××—×¨×™ 18:00...)" 
                             required></textarea>
               </div>
               <div class="form-group">
                   <small class="text-muted">
                       ğŸ’¡ ×”×”×¢×¨×” ×ª×”×™×” ×¤×¨×˜×™×ª ×•×¨×§ ××ª×” ×ª×•×›×œ ×œ×¨××•×ª ××•×ª×”
                   </small>
               </div>
               <button type="submit" class="btn">
                   ğŸ’¾ ×©××•×¨ ×”×¢×¨×”
               </button>
           </form>
       </div>
   </div>

   <script>
       // ××©×ª× ×™ ×’×œ×•×‘×œ×™×™×
       let currentUser = null;
       let authToken = null;
       let currentDonorId = null;
       let recentSearches = [];
       let searchStats = { searches: 0, results: 0 };
	   
      // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ×œ×ª×¨×•××•×ª
      let donationTypes = [];
      let currentDonationType = null;
      let donationStats = {};

       // ×˜×¢×™× ×ª ×”×“×£
       window.onload = function() {
           console.log('ğŸš€ ×××©×§ ×˜×œ×¤×Ÿ × ×˜×¢×Ÿ');
           
           // ×‘×“×™×§×ª ×”×–×“×”×•×ª
           checkAuthentication();
           
           // ×‘×“×™×§×ª ××¦×‘ ×œ×™×œ×”
           if (localStorage.getItem('darkMode') === 'true') {
               document.body.classList.add('dark-mode');
               updateDarkModeButton();
           }
       };

       // ×‘×“×™×§×ª ×”×–×“×”×•×ª
       function checkAuthentication() {
           const token = localStorage.getItem('authToken');
           const user = localStorage.getItem('currentUser');
           
           if (!token || !user) {
               console.log('âŒ ×œ× ××–×•×”×” - ××¤× ×” ×œ×“×£ ×”×ª×—×‘×¨×•×ª');
               window.location.href = 'login.html';
               return;
           }
           
           try {
               currentUser = JSON.parse(user);
               authToken = token;
               
               // ×‘×“×™×§×” ×©×”××©×ª××© ××™× ×• ××“××™×Ÿ
               if (currentUser.role === 'admin') {
                   console.log('ğŸ”„ ××“××™×Ÿ - ××¤× ×” ×œ×¤×× ×œ × ×™×”×•×œ');
                   window.location.href = 'admin.html';
                   return;
               }
               
               console.log('âœ… ××©×ª××© ××–×•×”×”:', currentUser.username);
               initializeInterface();
               
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×¤×¢× ×•×— × ×ª×•× ×™ ××©×ª××©:', error);
               logout();
           }
       }

       // ××ª×—×•×œ ×”×××©×§
function initializeInterface() {
   // ×¢×“×›×•×Ÿ ×‘×¨×›×”
   const welcomeEl = document.getElementById('userWelcome');
   const fullName = currentUser.full_name || currentUser.username;
   welcomeEl.textContent = `×©×œ×•× ${fullName}`;
   
   // ×˜×¢×™× ×ª × ×ª×•× ×™× ×¨××©×•× ×™×™×
   loadStats();
   loadSystemMessages();
   loadSearchHistory();
   
   // ×¤×•×§×•×¡ ×¢×œ ×©×“×” ×”×—×™×¤×•×©
   document.getElementById('phoneSearch').focus();
   
   // ×”×•×¡×¤×ª ×‘×“×™×§×ª ×”×ª×¨××•×ª ×›×¨×˜×™×¡×™ ×ª××™×›×”
   updateTicketNotification(); // ×‘×“×™×§×” ×¨××©×•× ×™×ª
   setInterval(updateTicketNotification, 30000); // ×‘×“×™×§×” ×›×œ 30 ×©× ×™×•×ª
   
   console.log('âœ… ×××©×§ ×”×•×›×Ÿ ×‘×”×¦×œ×—×”');
}
	   
	   async function updateTicketNotification() {
    try {
        const response = await fetch('/api/my-tickets', {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            const tickets = await response.json();
            const hasNewResponses = tickets.some(ticket => ticket.has_admin_response);
            
            const ticketButton = document.querySelector('button[onclick="showMyTickets()"]');
            if (hasNewResponses) {
                ticketButton.style.position = 'relative';
                if (!ticketButton.querySelector('.notification-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'notification-badge';
                    badge.textContent = '!';
                    ticketButton.appendChild(badge);
                }
                ticketButton.style.animation = 'pulse 1.5s infinite';
            } else {
                const badge = ticketButton.querySelector('.notification-badge');
                if (badge) badge.remove();
                ticketButton.style.animation = '';
            }
        }
    } catch (error) {
        console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×ª×¨××•×ª:', error);
    }
}

       // ××¦×‘ ×œ×™×œ×”
       function toggleDarkMode() {
           document.body.classList.toggle('dark-mode');
           const isDark = document.body.classList.contains('dark-mode');
           localStorage.setItem('darkMode', isDark);
           updateDarkModeButton();
       }

       function updateDarkModeButton() {
           const btn = document.querySelector('.dark-mode-toggle');
           const isDark = document.body.classList.contains('dark-mode');
           btn.textContent = isDark ? 'â˜€ï¸ ××¦×‘ ×™×•×' : 'ğŸŒ™ ××¦×‘ ×œ×™×œ×”';
       }

      // × ×™×”×•×œ ×œ×©×•× ×™×•×ª
      function showTab(tabName) {
          // ×”×¡×¨×ª active ××›×œ ×”×œ×©×•× ×™×•×ª
          document.querySelectorAll('.nav-tab').forEach(tab => {
              tab.classList.remove('active');
          });
          
          // ×”×¡×ª×¨×ª ×›×œ ×”×ª×•×›×Ÿ
          document.querySelectorAll('.tab-content').forEach(content => {
              content.classList.add('hidden');
          });
          
          // ×”×¦×’×ª ×”×œ×©×•× ×™×ª ×”× ×‘×—×¨×ª
          document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
          document.getElementById(`${tabName}Tab`).classList.remove('hidden');
          
          // ×˜×¢×™× ×ª × ×ª×•× ×™× ×¡×¤×¦×™×¤×™×™×
          switch(tabName) {
              case 'donations':
                  loadDonationTypes();
                  break;
              case 'history':
                  loadSearchHistory();
                  break;
              case 'notes':
                  loadMyNotes();
                  break;
              case 'search':
                  document.getElementById('phoneSearch').focus();
                  break;
          }
      }

      // ×˜×¢×™× ×ª ×¡×•×’×™ ×ª×¨×•××•×ª
      async function loadDonationTypes() {
          try {
              showDonationLoading(true);
              
              const response = await fetch('/api/donation-types', {
                  headers: { 'Authorization': `Bearer ${authToken}` }
              });
              
              if (response.ok) {
                  donationTypes = await response.json();
                  displayDonationTypes();
              } else {
                  throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×•×’×™ ×ª×¨×•××•×ª');
              }
          } catch (error) {
              console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¨×•××•×ª:', error);
              showDonationError('×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×•×’×™ ×”×ª×¨×•××•×ª');
          } finally {
              showDonationLoading(false);
          }
      }

      // ×”×¦×’×ª ××¦×‘ ×˜×¢×™× ×”
      function showDonationLoading(loading) {
          const container = document.getElementById('donationTypesContainer');
          const list = document.getElementById('donationTypesList');
          
          if (loading) {
              container.classList.remove('hidden');
              list.classList.add('hidden');
          } else {
              container.classList.add('hidden');
              list.classList.remove('hidden');
          }
      }

      // ×”×¦×’×ª ×©×’×™××”
      function showDonationError(message) {
          const container = document.getElementById('donationTypesContainer');
          container.innerHTML = `
              <div class="donation-empty-state">
                  <div class="donation-empty-icon">âš ï¸</div>
                  <h3>×©×’×™××” ×‘×˜×¢×™× ×”</h3>
                  <p>${message}</p>
                  <button class="btn btn-admin" onclick="loadDonationTypes()">
                      ğŸ”„ × ×¡×” ×©×•×‘
                  </button>
              </div>
          `;
          container.classList.remove('hidden');
      }

      // ×”×¦×’×ª ×¡×•×’×™ ×”×ª×¨×•××•×ª
      function displayDonationTypes() {
          const grid = document.getElementById('donationTypesGrid');
          
          if (donationTypes.length === 0) {
              document.getElementById('donationTypesList').innerHTML = `
                  <div class="donation-empty-state">
                      <div class="donation-empty-icon">ğŸ’³</div>
                      <h3>××™×Ÿ ×¡×•×’×™ ×ª×¨×•××•×ª ×–××™× ×™×</h3>
                      <p>×›×¨×’×¢ ××™×Ÿ ×¡×•×’×™ ×ª×¨×•××•×ª ×¤×¢×™×œ×™× ×‘××¢×¨×›×ª</p>
                  </div>
      `;
              return;
          }
          
          grid.innerHTML = donationTypes.map(donation => `
              <div class="donation-type-card" onclick="selectDonationType(${donation.id})">
                  <div class="donation-type-icon">ğŸ’³</div>
                  <div class="donation-type-title">${donation.name}</div>
                  <div class="donation-type-description">
                      ${donation.description || '×œ×—×¥ ×œ×”×ª×—×™×œ ×ª×”×œ×™×š ×—×™×•×‘'}
                  </div>
                  <div class="donation-status-active">
                      ×–××™×Ÿ ×¢×›×©×™×•
                  </div>
              </div>
          `).join('');
      }

      // ×‘×—×™×¨×ª ×¡×•×’ ×ª×¨×•××”
      async function selectDonationType(donationId) {
          currentDonationType = donationTypes.find(d => d.id === donationId);
          
          if (!currentDonationType) {
              showNotification('×¡×•×’ ×ª×¨×•××” ×œ× × ××¦×', 'error');
              return;
          }
          
          // ×¨×™×©×•× ×’×™×©×”
          try {
              await fetch(`/api/donation-types/${donationId}/access`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                      'Authorization': `Bearer ${authToken}`
                  },
                  body: JSON.stringify({ action: 'VIEW' })
              });
          } catch (error) {
              console.warn('×©×’×™××” ×‘×¨×™×©×•× ×’×™×©×”:', error);
          }
          
          // ×”×¡×ª×¨×ª ×¨×©×™××” ×•×”×¦×’×ª ×“×£
          document.getElementById('donationTypesList').classList.add('hidden');
          document.getElementById('donationPageContainer').classList.remove('hidden');
          
          // ×¢×“×›×•×Ÿ ×›×•×ª×¨×ª
          document.getElementById('selectedDonationTitle').textContent = 
              `×“×£ ×”×ª×¨××” - ${currentDonationType.name}`;
          
          // ×˜×¢×™× ×ª ×“×£ ×”×ª×¨×•××”
          loadDonationPage(currentDonationType.url);
          
          showNotification(`× ×˜×¢×Ÿ ×“×£ ×”×ª×¨××”: ${currentDonationType.name}`, 'info');
      }

      // ×˜×¢×™× ×ª ×“×£ ×”×ª×¨×•××” ×‘-iframe
      function loadDonationPage(url) {
          const iframe = document.getElementById('donationIframe');
          iframe.src = url;
          
          // ×”×¦×’×ª ××™×“×¢ × ×•×¡×£
          document.getElementById('donationInfo').innerHTML = `
              <h4>ğŸ“‹ ××™×“×¢ ×¢×œ ×”×ª×¨×•××”</h4>
              <div class="donation-stats">
                  <div class="donation-stat-item">
                      <span class="donation-stat-number">${currentDonationType.name}</span>
                      <span class="donation-stat-label">×¡×•×’ ×ª×¨×•××”</span>
                  </div>
                  <div class="donation-stat-item">
                      <span class="donation-stat-number">ğŸ”—</span>
                      <span class="donation-stat-label">×“×£ ×¤×¢×™×œ</span>
                  </div>
                  <div class="donation-stat-item">
                      <span class="donation-stat-number">âœ…</span>
                      <span class="donation-stat-label">××•×›×Ÿ ×œ×—×™×•×‘</span>
                  </div>
              </div>
              <div style="margin-top: 15px; padding: 15px; background: rgba(116, 185, 255, 0.1); border-radius: 8px;">
                  <h5>ğŸ’¡ ×”×•×¨××•×ª:</h5>
                  <ul>
                      <li>××œ× ××ª ×›×œ ×¤×¨×˜×™ ×”×ª×•×¨× ×‘×“×£ ×œ××˜×”</li>
                      <li>×‘×“×•×§ ×©×›×œ ×”×¤×¨×˜×™× × ×›×•× ×™× ×œ×¤× ×™ ×”×—×™×•×‘</li>
                      <li>×œ××—×¨ ×”×—×™×•×‘ ×”××•×¦×œ×—, ×ª×•×›×œ ×œ×—×–×•×¨ ×œ×¨×©×™××ª ×”×ª×¨×•××•×ª</li>
                      <li>×‘××§×¨×” ×©×œ ×‘×¢×™×”, ×¤× ×” ×œ×ª××™×›×” ×“×¨×š ×›×¨×˜×™×¡×™ ×”×ª××™×›×”</li>
                  </ul>
              </div>
          `;
      }

      // ×¡×’×™×¨×ª ×“×£ ×”×ª×¨×•××”
      function closeDonationPage() {
          document.getElementById('donationPageContainer').classList.add('hidden');
          document.getElementById('donationTypesList').classList.remove('hidden');
          
          // × ×™×§×•×™ iframe
          document.getElementById('donationIframe').src = '';
          currentDonationType = null;
          
          showNotification('×—×–×¨×ª ×œ×¨×©×™××ª ×”×ª×¨×•××•×ª', 'info');
      }

      // ×¨×¢× ×•×Ÿ ×“×£ ×”×ª×¨×•××”
      function refreshDonationPage() {
          if (currentDonationType) {
              loadDonationPage(currentDonationType.url);
              showNotification('×“×£ ×”×ª×¨×•××” ×¨×•×¢× ×Ÿ', 'success');
          }
      }

      // ×˜×™×¤×•×œ ×‘×˜×¢×™× ×ª iframe
      function onDonationPageLoad() {
          console.log('âœ… ×“×£ ×”×ª×¨×•××” × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
          
          // ×¨×™×©×•× ×¤×¢×•×œ×ª ×˜×¢×™× ×”
          if (currentDonationType) {
              fetch(`/api/donation-types/${currentDonationType.id}/access`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                      'Authorization': `Bearer ${authToken}`
                  },
                  body: JSON.stringify({ action: 'LOADED' })
              }).catch(error => console.warn('×©×’×™××” ×‘×¨×™×©×•× ×˜×¢×™× ×”:', error));
          }
      }

// ×˜×™×¤×•×œ ×‘×§×œ×˜ ×”×—×™×¤×•×© (×”××©×š)
       function handleSearchInput(input) {
           const value = input.value;
           const counter = document.getElementById('charCounter');
           
           if (value.length === 0) {
               counter.textContent = '× ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™×';
               counter.classList.remove('warning');
               input.classList.remove('error');
           } else if (value.length < 7) {
               counter.textContent = `× ×“×¨×©×™× ×¢×•×“ ${7 - value.length} ×ª×•×•×™×`;
               counter.classList.add('warning');
               input.classList.add('error');
           } else {
               counter.textContent = `âœ“ ××•×›×Ÿ ×œ×—×™×¤×•×© (${value.length} ×ª×•×•×™×)`;
               counter.classList.remove('warning');
               input.classList.remove('error');
           }
       }

       // ×¤×•× ×§×¦×™×™×ª ×—×™×¤×•×© ××ª×§×“××ª
       async function searchDonor() {
           const phone = document.getElementById('phoneSearch').value.trim();
           
           if (!phone) {
               showNotification('×× × ×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ', 'warning');
               document.getElementById('phoneSearch').focus();
               return;
           }
           
           if (phone.length < 7) {
               showNotification('× ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™× ×œ×—×™×¤×•×©', 'warning');
               document.getElementById('phoneSearch').focus();
               return;
           }
           
           console.log('ğŸ” ××—×¤×© ×˜×œ×¤×•×Ÿ:', phone);
           
           // ×”×¦×’×ª ××¡×š ×˜×¢×™× ×”
           showSearchLoading(true);
           
           try {
               const response = await fetch(`/api/search/${encodeURIComponent(phone)}`, {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               const data = await response.json();
               
               if (response.ok) {
                   searchStats.searches++;
                   searchStats.results += data.length;
				   localStorage.setItem('searchStats', JSON.stringify(searchStats));
                   
                   if (data.length === 0) {
                       showNoResults();
                   } else {
                       displayResults(data);
                       addToRecentSearches(phone, data.length);
                   }
                   
                   updateStatsDisplay();
               } else {
                   showNotification(data.error || '×©×’×™××” ×‘×—×™×¤×•×©', 'error');
                   hideResults();
               }
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×—×™×¤×•×©:', error);
               showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
               hideResults();
           } finally {
               showSearchLoading(false);
           }
       }

       // ×”×¦×’×ª ××¦×‘ ×˜×¢×™× ×”
       function showSearchLoading(loading) {
           const container = document.getElementById('resultsContainer');
           const loadingMsg = document.getElementById('loadingMessage');
           const noResults = document.getElementById('noResults');
           const searchResults = document.getElementById('searchResults');
           
           if (loading) {
               container.classList.remove('hidden');
               loadingMsg.classList.remove('hidden');
               noResults.classList.add('hidden');
               searchResults.querySelector('#resultsData').innerHTML = '';
               document.getElementById('resultsHeader').classList.add('hidden');
           } else {
               loadingMsg.classList.add('hidden');
           }
       }

       // ×”×¦×’×ª "××™×Ÿ ×ª×•×¦××•×ª"
       function showNoResults() {
           document.getElementById('noResults').classList.remove('hidden');
           document.getElementById('resultsHeader').classList.add('hidden');
       }

       // ×”×¡×ª×¨×ª ×ª×•×¦××•×ª
       function hideResults() {
           document.getElementById('resultsContainer').classList.add('hidden');
       }

// ×”×—×œ×£ ××ª ×”×¤×•× ×§×¦×™×” displayResults ×‘-index.html
function displayResults(donors) {
    console.log('ğŸ“‹ ××¦×™×’ ×ª×•×¦××•×ª:', donors.length, '×ª×•×¨××™×');
    
    const container = document.getElementById('resultsData');
    const header = document.getElementById('resultsHeader');
    const countEl = document.getElementById('resultsCount');
    
    // ×¢×“×›×•×Ÿ ×›×•×ª×¨×ª
    countEl.textContent = `× ××¦××• ${donors.length} ×ª×•×¨××™×`;
    header.classList.remove('hidden');
    
    // ×™×¦×™×¨×ª ×›×¨×˜×™×¡×™ ×ª×•×¨××™×
    container.innerHTML = '';
    
    donors.forEach((donor, index) => {
        const card = document.createElement('div');
        card.className = 'donor-card collapsed';
        
        const donationsCount = donor.donations_count || 1;
        const totalDonated = donor.total_donated || 0;
        
        card.innerHTML = `
            <!-- ×›×•×ª×¨×ª ×ª×•×¨× ××ª×§×¤×œ×ª -->
            <div class="donor-summary" onclick="toggleDonorCard(${index})" style="
                cursor: pointer;
                padding: 20px;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border-radius: 12px;
                margin-bottom: 10px;
                transition: all 0.3s ease;
                border: 2px solid #dee2e6;
            " onmouseover="this.style.borderColor='#007bff'" onmouseout="this.style.borderColor='#dee2e6'">
                
                <div style="display: flex; justify-content: between; align-items: center;">
                    <div style="flex: 1;">
                        <h3 style="margin: 0; color: #007bff; font-size: 18px;">
                            <span style="
                                background: #007bff; 
                                color: white; 
                                width: 30px; 
                                height: 30px; 
                                border-radius: 50%; 
                                display: inline-flex; 
                                align-items: center; 
                                justify-content: center; 
                                margin-left: 10px;
                                font-size: 14px;
                                font-weight: bold;
                            ">${index + 1}</span>
                            ğŸ‘¤ ${donor.full_name || '×ª×•×¨× ×œ× ×™×“×•×¢'}
                        </h3>
                        <div style="margin-top: 8px; color: #666; font-size: 14px;">
                            ğŸ“ ${donor.phone || '×œ×œ× ×˜×œ×¤×•×Ÿ'} | 
                            ğŸ’° ×¡×”"×›: â‚ª${totalDonated.toLocaleString()} | 
                            ğŸ¯ ${donationsCount} ${donationsCount === 1 ? '×ª×¨×•××”' : '×ª×¨×•××•×ª'}
                        </div>
                    </div>
                    
                    <div style="text-align: left;">
                        <span class="expand-icon" id="icon_${index}" style="
                            font-size: 24px; 
                            transition: transform 0.3s ease;
                            color: #007bff;
                        ">â–¼</span>
                    </div>
                </div>
            </div>
            
            <!-- ×¤×¨×˜×™ ×”×ª×•×¨× ×”××œ××™× (××•×¡×ª×¨ ×‘×”×ª×—×œ×”) -->
            <div class="donor-details" id="details_${index}" style="display: none;">
                
                <!-- ×¤×¨×˜×™ ×”×ª×•×¨× ×”×‘×¡×™×¡×™×™× -->
                <div class="donor-basic-info" style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin-bottom: 15px;">ğŸ“‹ ×¤×¨×˜×™ ×”×ª×•×¨×:</h4>
                    
                    <div class="donor-field">
                        <span class="field-icon">ğŸ‘¤</span>
                        <span class="field-label">×©× ××œ×</span>
                        <input type="text" class="field-value" value="${donor.full_name || ''}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${donor.full_name || ''}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    
                    <div class="donor-field">
                        <span class="field-icon">ğŸ“</span>
                        <span class="field-label">×˜×œ×¤×•×Ÿ</span>
                        <input type="text" class="field-value" value="${donor.phone || ''}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${donor.phone || ''}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    
                    <div class="donor-field">
                        <span class="field-icon">ğŸ“§</span>
                        <span class="field-label">××™××™×™×œ</span>
                        <input type="text" class="field-value" value="${donor.email || ''}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${donor.email || ''}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    
					${donor.street || donor.building || donor.apartment || donor.city ? `
                    <div class="donor-field">
                        <span class="field-icon">ğŸ </span>
                        <span class="field-label">×›×ª×•×‘×ª ××œ××”</span>
                        <input type="text" class="field-value" value="${[donor.street, donor.building, donor.apartment ? '×“×™×¨×” ' + donor.apartment : '', donor.city].filter(Boolean).join(', ')}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${[donor.street, donor.building, donor.apartment ? '×“×™×¨×” ' + donor.apartment : '', donor.city].filter(Boolean).join(', ')}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    ` : ''}
					
                    ${donor.city ? `
                    <div class="donor-field">
                        <span class="field-icon">ğŸŒ†</span>
                        <span class="field-label">×¢×™×¨</span>
                        <input type="text" class="field-value" value="${donor.city}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${donor.city}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    ` : ''}
					
					${donor.street ? `
					<div class="donor-field">
						<span class="field-icon">ğŸ›£ï¸</span>
						<span class="field-label">×¨×—×•×‘</span>
						<input type="text" class="field-value" value="${donor.street}" readonly>
						<button class="btn btn-success btn-sm" onclick="copyText('${donor.street}', this)">
						ğŸ“‹ ×”×¢×ª×§
						</button>
					</div>
					` : ''}
					
					${donor.building ? `
					<div class="donor-field">
						<span class="field-icon">ğŸ¢</span>
						<span class="field-label">××¡' ×‘× ×™×™×Ÿ</span>
						<input type="text" class="field-value" value="${donor.building}" readonly>
						<button class="btn btn-success btn-sm" onclick="copyText('${donor.building}', this)">
						ğŸ“‹ ×”×¢×ª×§
						</button>
					</div>
					` : ''}
                    
                    <div class="donor-field">
                        <span class="field-icon">ğŸ“…</span>
                        <span class="field-label">×¢×“×›×•×Ÿ ××—×¨×•×Ÿ</span>
                        <input type="text" class="field-value" value="${donor.donations && donor.donations[0] && donor.donations[0].created_field ? donor.donations[0].created_field : '×œ× ×™×“×•×¢'}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${donor.last_modified ? new Date(donor.last_modified).toLocaleDateString('he-IL') : '×œ× ×™×“×•×¢'}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    
                    <div class="donor-field">
                        <span class="field-icon">ğŸ’°</span>
                        <span class="field-label">×¡×”"×› ×ª×¨×</span>
                        <input type="text" class="field-value" value="â‚ª${totalDonated.toLocaleString()}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('â‚ª${totalDonated.toLocaleString()}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                    
                    <div class="donor-field">
                        <span class="field-icon">ğŸ¯</span>
                        <span class="field-label">××¡×¤×¨ ×ª×¨×•××•×ª</span>
                        <input type="text" class="field-value" value="${donationsCount}" readonly>
                        <button class="btn btn-success btn-sm" onclick="copyText('${donationsCount}', this)">
                            ğŸ“‹ ×”×¢×ª×§
                        </button>
                    </div>
                </div>
                
<!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” -->
                <div style="text-align: center; margin: 20px 0;">
                    <button id="toggle_${index}" class="btn btn-warning" onclick="toggleDonations(${index})">
                        ğŸ“Š ×”×¦×’ ×ª×¨×•××•×ª (${donationsCount})
                    </button>
                    <button class="btn btn-info" onclick="addNote(${donor.main_id})">
                        ğŸ“ ×”×•×¡×£ ×”×¢×¨×”
                    </button>
                    <button class="btn btn-success" onclick="copyAllDonorInfo(${index})">
                        ğŸ“‹ ×”×¢×ª×§ ×”×›×œ
                    </button>
                </div>
                
                <!-- ×”×¢×¨×•×ª ×¢×œ ×”×ª×•×¨× -->
                <div id="notes_${index}" class="donor-notes-section">
                    <!-- ×”×”×¢×¨×•×ª ×™×˜×¢× ×• ×›××Ÿ -->
                </div>
                
                <!-- ×¨×©×™××ª ×ª×¨×•××•×ª ××ª×§×¤×œ×ª -->
                <div class="donations-list hidden" id="donations_${index}">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <h4 style="margin-bottom: 15px; color: #333;">ğŸ’° ×”×™×¡×˜×•×¨×™×™×ª ×ª×¨×•××•×ª:</h4>
                        <div id="donations_content_${index}">
                            <!-- ×”×ª×¨×•××•×ª ×™×˜×¢× ×• ×›××Ÿ -->
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        container.appendChild(card);
        
        // ×”×›× ×ª ×ª×•×›×Ÿ ×”×ª×¨×•××•×ª
        if (donor.donations && donor.donations.length > 0) {
            prepareDonationsContent(index, donor.donations);
        }
        
        // ×˜×¢×™× ×ª ×”×¢×¨×•×ª ×”×ª×•×¨×
        loadDonorNotes(donor.main_id, index);
    });
}

// ×¤×•× ×§×¦×™×” ×œ×¤×ª×™×—×”/×¡×’×™×¨×” ×©×œ ×›×¨×˜×™×¡ ×ª×•×¨×
function toggleDonorCard(donorIndex) {
    const details = document.getElementById(`details_${donorIndex}`);
    const icon = document.getElementById(`icon_${donorIndex}`);
    const card = details.closest('.donor-card');
    
    if (details.style.display === 'none') {
        details.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
        card.classList.remove('collapsed');
        card.classList.add('expanded');
        
        // ×× ×™××¦×™×”
        details.style.opacity = '0';
        setTimeout(() => {
            details.style.transition = 'opacity 0.3s ease';
            details.style.opacity = '1';
        }, 10);
        
    } else {
        details.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
        card.classList.remove('expanded');
        card.classList.add('collapsed');
    }
}

// ×¤×•× ×§×¦×™×” ×œ×”×›× ×ª ×ª×•×›×Ÿ ×”×ª×¨×•××•×ª
function prepareDonationsContent(donorIndex, donations) {
    const content = document.getElementById(`donations_content_${donorIndex}`);
    if (!content) return;
    
    let donationsArray = [];
    try {
        donationsArray = Array.isArray(donations) ? donations : [donations];
    } catch (e) {
        console.error('×©×’×™××” ×‘×¢×™×‘×•×“ ×ª×¨×•××•×ª:', e);
        donationsArray = [];
    }
    
    if (donationsArray.length === 0) {
        content.innerHTML = '<div style="text-align: center; color: #666;">××™×Ÿ × ×ª×•× ×™ ×ª×¨×•××•×ª</div>';
        return;
    }
    
    content.innerHTML = donationsArray.map((donation, index) => `
        <div class="donation-item" style="
            background: white; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            padding: 15px; 
            margin-bottom: 10px;
            transition: all 0.3s ease;
        " onmouseover="this.style.borderColor='#007bff'" onmouseout="this.style.borderColor='#e9ecef'">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h5 style="margin: 0; color: #007bff;">
                    ğŸ¯ ×ª×¨×•××” #${index + 1} 
                    ${donation.order_number ? `(×”×–×× ×”: ${donation.order_number})` : ''}
                </h5>
                <span style="background: ${getPaymentStatusColor(donation.payment_status)}; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                    ${donation.payment_status || '×œ× ×™×“×•×¢'}
                </span>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                ${donation.project_name ? `
                    <div><strong>ğŸ“‹ ×¤×¨×•×™×§×˜:</strong> ${donation.project_name}</div>
                ` : ''}
                
                ${donation.prayer_name ? `
                    <div><strong>ğŸ™ ×©× ×œ×ª×¤×™×œ×”:</strong> ${donation.prayer_name}</div>
                ` : ''}
                
                ${donation.payment_amount ? `
                    <div><strong>ğŸ’° ×¡×›×•×:</strong> <span style="color: #28a745; font-weight: bold;">${donation.payment_amount}</span></div>
                ` : donation.donation_amount ? `
                    <div><strong>ğŸ’° ×¡×›×•×:</strong> <span style="color: #28a745; font-weight: bold;">â‚ª${donation.donation_amount}</span></div>
                ` : ''}
                
                ${donation.payment_method ? `
                    <div><strong>ğŸ’³ ×©×™×˜×ª ×ª×©×œ×•×:</strong> ${donation.payment_method}</div>
                ` : ''}
                
                ${donation.delivery_date ? `
                    <div><strong>ğŸ“… ×ª××¨×™×š ××¡×™×¨×”:</strong> ${donation.delivery_date}</div>
                ` : ''}
                
                ${donation.fix_date ? `
                    <div><strong>ğŸ”§ ×ª××¨×™×š ×ª×™×§×•×Ÿ:</strong> ${donation.fix_date}</div>
                ` : ''}
                
                ${donation.death_date_month && donation.death_date_day ? `
                    <div><strong>ğŸ“… ×ª××¨×™×š ×¤×˜×™×¨×”:</strong> ${donation.death_date_day} ${donation.death_date_month}</div>
                ` : ''}
                
                ${donation.marketing_source ? `
                    <div><strong>ğŸ“¢ ××§×•×¨ ×©×™×•×•×§×™:</strong> ${donation.marketing_source}</div>
                ` : ''}
                
                ${donation.campaign_name ? `
                    <div><strong>ğŸ“Š ×§××¤×™×™×Ÿ:</strong> ${donation.campaign_name}</div>
                ` : ''}
            </div>
            
            ${donation.comments ? `
                <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <strong>ğŸ’¬ ×”×¢×¨×•×ª:</strong> ${donation.comments}
                </div>
            ` : ''}
            
            <div style="margin-top: 10px; text-align: left; font-size: 12px; color: #666;">
                ğŸ“… × ×•×¦×¨: ${new Date(donation.created_at).toLocaleDateString('he-IL')} ${new Date(donation.created_at).toLocaleTimeString('he-IL')}
            </div>
            
            <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” ×œ×ª×¨×•××” ×¡×¤×¦×™×¤×™×ª -->
            <div style="margin-top: 10px; text-align: center;">
                <button class="btn btn-sm btn-info" onclick="copyDonationDetails(${donorIndex}, ${index})">
                    ğŸ“‹ ×”×¢×ª×§ ×¤×¨×˜×™ ×ª×¨×•××”
                </button>
            </div>
        </div>
    `).join('');
}

function getPaymentStatusColor(status) {
    if (!status) return '#6c757d';
    
    const statusLower = status.toLowerCase();
    if (statusLower.includes('×©×•×œ×') || statusLower.includes('paid')) return '#28a745';
    if (statusLower.includes('×××ª×™×Ÿ') || statusLower.includes('pending')) return '#ffc107';
    if (statusLower.includes('× ×›×©×œ') || statusLower.includes('failed')) return '#dc3545';
    return '#17a2b8';
}

// ×¤×•× ×§×¦×™×” ×œ×”×—×œ×¤×ª ××¦×‘ ×”×ª×¦×•×’×” ×©×œ ×ª×¨×•××•×ª
function toggleDonations(donorIndex) {
    const donationsList = document.getElementById(`donations_${donorIndex}`);
    const toggleBtn = document.getElementById(`toggle_${donorIndex}`);
    
    if (!donationsList || !toggleBtn) {
        console.error('×œ× × ××¦××• ××œ×× ×˜×™×:', donorIndex);
        return;
    }
    
    if (donationsList.classList.contains('hidden')) {
        donationsList.classList.remove('hidden');
        toggleBtn.textContent = toggleBtn.textContent.replace('×”×¦×’', '×”×¡×ª×¨');
        toggleBtn.style.background = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
        
        // ×× ×™××¦×™×” ×©×œ ×”×•×¤×¢×”
        donationsList.style.opacity = '0';
        donationsList.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            donationsList.style.transition = 'all 0.3s ease';
            donationsList.style.opacity = '1';
            donationsList.style.transform = 'translateY(0)';
        }, 10);
        
    } else {
        donationsList.classList.add('hidden');
        toggleBtn.textContent = toggleBtn.textContent.replace('×”×¡×ª×¨', '×”×¦×’');
        toggleBtn.style.background = 'linear-gradient(135deg, #ffc107 0%, #e0a800 100%)';
    }
}

// ×¤×•× ×§×¦×™×” ×œ×”×¢×ª×§×ª ×¤×¨×˜×™ ×ª×¨×•××” ×¡×¤×¦×™×¤×™×ª
function copyDonationDetails(donorIndex, donationIndex) {
    const donationsContent = document.getElementById(`donations_content_${donorIndex}`);
    const donationItem = donationsContent.children[donationIndex];
    
    // ×—×™×œ×•×¥ ×”×˜×§×¡×˜ ××”×ª×¨×•××”
    let donationText = '';
    const rows = donationItem.querySelectorAll('div[style*="grid-template-columns"] > div');
    rows.forEach(row => {
        donationText += row.textContent.trim() + '\n';
    });
    
    const commentsDiv = donationItem.querySelector('div[style*="background: #f8f9fa"]');
    if (commentsDiv) {
        donationText += commentsDiv.textContent.trim() + '\n';
    }
    
    copyText(donationText, donationItem.querySelector('.btn'));
    showNotification('×¤×¨×˜×™ ×”×ª×¨×•××” ×”×•×¢×ª×§×•! ğŸ“‹', 'success');
}

// ×¢×“×›×•×Ÿ ×¤×•× ×§×¦×™×™×ª ×™×™×¦×•× ×”×›×œ
function exportResults() {
    const donors = document.querySelectorAll('.donor-card');
    if (donors.length === 0) {
        showNotification('××™×Ÿ ×ª×•×¦××•×ª ×œ×™×™×¦×•×', 'warning');
        return;
    }
    
    let exportText = `×ª×•×¦××•×ª ×—×™×¤×•×© ×ª×•×¨××™× - ${new Date().toLocaleString('he-IL')}\n`;
    exportText += '='.repeat(60) + '\n\n';
    exportText += `ğŸ“Š × ××¦××• ${donors.length} ×ª×•×¨××™×:\n\n`;
    
    donors.forEach((card, index) => {
        const title = card.querySelector('.donor-title').textContent.trim();
        exportText += `${index + 1}. ${title}\n`;
        exportText += '='.repeat(50) + '\n';
        
        // ×¤×¨×˜×™× ×‘×¡×™×¡×™×™×
        const basicFields = card.querySelectorAll('.donor-basic-info .donor-field');
        basicFields.forEach(field => {
            const label = field.querySelector('.field-label').textContent;
            const value = field.querySelector('.field-value').value;
            if (value && value.trim() !== '') {
                exportText += `${label}: ${value}\n`;
            }
        });
        
        // ×ª×¨×•××•×ª ×× ×™×© ×•×¤×ª×•×—×•×ª
        const donationsContent = document.getElementById(`donations_content_${index}`);
        const donationsList = document.getElementById(`donations_${index}`);
        
        if (donationsContent && !donationsList.classList.contains('hidden')) {
            exportText += '\nğŸ’° ×”×™×¡×˜×•×¨×™×™×ª ×ª×¨×•××•×ª:\n';
            exportText += '-'.repeat(30) + '\n';
            
            Array.from(donationsContent.children).forEach((donation, donationIndex) => {
                const donationTitle = donation.querySelector('h5').textContent.trim();
                exportText += `\n  ${donationTitle}\n`;
                
                const donationRows = donation.querySelectorAll('div[style*="grid-template-columns"] > div');
                donationRows.forEach(row => {
                    exportText += `    ${row.textContent.trim()}\n`;
                });
                
                const comments = donation.querySelector('div[style*="background: #f8f9fa"]');
                if (comments) {
                    exportText += `    ${comments.textContent.trim()}\n`;
                }
            });
        }
        
        // ×”×¢×¨×•×ª ××™×©×™×•×ª
        const notesSection = card.querySelector('.notes-section');
        if (notesSection) {
            exportText += '\nğŸ“ ×”×”×¢×¨×•×ª ×©×œ×™:\n';
            const notesContent = notesSection.querySelector('.notes-content').textContent;
            exportText += `${notesContent}\n`;
        }
        
        exportText += '\n' + '='.repeat(50) + '\n\n';
    });
    
    copyText(exportText, { style: { position: 'relative' }, appendChild: () => {}, remove: () => {} });
    showNotification(`×›×œ ${donors.length} ×”×ª×•×¦××•×ª ×”×•×¢×ª×§×•! ğŸ“‹`, 'success');
}

// ×”×•×¡×¤×ª CSS ×œ×¢×™×¦×•×‘ ×”×ª×¨×•××•×ª
const donationStyles = `
   .donation-item {
       transition: all 0.3s ease;
       position: relative;
       overflow: hidden;
   }
   
   .donation-item::before {
       content: '';
       position: absolute;
       top: 0;
       left: -100%;
       width: 100%;
       height: 100%;
       background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
       transition: left 0.5s;
   }
   
   .donation-item:hover::before {
       left: 100%;
   }
   
   .donations-list {
       overflow: hidden;
       transition: max-height 0.3s ease-out;
   }
   
   .donations-list.hidden {
       max-height: 0;
   }
   
   .donations-list:not(.hidden) {
       max-height: 2000px;
   }
   
   .donor-card {
       position: relative;
   }
   
   .donor-card .donations-count {
       background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
       color: white;
       padding: 5px 10px;
       border-radius: 15px;
       font-size: 12px;
       font-weight: bold;
       animation: pulse 2s infinite;
   }
`;

// ×”×•×¡×¤×ª ×”×¡×’× ×•× ×•×ª ×œ×“×£
const donationStyleSheet = document.createElement('style');
donationStyleSheet.textContent = donationStyles;
document.head.appendChild(donationStyleSheet);

       // ×”×¢×ª×§×” ××ª×§×“××ª ×¢× ××©×•×‘
       async function copyText(text, button) {
           if (!text || text.trim() === '') {
               showNotification('××™×Ÿ ×˜×§×¡×˜ ×œ×”×¢×ª×§×”', 'warning');
               return;
           }
           
           try {
               await navigator.clipboard.writeText(text);
               
               // ×™×¦×™×¨×ª ××œ×× ×˜ ××©×•×‘
               const feedback = document.createElement('div');
               feedback.className = 'copy-feedback';
               feedback.textContent = '×”×•×¢×ª×§!';
               
               button.style.position = 'relative';
               button.appendChild(feedback);
               
               // ×”×¡×¨×” ××—×¨×™ ×× ×™××¦×™×”
               setTimeout(() => {
                   if (feedback.parentNode) {
                       feedback.remove();
                   }
               }, 2000);
               
               console.log('ğŸ“‹ ×”×•×¢×ª×§:', text);
               
           } catch (error) {
               // ×¤×ª×¨×•×Ÿ ×—×œ×•×¤×™ ×œ×“×¤×“×¤× ×™× ×™×©× ×™×
               const textArea = document.createElement('textarea');
               textArea.value = text;
               textArea.style.position = 'absolute';
               textArea.style.left = '-9999px';
               document.body.appendChild(textArea);
               textArea.select();
               document.execCommand('copy');
               document.body.removeChild(textArea);
               
               showNotification('×”×•×¢×ª×§ ×‘×”×¦×œ×—×”! ğŸ“‹', 'success');
           }
       }

       // ×˜×™×¤×•×œ ×‘-Enter
       function handleEnterKey(event) {
           if (event.key === 'Enter') {
               event.preventDefault();
               searchDonor();
           }
       }

       // × ×™×§×•×™ ×—×™×¤×•×©
       function clearSearch() {
           document.getElementById('phoneSearch').value = '';
           document.getElementById('charCounter').textContent = '× ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™×';
           document.getElementById('charCounter').classList.remove('warning');
           document.getElementById('phoneSearch').classList.remove('error');
           hideResults();
           document.getElementById('phoneSearch').focus();
       }

       // ×—×™×¤×•×©×™× ××—×¨×•× ×™×
       function addToRecentSearches(phone, resultsCount) {
           const search = { 
               phone, 
               resultsCount, 
               timestamp: new Date().toLocaleString('he-IL') 
           };
           
           // ×”×¡×¨×ª ×›×¤×™×œ×•×™×•×ª
           recentSearches = recentSearches.filter(s => s.phone !== phone);
           recentSearches.unshift(search);
           recentSearches = recentSearches.slice(0, 5); // ×©××™×¨×ª 5 ××—×¨×•× ×™×
           
           updateRecentSearchesDisplay();
           
           // ×©××™×¨×” ×‘×–×™×›×¨×•×Ÿ ××§×•××™
           localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
       }

       function updateRecentSearchesDisplay() {
           if (recentSearches.length === 0) return;
           
           const container = document.getElementById('recentSearches');
           const list = document.getElementById('recentSearchesList');
           
           list.innerHTML = recentSearches.map(search => `
               <span class="recent-item" onclick="searchFromHistory('${search.phone}')">
                   ${search.phone} (${search.resultsCount} ×ª×•×¦××•×ª)
               </span>
           `).join('');
           
           container.classList.remove('hidden');
       }

// ×”×—×œ×£ ××ª ×”×¤×•× ×§×¦×™×” searchFromHistory ×”×§×™×™××ª ×‘×§×•×“
function searchFromHistory(phone) {
    // ××¢×‘×¨ ×œ×˜××‘ ×”×—×™×¤×•×©
    showTab('search');
    
    // ××™×œ×•×™ ×©×“×” ×”×—×™×¤×•×©
    document.getElementById('phoneSearch').value = phone;
    
    // ×¢×“×›×•×Ÿ ××•× ×” ×”×ª×•×•×™×
    handleSearchInput(document.getElementById('phoneSearch'));
    
    // ×‘×™×¦×•×¢ ×”×—×™×¤×•×©
    searchDonor();
}

       // ×˜×¢×™× ×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª
       async function loadStats() {
           try {
               const response = await fetch('/api/stats', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (response.ok) {
                   const stats = await response.json();
               }
               
               // ×˜×¢×™× ×ª ×”×—×™×¤×•×©×™× ×”××—×¨×•× ×™× ××”×–×™×›×¨×•×Ÿ
			   const savedStats = localStorage.getItem('searchStats');
				if (savedStats) {
				searchStats = JSON.parse(savedStats);
				}
               
               updateStatsDisplay();
               
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª:', error);
           }
       }

function updateStatsDisplay() {
    const searchesEl = document.getElementById('totalSearches');
    const resultsEl = document.getElementById('totalResults');
    
    if (searchesEl) {
        searchesEl.textContent = searchStats.searches;
    }
    if (resultsEl) {
        resultsEl.textContent = searchStats.results;
    }
}

       // ×˜×¢×™× ×ª ×”×•×“×¢×•×ª ××¢×¨×›×ª
       async function loadSystemMessages() {
           try {
               const response = await fetch('/api/my-messages', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (response.ok) {
                   const messages = await response.json();
                   displaySystemMessages(messages);
               }
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×•×“×¢×•×ª:', error);
           }
       }

       function displaySystemMessages(messages) {
           const container = document.getElementById('systemMessages');
           
           if (messages.length === 0) {
               container.innerHTML = '';
               return;
           }
           
           // ×”×¦×’×ª ×¨×§ ×”×•×“×¢×•×ª ×—×©×•×‘×•×ª ×‘×¨××© ×”×“×£
           const importantMessages = messages.filter(msg => msg.priority > 1);
           
           container.innerHTML = importantMessages.map(msg => `
               <div class="message ${msg.type}">
                   <div>
                       <strong>${msg.title}</strong>
                       <p>${msg.content}</p>
                       <small>ğŸ“… ${new Date(msg.created_at).toLocaleDateString('he-IL')}</small>
                   </div>
                   <button class="btn btn-sm btn-secondary" onclick="dismissMessage(${msg.id})" title="×¡×’×•×¨ ×”×•×“×¢×”">
                       Ã—
                   </button>
               </div>
           `).join('');
       }

       // ×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×™×ª ×—×™×¤×•×©×™×
       async function loadSearchHistory() {
           try {
               const response = await fetch('/api/my-search-history?limit=50', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (response.ok) {
                   const history = await response.json();
                   displaySearchHistory(history);
               }
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×”:', error);
               document.getElementById('historyTableBody').innerHTML = 
                   '<tr><td colspan="4" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
           }
       }

       function displaySearchHistory(history) {
           const tbody = document.getElementById('historyTableBody');
           
           if (history.length === 0) {
               tbody.innerHTML = `
                   <tr>
                       <td colspan="4" class="text-center">
                           <div class="empty-state">
                               <div class="empty-state-icon">ğŸ”</div>
                               <h3>×¢×“×™×™×Ÿ ×œ× ×‘×™×¦×¢×ª ×—×™×¤×•×©×™×</h3>
                               <p>×”×ª×—×œ ×œ×—×¤×© ×ª×•×¨××™× ×•×”×”×™×¡×˜×•×¨×™×” ×ª×•×¤×™×¢ ×›××Ÿ</p>
                           </div>
                       </td>
                   </tr>
               `;
               return;
           }
           
           tbody.innerHTML = history.map(item => `
               <tr>
                   <td>
                       <strong>${item.search_term}</strong>
                   </td>
                   <td>
                       <span class="btn btn-sm ${item.results_count > 0 ? 'btn-success' : 'btn-secondary'}">
                           ${item.results_count} ×ª×•×¦××•×ª
                       </span>
                   </td>
                   <td>
                       ğŸ“… ${new Date(item.created_at).toLocaleDateString('he-IL')}
                       <br>
                       ğŸ• ${new Date(item.created_at).toLocaleTimeString('he-IL')}
                   </td>
                   <td>
                       <button class="btn btn-info btn-sm" onclick="searchFromHistory('${item.search_term}')">
                           ğŸ” ×—×¤×© ×©×•×‘
                       </button>
                   </td>
               </tr>
           `).join('');
       }

       // ×˜×¢×™× ×ª ×”×”×¢×¨×•×ª ×©×œ×™
       async function loadMyNotes() {
           try {
               const response = await fetch('/api/my-notes', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (response.ok) {
                   const notes = await response.json();
                   displayMyNotes(notes);
               } else {
                   document.getElementById('myNotesContainer').innerHTML = 
                       '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><h3>×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¢×¨×•×ª</h3></div>';
               }
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¢×¨×•×ª:', error);
               document.getElementById('myNotesContainer').innerHTML = 
                   '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><h3>×©×’×™××ª ×ª×§×©×•×¨×ª</h3></div>';
           }
       }

       function displayMyNotes(notes) {
           const container = document.getElementById('myNotesContainer');
           
           if (notes.length === 0) {
               container.innerHTML = `
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ“</div>
                       <h3>××™×Ÿ ×”×¢×¨×•×ª ×¢×“×™×™×Ÿ</h3>
                       <p>×›×©×ª×•×¡×™×£ ×”×¢×¨×•×ª ×¢×œ ×ª×•×¨××™×, ×”×Ÿ ×™×•×¤×™×¢×• ×›××Ÿ</p>
                   </div>
               `;
               return;
           }
           
           container.innerHTML = notes.map(note => `
               <div class="card" style="margin-bottom: 15px;">
                   <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                       <div>
                           <h4>ğŸ‘¤ ${note.donor_name || '×ª×•×¨×'}</h4>
                           <small class="text-muted">ğŸ“ ${note.donor_phone || ''}</small>
                       </div>
                       <small class="text-muted">
                           ğŸ“… ${new Date(note.created_at).toLocaleDateString('he-IL')}
                       </small>
                   </div>
                   <div class="notes-section">
                       <div class="notes-content">${note.note}</div>
                   </div>
                   <div style="margin-top: 15px;">
                       <button class="btn btn-info btn-sm" onclick="searchFromHistory('${note.donor_phone || ''}')">
                           ğŸ” ×—×¤×© ×ª×•×¨×
                       </button>
                   </div>
               </div>
           `).join('');
       }

       // ×”×•×“×¢×•×ª ××¢×¨×›×ª ××•×“×œ
       async function showMessages() {
           openModal('messagesModal');
           
           try {
               const response = await fetch('/api/my-messages', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (response.ok) {
                   const messages = await response.json();
                   displayMessagesModal(messages);
               } else {
                   document.getElementById('messagesContent').innerHTML = 
                       '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><h3>×©×’×™××” ×‘×˜×¢×™× ×ª ×”×•×“×¢×•×ª</h3></div>';
               }
           } catch (error) {
               document.getElementById('messagesContent').innerHTML = 
                   '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><h3>×©×’×™××ª ×ª×§×©×•×¨×ª</h3></div>';
           }
       }

       function displayMessagesModal(messages) {
           const container = document.getElementById('messagesContent');
           
           if (messages.length === 0) {
               container.innerHTML = `
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ’¬</div>
                       <h3>××™×Ÿ ×”×•×“×¢×•×ª ×—×“×©×•×ª</h3>
                       <p>×›×œ ×”×”×•×“×¢×•×ª ××”××¢×¨×›×ª ×™×•×¤×™×¢×• ×›××Ÿ</p>
                   </div>
               `;
               return;
           }
           
           container.innerHTML = messages.map(msg => `
               <div class="message ${msg.type}" style="margin-bottom: 15px;">
                   <div>
                       <h4>${msg.title}</h4>
                       <p>${msg.content}</p>
                       <small>
                           ğŸ“… × ×•×¦×¨: ${new Date(msg.created_at).toLocaleDateString('he-IL')}
                           ${msg.expires_at ? `<br>â° ×¤×•×§×¢: ${new Date(msg.expires_at).toLocaleDateString('he-IL')}` : ''}
                       </small>
                   </div>
               </div>
           `).join('');
       }

// ×”×—×œ×£ ××ª ×”×¤×•× ×§×¦×™×” showMyTickets ×”×§×™×™××ª
async function showMyTickets() {
    openModal('ticketsModal');
    
    try {
        const response = await fetch('/api/my-tickets', {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            const tickets = await response.json();
            displayTicketsModal(tickets);
        } else {
            document.getElementById('ticketsContent').innerHTML = 
                '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><h3>×©×’×™××” ×‘×˜×¢×™× ×ª ×›×¨×˜×™×¡×™×</h3></div>';
        }
    } catch (error) {
        document.getElementById('ticketsContent').innerHTML = 
            '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><h3>×©×’×™××ª ×ª×§×©×•×¨×ª</h3></div>';
    }
}

// ×”×—×œ×£ ××ª ×”×¤×•× ×§×¦×™×” displayTicketsModal ×‘-index.html
function displayTicketsModal(tickets) {
    const container = document.getElementById('ticketsContent');
    
    if (tickets.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ«</div>
                <h3>××™×Ÿ ×›×¨×˜×™×¡×™ ×ª××™×›×”</h3>
                <p>×× ×™×© ×œ×š ×‘×¢×™×” ××• ×©××œ×”, ×¦×•×¨ ×›×¨×˜×™×¡ ×ª××™×›×” ×—×“×©</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = tickets.map(ticket => `
        <div class="card" style="margin-bottom: 20px; 
             ${ticket.status === 'closed' ? 'background: #f8f9fa; border: 2px solid #6c757d; opacity: 0.8;' : ''}
             ${ticket.has_admin_response && ticket.status !== 'closed' ? 'border: 2px solid #28a745; background: #f8fff9;' : ''}">
            
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <h4>#${ticket.id} - ${ticket.title} 
                    ${ticket.status === 'closed' ? 'âœ…' : ''}
                </h4>
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 5px;">
                    <span class="btn btn-sm ${getStatusColor(ticket.status)}">
                        ${getStatusText(ticket.status)}
                    </span>
                    ${ticket.status !== 'closed' && ticket.has_admin_response && !ticket.user_read_admin_response ? `
                    ` : ''}
                </div>
            </div>
            
            ${ticket.status === 'closed' ? `
                <div class="message success" style="margin-bottom: 15px;">
                    <span>âœ… ×›×¨×˜×™×¡ ×–×” × ×¡×’×¨ ×‘×”×¦×œ×—×”. ×ª×•×“×” ×©×¤× ×™×ª ××œ×™× ×•!</span>
                </div>
            ` : ''}
            
            ${ticket.status !== 'closed' && ticket.has_admin_response && !ticket.user_read_admin_response ? `
                <div class="message success" style="margin-bottom: 15px;">
                    <span>ğŸ‰ ×”××“××™×Ÿ ×”×’×™×‘ ×œ×›×¨×˜×™×¡ ×©×œ×š! ×× × ×¢×™×™×Ÿ ×‘×ª×’×•×‘×” ×•×ª×’×™×‘ ×‘×—×–×¨×” ×× × ×“×¨×©.</span>
                </div>
            ` : ''}
            
            <p><strong>ğŸ“‚ ×§×˜×’×•×¨×™×”:</strong> ${getCategoryText(ticket.category)}</p>
            <p><strong>âš¡ ×¢×“×™×¤×•×ª:</strong> ${getPriorityText(ticket.priority)}</p>
            <p style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                <strong>×”×‘×¢×™×” ×©×œ×š:</strong><br>
                ${ticket.description}
            </p>
            
            <!-- ×ª×’×•×‘×•×ª ×ª××™×“ ××•×¦×’×•×ª -->
            <div id="responses_${ticket.id}" style="margin-top: 15px;">
                <div style="text-align: center; padding: 10px; color: #666;">
                    <div class="loading-spinner"></div>
                    ×˜×•×¢×Ÿ ×ª×’×•×‘×•×ª...
                </div>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                <small class="text-muted">
                    ğŸ“… × ×•×¦×¨: ${new Date(ticket.created_at).toLocaleDateString('he-IL')}
                    ${ticket.updated_at !== ticket.created_at ? 
                        `<br>ğŸ”„ ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: ${new Date(ticket.updated_at).toLocaleDateString('he-IL')} ${new Date(ticket.updated_at).toLocaleTimeString('he-IL')}` : ''}
                    ${ticket.status === 'closed' ? '<br>âœ… ×›×¨×˜×™×¡ ×¡×’×•×¨' : 
                      ticket.assigned_to ? '<br>ğŸ‘¤ ×‘×˜×™×¤×•×œ: ×× ×”×œ ××¢×¨×›×ª' : '<br>â³ ×××ª×™×Ÿ ×œ×˜×™×¤×•×œ'}
                </small>
            </div>
            
            ${ticket.status !== 'closed' ? `
                <div style="margin-top: 15px; text-align: center; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="addTicketResponse(${ticket.id}); markTicketAsRead(${ticket.id})" 
                            style="${ticket.has_admin_response && !ticket.user_read_admin_response ? 'animation: bounce 2s infinite;' : ''}">
                        ${ticket.has_admin_response ? 'ğŸ’¬ ×”×©×‘ ×œ××“××™×Ÿ' : 'â• ×”×•×¡×£ ×ª×’×•×‘×”'}
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="closeTicketSimple(${ticket.id})">
                        âœ… ×”×‘×¢×™×” × ×¤×ª×¨×” - ×¡×’×•×¨ ×›×¨×˜×™×¡
                    </button>
                </div>
            ` : ''}
        </div>
    `).join('');
    
    // ×˜×¢×™× ×ª ×ª×’×•×‘×•×ª ×œ×›×œ ×”×›×¨×˜×™×¡×™× ××•×˜×•××˜×™×ª ×¢× timeout
    tickets.forEach((ticket, index) => {
        setTimeout(() => {
            loadTicketResponses(ticket.id);
        }, index * 500);
    });
}

async function loadTicketResponses(ticketId) {
    console.log('ğŸ” ×˜×•×¢×Ÿ ×ª×’×•×‘×•×ª ×œ×›×¨×˜×™×¡:', ticketId);
    
    try {
        const url = `/api/tickets/${ticketId}/responses`;
        console.log('ğŸ“¡ ×©×•×œ×— ×‘×§×©×” ×œ:', url);
        
        const response = await fetch(url, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        console.log('ğŸ“¨ ×ª×’×•×‘×ª ×©×¨×ª:', response.status, response.statusText);
        console.log('ğŸ“¨ Content-Type:', response.headers.get('content-type'));
        
        const responseText = await response.text();
        console.log('ğŸ“„ ×ª×•×›×Ÿ ×ª×’×•×‘×”:', responseText.substring(0, 200));
        
        if (response.ok) {
            try {
                const responses = JSON.parse(responseText);
                console.log('ğŸ’¬ ×”×ª×§×‘×œ×• ×ª×’×•×‘×•×ª:', responses.length);
                displayTicketResponses(ticketId, responses);
            } catch (parseError) {
                console.error('âŒ ×©×’×™××” ×‘×¤×¢× ×•×— JSON:', parseError);
                console.log('ğŸ“„ ×ª×•×›×Ÿ ××œ×:', responseText);
            }
        } else {
            console.error('âŒ ×©×’×™××” ×‘×§×‘×œ×ª ×ª×’×•×‘×•×ª:', response.status);
            const container = document.getElementById(`responses_${ticketId}`);
            container.innerHTML = `
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center; margin-top: 10px;">
                    <p style="color: #721c24; margin: 0;">
                        âš ï¸ ×©×’×™××” ${response.status}: ${responseText.substring(0, 100)}
                    </p>
                </div>
            `;
        }
    } catch (error) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª:', error);
        const container = document.getElementById(`responses_${ticketId}`);
        if (container) {
            container.innerHTML = `
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center; margin-top: 10px;">
                    <p style="color: #721c24; margin: 0;">
                        âš ï¸ ×©×’×™××ª ×ª×§×©×•×¨×ª: ${error.message}
                    </p>
                </div>
            `;
        }
    }
}

function displayTicketResponses(ticketId, responses) {
    const container = document.getElementById(`responses_${ticketId}`);
    
    if (!container) {
        console.error('âŒ ×œ× × ××¦× container ×œ×ª×’×•×‘×•×ª:', ticketId);
        return;
    }
    
    // ×§×‘×œ×ª ×¡×˜×˜×•×¡ ×”×›×¨×˜×™×¡ ××”-DOM
    const ticketCard = container.closest('.card');
    const statusElement = ticketCard.querySelector('.btn-sm');
    const isTicketClosed = statusElement && statusElement.textContent.includes('×¡×’×•×¨');
    
    if (responses.length === 0) {
        container.innerHTML = `
            <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; text-align: center; margin-top: 10px;">
                <p style="color: #666; font-style: italic; margin: 0;">
                    ğŸ“ ××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ - ×›×¨×˜×™×¡ ×”×ª××™×›×” ×©×œ×š ×××ª×™×Ÿ ×œ×˜×™×¤×•×œ
                </p>
            </div>
        `;
        return;
    }
    
    // ××™×•×Ÿ ×ª×’×•×‘×•×ª ×œ×¤×™ ×–××Ÿ
    const sortedResponses = responses.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
    
    container.innerHTML = `
        <div style="margin-top: 15px;">
            <h5 style="margin-bottom: 15px; color: #333;">ğŸ’¬ ×©×™×—×” ×¢× ×”×ª××™×›×”:</h5>
            <div style="max-height: 400px; overflow-y: auto; padding: 10px; background: #fafafa; border-radius: 10px;">
                ${sortedResponses.map((response, index) => {
                    const isAdmin = response.user_name && (
                        response.user_name !== currentUser.full_name && 
                        response.user_name !== currentUser.username &&
                        response.user_name !== (currentUser.full_name || currentUser.username)
                    );
                    const isNew = new Date(response.created_at) > new Date(Date.now() - 24 * 60 * 60 * 1000);
                    
                    return `
                        <div style="
                            background: ${isAdmin ? 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)' : 'linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%)'}; 
                            padding: 15px; 
                            margin: 10px 0; 
                            border-radius: 15px; 
                            border-right: 5px solid ${isAdmin ? '#2196f3' : '#9c27b0'};
                            position: relative;
                            ${isNew && isAdmin && !isTicketClosed ? 'box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);' : ''}
                        ">
                            ${isNew && isAdmin && !isTicketClosed ? `
                                <div style="position: absolute; top: -5px; right: -5px; background: #4caf50; color: white; 
                                           border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; 
                                           justify-content: center; font-size: 12px; font-weight: bold;">!</div>
                            ` : ''}
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong style="color: ${isAdmin ? '#1976d2' : '#7b1fa2'};">
                                    ${isAdmin ? 'ğŸ‘¨â€ğŸ’¼ ×× ×”×œ ×”×ª××™×›×”' : 'ğŸ‘¤ ' + (currentUser.full_name || currentUser.username)}
                                </strong>
                                <small style="color: #666;">
                                    ${new Date(response.created_at).toLocaleString('he-IL')}
                                    ${isNew && isAdmin && !isTicketClosed ? ' ğŸ†•' : ''}
                                </small>
                            </div>
                            <div style="color: #333; line-height: 1.5; word-wrap: break-word;">
                                ${response.content}
                            </div>
                            ${isAdmin && isNew && !isTicketClosed ? `
                                <div style="margin-top: 10px; padding: 8px; background: rgba(76, 175, 80, 0.1); 
                                           border-radius: 8px; border: 1px solid #4caf50;">
                                    <small style="color: #2e7d32; font-weight: bold;">
                                        â³ ××—×›×” ×œ×ª×’×•×‘×ª×š - ×× × ×”×©×‘ ×›×“×™ ×œ×”××©×™×š ××ª ×”×˜×™×¤×•×œ
                                    </small>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('')}
            </div>
            
            <!-- ×”×•×“×¢×” ×¢×œ ×¡×’×™×¨×ª ×›×¨×˜×™×¡ - ×¨×§ ×× ×”×›×¨×˜×™×¡ ×¡×’×•×¨ -->
            ${isTicketClosed ? `
                <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 10px; border: 2px solid #28a745; text-align: center;">
                    <h6 style="color: #155724; margin-bottom: 5px;">âœ… ×›×¨×˜×™×¡ ×¡×’×•×¨</h6>
                    <p style="color: #155724; font-size: 14px; margin: 0;">
                        ×”×›×¨×˜×™×¡ × ×¡×’×¨ ×‘×”×¦×œ×—×” !
                    </p>
                </div>
            ` : ''}
        </div>
    `;
}

// ×¤×•× ×§×¦×™×” ×œ×¡×™××•×Ÿ ×›×¨×˜×™×¡ ×›× ×§×¨×
async function markTicketAsRead(ticketId) {
    try {
        const response = await fetch(`/api/tickets/${ticketId}/mark-read`, {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            showMyTickets(); // ×¨×¢× ×•×Ÿ
        }
    } catch (error) {
        console.error('×©×’×™××” ×‘×¡×™××•×Ÿ ×›× ×§×¨×:', error);
    }
}

// ×¤×•× ×§×¦×™×” ×œ×”×•×¡×¤×ª ×ª×’×•×‘×”
function addTicketResponse(ticketId) {
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’¬ ×”×•×¡×¤×ª ×ª×’×•×‘×”</h3>
                <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>×ª×’×•×‘×” ×©×œ×š:</label>
                    <textarea id="newResponseContent" class="form-control" rows="4" 
                              placeholder="×›×ª×‘ ×ª×’×•×‘×” ××• ××™×“×¢ × ×•×¡×£..."></textarea>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="submitTicketResponse(${ticketId}); this.closest('.modal').remove();">
                        ğŸ’¬ ×©×œ×— ×ª×’×•×‘×”
                    </button>
                    <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                        âŒ ×‘×˜×œ
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

async function submitTicketResponse(ticketId) {
    const content = document.getElementById('newResponseContent').value.trim();
    
    if (!content) {
        showNotification('×× × ×”×›× ×¡ ×ª×•×›×Ÿ ×œ×ª×’×•×‘×”', 'warning');
        return;
    }
    
    try {
        const response = await fetch(`/api/tickets/${ticketId}/responses`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ content, is_internal: 0 })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×ª×’×•×‘×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”! ğŸ’¬', 'success');
            // ×¨×¢× ×•×Ÿ ×›×¨×˜×™×¡×™ ×”×ª××™×›×”
            showMyTickets();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×”×•×¡×¤×ª ×ª×’×•×‘×”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×¡×’×™×¨×ª ×›×¨×˜×™×¡ ×¤×©×•×˜×” ×œ×œ× ××©×•×‘
async function closeTicketSimple(ticketId) {
    if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×”×‘×¢×™×” × ×¤×ª×¨×” ×•×‘×¨×¦×•× ×š ×œ×¡×’×•×¨ ××ª ×”×›×¨×˜×™×¡?\n\n××—×¨×™ ×”×¡×’×™×¨×” ×œ× ×ª×•×›×œ ×œ×¤×ª×•×— ××•×ª×• ××—×“×©.')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/tickets/${ticketId}/close`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ 
                feedback: '×”××©×ª××© ×¡×’×¨ ××ª ×”×›×¨×˜×™×¡ - ×”×‘×¢×™×” × ×¤×ª×¨×”',
                user_closed: true 
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×›×¨×˜×™×¡ × ×¡×’×¨ ×‘×”×¦×œ×—×”! ğŸ‰', 'success');
            showMyTickets(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×¡×’×™×¨×ª ×›×¨×˜×™×¡', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×¡×™××•×Ÿ ×©×¢×“×™×™×Ÿ ×–×§×•×§ ×œ×¢×–×¨×”
async function markAsResolved(ticketId) {
    const additionalInfo = prompt('×× × ×ª××¨ ××” ×¢×“×™×™×Ÿ ×œ× ×¢×•×‘×“ ××• ××™×–×” ×¢×–×¨×” × ×•×¡×¤×ª ××ª×” ×¦×¨×™×š:');
    
    if (!additionalInfo) {
        return;
    }
    
    try {
        const response = await fetch(`/api/tickets/${ticketId}/responses`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ 
                content: `ğŸ”§ ×¢×“×™×™×Ÿ ×–×§×•×§ ×œ×¢×–×¨×”: ${additionalInfo}`,
                is_internal: 0 
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×”×•×“×¢×” × ×©×œ×—×” ×œ×ª××™×›×” ğŸ“¨', 'success');
            showMyTickets(); // ×¨×¢× ×•×Ÿ
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×©×œ×™×—×ª ×”×•×“×¢×”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

       function getStatusText(status) {
           const statusMap = {
               'open': '×¤×ª×•×—',
               'in_progress': '×‘×˜×™×¤×•×œ',
               'resolved': '× ×¤×ª×¨',
               'closed': '×¡×’×•×¨'
           };
           return statusMap[status] || status;
       }

       function getStatusColor(status) {
           const colorMap = {
               'open': 'btn-warning',
               'in_progress': 'btn-info',
               'resolved': 'btn-success',
               'closed': 'btn-secondary'
           };
           return colorMap[status] || 'btn-secondary';
       }

       function getCategoryText(category) {
           const categoryMap = {
               'technical': '×‘×¢×™×” ×˜×›× ×™×ª',
               'data': '×‘×¢×™×” ×‘× ×ª×•× ×™×',
               'access': '×‘×¢×™×™×ª ×’×™×©×”',
               'training': '×”×“×¨×›×”',
               'other': '××—×¨'
           };
           return categoryMap[category] || category;
       }

       function getPriorityText(priority) {
           const priorityMap = {
               'low': '× ××•×›×”',
               'medium': '×‘×™× ×•× ×™×ª',
               'high': '×’×‘×•×”×”',
               'urgent': '×“×—×•×£'
           };
           return priorityMap[priority] || priority;
       }

       // ×™×¦×™×¨×ª ×›×¨×˜×™×¡ ×ª××™×›×” ×—×“×©
       function showNewTicketForm() {
           closeModal('ticketsModal');
           openModal('newTicketModal');
       }

       document.getElementById('newTicketForm').addEventListener('submit', async function(e) {
           e.preventDefault();
           
           const formData = {
               title: document.getElementById('ticketTitle').value.trim(),
               category: document.getElementById('ticketCategory').value,
               priority: document.getElementById('ticketPriority').value,
               description: document.getElementById('ticketDescription').value.trim()
           };
           
           if (!formData.title || !formData.description) {
               showNotification('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×', 'warning');
               return;
           }
           
           try {
               const response = await fetch('/api/tickets', {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                       'Authorization': `Bearer ${authToken}`
                   },
                   body: JSON.stringify(formData)
               });
               
               const data = await response.json();
               
               if (response.ok) {
                   showNotification('×›×¨×˜×™×¡ ×”×ª××™×›×” × ×•×¦×¨ ×‘×”×¦×œ×—×”! ğŸ«', 'success');
                   closeModal('newTicketModal');
                   document.getElementById('newTicketForm').reset();
               } else {
                   showNotification(data.error || '×©×’×™××” ×‘×™×¦×™×¨×ª ×›×¨×˜×™×¡', 'error');
               }
           } catch (error) {
               showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
           }
       });

       // × ×™×”×•×œ ××•×“×œ×™×
       function openModal(modalId) {
           document.getElementById(modalId).classList.add('show');
           document.body.style.overflow = 'hidden'; // ×× ×™×¢×ª ×’×œ×™×œ×” ×‘×¨×§×¢
       }

       function closeModal(modalId) {
           document.getElementById(modalId).classList.remove('show');
           document.body.style.overflow = 'auto'; // ×”×—×–×¨×ª ×’×œ×™×œ×”
       }

       // ×¡×’×™×¨×ª ××•×“×œ×™× ×‘×œ×—×™×¦×” ×¢×œ ×”×¨×§×¢
       document.addEventListener('click', function(e) {
           if (e.target.classList.contains('modal')) {
               e.target.classList.remove('show');
               document.body.style.overflow = 'auto';
           }
       });

       // ×× ×™×¢×ª ×¡×’×™×¨×ª ××•×“×œ ×‘×œ×—×™×¦×” ×¢×œ ×”×ª×•×›×Ÿ
       document.querySelectorAll('.modal-content').forEach(content => {
           content.addEventListener('click', function(e) {
               e.stopPropagation();
           });
       });

       // ×¡×’×™×¨×” ×‘××§×© Escape
       document.addEventListener('keydown', function(e) {
           if (e.key === 'Escape') {
               const openModals = document.querySelectorAll('.modal.show');
               openModals.forEach(modal => {
                   modal.classList.remove('show');
                   document.body.style.overflow = 'auto';
               });
           }
       });

       // ×”×ª× ×ª×§×•×ª
       function logout() {
           if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª× ×ª×§?')) {
               console.log('ğŸ‘‹ ××ª× ×ª×§...');
               localStorage.removeItem('authToken');
               localStorage.removeItem('currentUser');
               localStorage.removeItem('recentSearches');
               window.location.href = 'login.html';
           }
       }

       // ×”×¦×’×ª ×”×•×“×¢×•×ª ×–×× ×™×•×ª
       function showNotification(message, type = 'info', duration = 4000) {
           // ×”×¡×¨×ª ×”×•×“×¢×•×ª ×§×•×“××•×ª
           const existingNotifications = document.querySelectorAll('.notification-toast');
           existingNotifications.forEach(n => n.remove());
           
           // ×™×¦×™×¨×ª ×”×•×“×¢×” ×—×“×©×”
           const notification = document.createElement('div');
           notification.className = `notification-toast message ${type}`;
           notification.style.cssText = `
               position: fixed;
               top: 20px;
               left: 50%;
               transform: translateX(-50%);
               z-index: 9999;
               min-width: 300px;
               max-width: 500px;
               text-align: center;
               box-shadow: 0 8px 32px rgba(0,0,0,0.3);
               animation: slideDown 0.3s ease;
           `;
           
           notification.innerHTML = `
               <div style="display: flex; align-items: center; justify-content: space-between;">
                   <span>${message}</span>
                   <button onclick="this.parentElement.parentElement.remove()" 
                           style="background: none; border: none; color: inherit; cursor: pointer; font-size: 18px; margin-right: 10px;">
                       Ã—
                   </button>
               </div>
           `;
           
           document.body.appendChild(notification);
           
           // ×”×¡×¨×” ××•×˜×•××˜×™×ª
           setTimeout(() => {
               if (notification.parentNode) {
                   notification.style.animation = 'slideUp 0.3s ease';
                   setTimeout(() => notification.remove(), 300);
               }
           }, duration);
       }

       // ×˜×¢×™× ×ª API × ×•×¡×£ ×œ×”×¢×¨×•×ª ×”××™×©×™×•×ª
       async function loadMyNotesAPI() {
           try {
               const response = await fetch('/api/my-notes', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (response.ok) {
                   return await response.json();
               } else {
                   throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¢×¨×•×ª');
               }
           } catch (error) {
               console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¢×¨×•×ª:', error);
               return [];
           }
       }

       // ××™×¨×•×¢×™ ××§×œ×“×ª ×›×œ×œ×™×™×
       document.addEventListener('keydown', function(e) {
           // Ctrl/Cmd + K = ×¤×•×§×•×¡ ×¢×œ ×—×™×¤×•×©
           if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
               e.preventDefault();
               document.getElementById('phoneSearch').focus();
               document.getElementById('phoneSearch').select();
           }
           
           // Ctrl/Cmd + Enter = ×—×™×¤×•×© ××”×™×¨
           if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
               e.preventDefault();
               searchDonor();
           }
           
           // Ctrl/Cmd + L = × ×™×§×•×™
           if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
               e.preventDefault();
               clearSearch();
           }
       });

       // ×‘×“×™×§×ª ×—×™×‘×•×¨ ×ª×§×•×¤×ª×™×ª
       setInterval(async () => {
           try {
               const response = await fetch('/api/stats', {
                   headers: { 'Authorization': `Bearer ${authToken}` }
               });
               
               if (!response.ok) {
                   if (response.status === 401 || response.status === 403) {
                       showNotification('×”×—×™×‘×•×¨ ×¤×’ ×ª×•×§×£ - ××¤× ×” ×œ×“×£ ×”×ª×—×‘×¨×•×ª', 'warning');
                       setTimeout(() => logout(), 2000);
                   }
               }
           } catch (error) {
               console.warn('âš ï¸ ×‘×¢×™×™×ª ×—×™×‘×•×¨ ×–×× ×™×ª ×œ×©×¨×ª');
           }
       }, 300000); // ×›×œ 5 ×“×§×•×ª

       // ×©××™×¨×ª ××¦×‘ ×‘×–××Ÿ ×¢×–×™×‘×ª ×”×“×£
       window.addEventListener('beforeunload', function() {
           localStorage.setItem('lastSearch', document.getElementById('phoneSearch').value);
           localStorage.setItem('searchStats', JSON.stringify(searchStats));
		   localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
       });

       // ×©×—×–×•×¨ ××¦×‘ ×‘×—×–×¨×” ×œ×“×£
       window.addEventListener('focus', function() {
           const lastSearch = localStorage.getItem('lastSearch');
           if (lastSearch && !document.getElementById('phoneSearch').value) {
               document.getElementById('phoneSearch').value = lastSearch;
           }
           
           const savedStats = localStorage.getItem('searchStats');
           if (savedStats) {
               searchStats = { ...searchStats, ...JSON.parse(savedStats) };
               updateStatsDisplay();
           }
       });

       // ×”×•×¡×¤×ª ×¡×’× ×•× ×•×ª CSS × ×•×¡×¤×™× ×‘××•×¤×Ÿ ×“×™× ××™
       const additionalStyles = `
           @keyframes slideDown {
               from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
               to { opacity: 1; transform: translateX(-50%) translateY(0); }
           }
           
           @keyframes slideUp {
               from { opacity: 1; transform: translateX(-50%) translateY(0); }
               to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
           }
           
           .search-input:focus {
               border-color: var(--primary-color);
               box-shadow: 0 0 0 5px rgba(102, 126, 234, 0.2);
               transform: scale(1.01);
           }
           
           .donor-card {
               transition: all 0.3s ease;
           }
           
           .donor-card:hover {
               transform: translateY(-5px);
               box-shadow: 0 15px 40px rgba(0,0,0,0.15);
           }
           
           .btn {
               transition: all 0.2s ease;
               position: relative;
               overflow: hidden;
           }
           
           .btn::before {
               content: '';
               position: absolute;
               top: 50%;
               left: 50%;
               width: 0;
               height: 0;
               background: rgba(255,255,255,0.2);
               border-radius: 50%;
               transform: translate(-50%, -50%);
               transition: width 0.3s, height 0.3s;
           }
           
           .btn:active::before {
               width: 300px;
               height: 300px;
           }
           
           .stat-card {
               transition: all 0.3s ease;
               cursor: pointer;
           }
           
           .stat-card:hover {
               transform: translateY(-8px);
               box-shadow: 0 20px 40px rgba(0,0,0,0.2);
           }
           
           .nav-tab {
               transition: all 0.3s ease;
               position: relative;
           }
           
           .nav-tab::after {
               content: '';
               position: absolute;
               bottom: 0;
               left: 50%;
               width: 0;
               height: 3px;
               background: var(--primary-color);
               transition: all 0.3s ease;
               transform: translateX(-50%);
           }
           
           .nav-tab.active::after {
               width: 80%;
           }
           
           .field-value:hover {
               border-color: var(--primary-color);
               transform: translateY(-1px);
           }
           
           .loading-spinner {
               border-color: #f3f3f3;
               border-top-color: var(--primary-color);
           }
           
           .dark-mode .loading-spinner {
               border-color: #444;
               border-top-color: #3498db;
           }
           
           /* ×”×“×’×©×ª ×ª×•×¦××•×ª ×—×™×¤×•×© */
           .highlight {
               background: yellow;
               padding: 2px 4px;
               border-radius: 3px;
               font-weight: bold;
           }
           
           .dark-mode .highlight {
               background: #f39c12;
               color: #2c3e50;
           }
       `;

       // ×”×•×¡×¤×ª ×”×¡×’× ×•× ×•×ª ×œ×“×£
       const styleSheet = document.createElement('style');
       styleSheet.textContent = additionalStyles;
       document.head.appendChild(styleSheet);

       // ×”×•×“×¢×ª ×‘×¨×•×›×™× ×”×‘××™× ×œ××—×¨ ×˜×¢×™× ×” ××œ××”
       setTimeout(() => {
           if (currentUser) {
               const welcomeMsg = currentUser.full_name ? 
                   `×‘×¨×•×š ×”×‘× ${currentUser.full_name}! ğŸ‘‹` : 
                   `×‘×¨×•×š ×”×‘× ${currentUser.username}! ğŸ‘‹`;
               showNotification(welcomeMsg, 'success', 3000);
           }
       }, 1000);

async function loadDonorNotes(donorId, donorIndex) {
    try {
        const response = await fetch(`/api/donor/${donorId}/notes`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            const notes = await response.json();
            displayDonorNotes(notes, donorIndex);
        }
    } catch (error) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¢×¨×•×ª:', error);
    }
}

// ×”×¦×’×ª ×”×¢×¨×•×ª ×”×ª×•×¨×
function displayDonorNotes(notes, donorIndex) {
    const container = document.getElementById(`notes_${donorIndex}`);
    if (!container) return;
    
    if (notes.length === 0) {
        container.innerHTML = `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; color: #666;">
                ğŸ“ ××™×Ÿ ×”×¢×¨×•×ª ×¢×œ ×”×ª×•×¨×
            </div>
        `;
        return;
    }
    
    container.innerHTML = `
        <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 15px 0; border-right: 4px solid #ffc107;">
            <h5 style="color: #856404; margin-bottom: 15px;">ğŸ’¬ ×”×¢×¨×•×ª ×¢×œ ×”×ª×•×¨×:</h5>
            ${notes.map(note => `
                <div style="background: white; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ffeaa7;">
                    <div style="font-size: 14px; line-height: 1.5; margin-bottom: 8px;">
                        ${note.note}
                    </div>
                    <small style="color: #856404; font-size: 12px;">
                        ğŸ“ ×”×¢×¨×” ×¢"×™ ${note.user_name} | 
                        ğŸ“… ${new Date(note.created_at).toLocaleDateString('he-IL')} ${new Date(note.created_at).toLocaleTimeString('he-IL')}
                    </small>
                </div>
            `).join('')}
        </div>
    `;
}

// ×”×•×¡×¤×ª ×”×¢×¨×” ×—×“×©×”
function addNote(donorId) {
    currentDonorId = donorId;
    openModal('noteModal');
    document.getElementById('noteContent').focus();
}

// ×¢×“×›×Ÿ ××ª ×”-event listener ×œ×˜×•×¤×¡ ×”×”×¢×¨×•×ª ×‘-index.html
document.getElementById('noteForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const note = document.getElementById('noteContent').value.trim();
    
    if (!note) {
        showNotification('×× × ×”×›× ×¡ ×ª×•×›×Ÿ ×œ×”×¢×¨×”', 'warning');
        return;
    }
    
    try {
        const response = await fetch(`/api/donor/${currentDonorId}/note`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ note })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×”×¢×¨×” × ×©××¨×” ×‘×”×¦×œ×—×”! ğŸ“', 'success');
            closeModal('noteModal');
            document.getElementById('noteForm').reset();
            
            // ×¨×¢× ×•×Ÿ ×”×”×¢×¨×•×ª ×‘×›×¨×˜×™×¡ ×”×ª×•×¨×
            const donorCards = document.querySelectorAll('.donor-card');
            donorCards.forEach((card, index) => {
                const notesContainer = document.getElementById(`notes_${index}`);
                if (notesContainer) {
                    loadDonorNotes(currentDonorId, index);
                }
            });
            
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×©××™×¨×ª ×”×¢×¨×”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
});

// ×”×•×¡×£ ××ª ×”×¤×•× ×§×¦×™×•×ª ×”××œ×” ×œ×ª×•×š ×ª×’ <script> ×”×§×™×™×

// ×˜×™×¤×•×œ ×‘×§×œ×˜ ×—×™×¤×•×© ×‘×“×£ ×”×ª×¨××”
function handleDonationSearchInput(input) {
    const value = input.value;
    const counter = document.getElementById('donationCharCounter');
    
    if (value.length === 0) {
        counter.textContent = '× ×“×¨×©×™× ×œ×¤×—×•×ª 7 ×ª×•×•×™×';
        counter.classList.remove('warning');
        input.classList.remove('error');
        hideDonationResults();
    } else if (value.length < 7) {
        counter.textContent = `× ×“×¨×©×™× ×¢×•×“ ${7 - value.length} ×ª×•×•×™×`;
        counter.classList.add('warning');
        input.classList.add('error');
        hideDonationResults();
    } else {
        counter.textContent = `âœ“ ××—×¤×©... (${value.length} ×ª×•×•×™×)`;
        counter.classList.remove('warning');
        input.classList.remove('error');
        
        // ×—×™×¤×•×© ××•×˜×•××˜×™
        searchDonorForDonation(value);
    }
}

// ×—×™×¤×•×© ×ª×•×¨× ×œ×¦×•×¨×š ×”×ª×¨××”
async function searchDonorForDonation(phone) {
    const cleanPhone = phone.replace(/[-\s()]/g, '');
    
    console.log('ğŸ” ××—×¤×© ×ª×•×¨× ×œ×ª×¨×•××”:', cleanPhone);
    
    // ×”×¦×’×ª ××¡×š ×˜×¢×™× ×”
    showDonationSearchLoading(true);
    
    try {
        const response = await fetch(`/api/search/${encodeURIComponent(cleanPhone)}`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
            if (data.length === 0) {
                showDonationNoResults();
            } else {
                displayDonationResults(data);
            }
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×—×™×¤×•×©', 'error');
            hideDonationResults();
        }
    } catch (error) {
        console.error('âŒ ×©×’×™××” ×‘×—×™×¤×•×© ×ª×•×¨× ×œ×ª×¨×•××”:', error);
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
        hideDonationResults();
    } finally {
        showDonationSearchLoading(false);
    }
}

// ×”×¦×’×ª ××¦×‘ ×˜×¢×™× ×” ×‘×—×™×¤×•×© ×”×ª×¨××”
function showDonationSearchLoading(loading) {
    const container = document.getElementById('donationSearchResults');
    const loadingMsg = document.getElementById('donationLoadingMessage');
    const noResults = document.getElementById('donationNoResults');
    const resultsData = document.getElementById('donationResultsData');
    
    if (loading) {
        container.classList.remove('hidden');
        loadingMsg.classList.remove('hidden');
        noResults.classList.add('hidden');
        resultsData.innerHTML = '';
    } else {
        loadingMsg.classList.add('hidden');
    }
}

// ×”×¦×’×ª "××™×Ÿ ×ª×•×¦××•×ª" ×‘×—×™×¤×•×© ×”×ª×¨××”
function showDonationNoResults() {
    document.getElementById('donationNoResults').classList.remove('hidden');
}

// ×”×¡×ª×¨×ª ×ª×•×¦××•×ª ×—×™×¤×•×© ×”×ª×¨××”
function hideDonationResults() {
    document.getElementById('donationSearchResults').classList.add('hidden');
}

// ×”×¦×’×ª ×ª×•×¦××•×ª ×—×™×¤×•×© ×œ×ª×¨×•××”
// ×¢×“×›×•×Ÿ ×¤×•× ×§×¦×™×™×ª ×”×¦×’×ª ×”×ª×•×¦××•×ª
function displayDonationResults(donors) {
    console.log('ğŸ“‹ ××¦×™×’ ×ª×•×¦××•×ª ×ª×¨×•××”:', donors.length, '×ª×•×¨××™×');
    
    const container = document.getElementById('donationResultsData');
    container.innerHTML = '';
    
    donors.forEach((donor, index) => {
        const card = document.createElement('div');
        card.className = 'donation-donor-card';
        
        const donationsCount = donor.donations_count || 1;
        const totalDonated = donor.total_donated || 0;
        
        // ×¤×™×¦×•×œ ×©× ××œ× ×œ×©× ×¤×¨×˜×™ ×•××©×¤×—×”
        const fullName = donor.full_name || '';
        const nameParts = fullName.trim().split(' ');
        const firstName = nameParts[0] || '';
        const lastName = nameParts.slice(1).join(' ') || '';
        
        card.innerHTML = `
<div class="donation-donor-summary" onclick="toggleDonationDonorCard(${index})">
    <div class="donor-summary-content">
        <div class="donor-info">
            <h5 class="donor-name">
                <span class="donor-number">${index + 1}</span>
                ğŸ‘¤ ${fullName || '×ª×•×¨× ×œ× ×™×“×•×¢'}
            </h5>
            <p class="donor-meta">
                ğŸ“ ${donor.phone || '×œ×œ× ×˜×œ×¤×•×Ÿ'} â€¢ ğŸ’° ×¡×”"×› ×ª×¨×•××•×ª: â‚ª${totalDonated.toLocaleString()}
            </p>
        </div>
        <span class="expand-icon-donation" id="donation_icon_${index}">â–¼</span>
    </div>
</div>

<div class="donation-donor-details" id="donation_details_${index}">
    <div class="donation-donor-field">
        <span class="donation-field-icon">ğŸ‘¤</span>
        <div>
            <div class="donation-field-label">×©× ×¤×¨×˜×™</div>
            <input type="text" class="donation-field-value" value="${firstName}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${firstName}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    
    <div class="donation-donor-field">
        <span class="donation-field-icon">ğŸ‘¥</span>
        <div>
            <div class="donation-field-label">×©× ××©×¤×—×”</div>
            <input type="text" class="donation-field-value" value="${lastName}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${lastName}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    
    <div class="donation-donor-field">
        <span class="donation-field-icon">ğŸ“±</span>
        <div>
            <div class="donation-field-label">×˜×œ×¤×•×Ÿ</div>
            <input type="text" class="donation-field-value" value="${donor.phone || ''}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${donor.phone || ''}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    
    <div class="donation-donor-field">
        <span class="donation-field-icon">âœ‰ï¸</span>
        <div>
            <div class="donation-field-label">××™××™×™×œ</div>
            <input type="text" class="donation-field-value" value="${donor.email || ''}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${donor.email || ''}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    
    ${donor.city ? `
    <div class="donation-donor-field">
        <span class="donation-field-icon">ğŸ™ï¸</span>
        <div>
            <div class="donation-field-label">×¢×™×¨</div>
            <input type="text" class="donation-field-value" value="${donor.city}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${donor.city}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    ` : ''}
    
    ${donor.street ? `
    <div class="donation-donor-field">
        <span class="donation-field-icon">ğŸ›£ï¸</span>
        <div>
            <div class="donation-field-label">×¨×—×•×‘</div>
            <input type="text" class="donation-field-value" value="${donor.street}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${donor.street}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    ` : ''}
    
    ${donor.building ? `
    <div class="donation-donor-field">
        <span class="donation-field-icon">ğŸ¢</span>
        <div>
            <div class="donation-field-label">××¡' ×‘×™×ª</div>
            <input type="text" class="donation-field-value" value="${donor.building}" readonly>
        </div>
        <button class="btn btn-success btn-sm" onclick="copyText('${donor.building}', this); showNotification('ğŸ“‹ ×”×•×¢×ª×§!', 'success', 1500);" style="padding: 6px 10px; font-size: 11px;">×”×¢×ª×§</button>
    </div>
    ` : ''}
</div>
        `;
        
        container.appendChild(card);
    });
}

// ×¤×ª×™×—×”/×¡×’×™×¨×” ×©×œ ×›×¨×˜×™×¡ ×ª×•×¨× ×‘×“×£ ×”×ª×¨××”
function toggleDonationDonorCard(donorIndex) {
    const details = document.getElementById(`donation_details_${donorIndex}`);
    const icon = document.getElementById(`donation_icon_${donorIndex}`);
    
    if (details.style.display === 'none' || details.style.display === '') {
        details.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
        
        // ×× ×™××¦×™×”
        details.style.opacity = '0';
        setTimeout(() => {
            details.style.transition = 'opacity 0.3s ease';
            details.style.opacity = '1';
        }, 10);
        
    } else {
        details.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
    }
}

// ×”×¢×ª×§×ª ×›×œ ×¤×¨×˜×™ ×”×ª×•×¨× ×‘×“×£ ×”×ª×¨××”
function copyAllDonorInfoDonation(donorIndex) {
    const card = document.querySelectorAll('.donation-donor-card')[donorIndex];
    const fields = card.querySelectorAll('.donation-donor-field');
    
    let donorText = '×¤×¨×˜×™ ×ª×•×¨×:\n';
    donorText += '='.repeat(20) + '\n';
    
    fields.forEach(field => {
        const label = field.querySelector('.donation-field-label').textContent;
        const value = field.querySelector('.donation-field-value').value;
        if (value && value.trim() !== '') {
            donorText += `${label}: ${value}\n`;
        }
    });
    
    copyText(donorText, card.querySelector('.btn'));
    showNotification('×¤×¨×˜×™ ×”×ª×•×¨× ×”×•×¢×ª×§×•! ğŸ“‹', 'success');
}

console.log('âœ… ×¤×•× ×§×¦×™×•×ª ×—×™×¤×•×© ×ª×•×¨××™× ×‘×“×£ ×”×ª×¨××” × ×•×¡×¤×•!');

       console.log('âœ… ×××©×§ ×˜×œ×¤×Ÿ ×”×•×›×Ÿ ×‘××œ×•××•!');
   </script>
</body>
</html>