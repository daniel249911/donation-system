<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×× ×œ × ×™×”×•×œ ××“××™×Ÿ - ××¢×¨×›×ª ×ª×•×¨××™×</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --admin-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            --success-gradient: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            --warning-gradient: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            --info-gradient: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            --danger-gradient: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            --dark-gradient: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            
            --primary-color: #667eea;
            --admin-primary: #ff6b6b;
            --admin-secondary: #ee5a24;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --info-color: #74b9ff;
            --danger-color: #fd79a8;
            --dark-color: #2d3436;
            
            --bg-light: #f8fafc;
            --bg-card: #ffffff;
            --bg-input: #f1f3f4;
            --border-color: #e2e8f0;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            --shadow-2xl: 0 25px 50px rgba(0,0,0,0.25);
            
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 20px;
            
            --font-sm: 0.875rem;
            --font-base: 1rem;
            --font-lg: 1.125rem;
            --font-xl: 1.25rem;
            --font-2xl: 1.5rem;
            --font-3xl: 1.875rem;
            --font-4xl: 2.25rem;
        }
        
        body { 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #e2e8f0;
            --bg-light: #1a202c;
            --bg-card: #2d3748;
            --bg-input: #4a5568;
            --border-color: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #cbd5e0;
            --text-muted: #a0aec0;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 24px; 
        }
        
        /* Header */
        .admin-header { 
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: white;
            border-radius: var(--radius-2xl);
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-2xl);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--admin-gradient);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }
        
        .admin-header::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            animation: floating 8s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px) translateX(0px); }
            50% { transform: translateY(-20px) translateX(20px); }
        }
        
        .admin-header h1 {
            font-size: var(--font-4xl);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .admin-subtitle {
            font-size: var(--font-lg);
            opacity: 0.9;
            margin-bottom: 24px;
            position: relative;
            z-index: 2;
            font-weight: 400;
        }
        
        .admin-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }
        
        .admin-welcome {
            background: rgba(255,255,255,0.15);
            padding: 12px 24px;
            border-radius: var(--radius-2xl);
            font-weight: 600;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: var(--shadow-lg);
        }
        
        /* Modern Buttons */
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius-lg);
            font-size: var(--font-sm);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            letter-spacing: 0.025em;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        .btn:active {
            transform: translateY(0) scale(0.98);
        }
        
        .btn-admin { 
            background: var(--admin-gradient);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        .btn-admin:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }
        
        .btn-sm { 
            padding: 8px 16px; 
            font-size: 11px; 
        }
        .btn-lg { 
            padding: 16px 32px; 
            font-size: var(--font-base); 
            border-radius: var(--radius-xl);
        }
        
        .btn-danger { 
            background: var(--danger-gradient);
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.4);
        }
        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(253, 121, 168, 0.6);
        }
        
        .btn-success { 
            background: var(--success-gradient);
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
        }
        .btn-success:hover {
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.6);
        }
        
        .btn-warning { 
            background: var(--warning-gradient);
            color: #2d3436;
            box-shadow: 0 4px 15px rgba(253, 203, 110, 0.4);
        }
        .btn-warning:hover {
            box-shadow: 0 8px 25px rgba(253, 203, 110, 0.6);
        }
        
        .btn-info { 
            background: var(--info-gradient);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);
        }
        .btn-info:hover {
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.6);
        }
        
        .btn-secondary { 
            background: var(--dark-gradient);
            box-shadow: 0 4px 15px rgba(45, 52, 54, 0.4);
        }
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(45, 52, 54, 0.6);
        }
        
        /* Modern Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            opacity: 0.5;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2xl);
            border-color: var(--primary-color);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }
        
        .card-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--admin-gradient);
            border-radius: 2px;
        }
        
        .card-title {
            font-size: var(--font-2xl);
            font-weight: 700;
            color: var(--admin-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0;
        }
        
        .dark-mode .card-title {
            color: #ff6b6b;
        }
        
        /* Modern Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: var(--bg-card);
            padding: 32px;
            border-radius: var(--radius-2xl);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--admin-gradient);
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,107,107,0.05) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover::after {
            transform: scale(1);
        }
        
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-2xl);
            border-color: var(--admin-primary);
        }
        
        .stat-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 8px;
            display: block;
            position: relative;
            z-index: 2;
            background: var(--admin-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--text-secondary);
            position: relative;
            z-index: 2;
        }
        
        .stat-change {
            font-size: var(--font-sm);
            margin-top: 12px;
            padding: 6px 12px;
            border-radius: var(--radius-2xl);
            background: rgba(0,184,148,0.1);
            color: var(--success-color);
            font-weight: 600;
            position: relative;
            z-index: 2;
        }
        
        /* Modern Navigation */
        .admin-nav {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 8px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: 4px;
            overflow-x: auto;
            position: sticky;
            top: 24px;
            z-index: 100;
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
        }
        
        .nav-tab {
            padding: 16px 24px;
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            font-weight: 600;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        .nav-tab:hover {
            background: var(--bg-light);
            color: var(--admin-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .nav-tab.active {
            background: var(--admin-gradient);
            color: white;
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid var(--admin-primary);
        }
        
        /* Modern Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-2xl);
            background: var(--bg-card);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-sm);
        }
        
        .table th,
        .table td {
            padding: 20px 16px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table th {
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-card) 100%);
            font-weight: 700;
            color: var(--admin-primary);
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .table tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .table tbody tr:hover {
            background: linear-gradient(135deg, var(--bg-light) 0%, rgba(255,107,107,0.05) 100%);
            transform: scale(1.01);
            box-shadow: var(--shadow-md);
        }
        
        .table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .table tbody tr.selected {
            background: linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,107,107,0.05) 100%);
            border-left: 4px solid var(--admin-primary);
        }
        
        /* Modern Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }
        
        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: var(--font-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-input);
            color: var(--text-primary);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--admin-primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
            transform: translateY(-1px);
            background: var(--bg-card);
        }
        
        /* Search and Filters */
        .search-filters {
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-card) 100%);
            padding: 24px;
            border-radius: var(--radius-2xl);
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            align-items: end;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        /* Modern Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(12px);
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 32px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-2xl);
            border: 1px solid var(--border-color);
        }
        
        @keyframes modalSlide {
            from { 
                opacity: 0; 
                transform: scale(0.9) translateY(-30px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }
        
        .modal-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--admin-gradient);
            border-radius: 2px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            color: var(--danger-color);
            background: rgba(253, 121, 168, 0.1);
            transform: rotate(90deg) scale(1.1);
        }
        
        /* Modern Messages */
        .message {
            padding: 20px 24px;
            border-radius: var(--radius-xl);
            margin-bottom: 16px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 16px;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            box-shadow: var(--shadow-md);
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .message.success {
            background: linear-gradient(135deg, rgba(0,184,148,0.1) 0%, rgba(0,184,148,0.05) 100%);
            color: #00695c;
            border-color: var(--success-color);
        }
        
        .message.error {
            background: linear-gradient(135deg, rgba(253,121,168,0.1) 0%, rgba(253,121,168,0.05) 100%);
            color: #ad1457;
            border-color: var(--danger-color);
        }
        
        .message.warning {
            background: linear-gradient(135deg, rgba(253,203,110,0.1) 0%, rgba(253,203,110,0.05) 100%);
            color: #f57f17;
            border-color: var(--warning-color);
        }
        
        .message.info {
            background: linear-gradient(135deg, rgba(116,185,255,0.1) 0%, rgba(116,185,255,0.05) 100%);
            color: #1565c0;
            border-color: var(--info-color);
        }
        
        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .chart-container {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }
        
        .chart-container h3,
        .chart-container h5 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-weight: 700;
        }
        
        /* Upload Area */
        .upload-area {
            border: 3px dashed var(--admin-primary);
            border-radius: var(--radius-2xl);
            padding: 48px 32px;
            text-align: center;
            margin-bottom: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, rgba(255,107,107,0.05) 0%, rgba(255,107,107,0.02) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,107,107,0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.3; }
        }
        
        .upload-area:hover {
            border-color: var(--admin-secondary);
            background: linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,107,107,0.05) 100%);
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .upload-area.dragover {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(0,184,148,0.1) 0%, rgba(0,184,148,0.05) 100%);
        }
        
        .upload-area > * {
            position: relative;
            z-index: 2;
        }
        
        /* Loading States */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--admin-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-muted);
        }
		
		.empty-state-icon {
           font-size: 80px;
           margin-bottom: 24px;
           opacity: 0.6;
           filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
       }
       
       .empty-state h3 {
           margin-bottom: 16px;
           color: var(--text-secondary);
           font-size: var(--font-2xl);
           font-weight: 600;
       }
       
       .empty-state p {
           font-size: var(--font-lg);
           margin-bottom: 24px;
           line-height: 1.6;
       }
       
       /* Modern Badges */
       .badge {
           display: inline-flex;
           align-items: center;
           padding: 6px 12px;
           border-radius: var(--radius-2xl);
           font-size: 11px;
           font-weight: 700;
           text-transform: uppercase;
           letter-spacing: 0.05em;
           box-shadow: var(--shadow-sm);
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
       }
       
       .badge:hover {
           transform: scale(1.05);
           box-shadow: var(--shadow-md);
       }
       
       .badge-success { 
           background: linear-gradient(135deg, var(--success-color) 0%, #00a085 100%);
           color: white; 
       }
       .badge-danger { 
           background: linear-gradient(135deg, var(--danger-color) 0%, #e84393 100%);
           color: white; 
       }
       .badge-warning { 
           background: linear-gradient(135deg, var(--warning-color) 0%, #e17055 100%);
           color: #2d3436; 
       }
       .badge-info { 
           background: linear-gradient(135deg, var(--info-color) 0%, #0984e3 100%);
           color: white; 
       }
       .badge-secondary { 
           background: linear-gradient(135deg, var(--text-muted) 0%, #718096 100%);
           color: white; 
       }
       
       /* Modern Pagination */
       .pagination {
           display: flex;
           justify-content: center;
           align-items: center;
           gap: 8px;
           margin-top: 32px;
       }
       
       .pagination button {
           padding: 12px 16px;
           border: 2px solid var(--border-color);
           background: var(--bg-card);
           border-radius: var(--radius-lg);
           cursor: pointer;
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
           font-weight: 600;
           color: var(--text-primary);
           min-width: 44px;
           box-shadow: var(--shadow-sm);
       }
       
       .pagination button:hover {
           background: var(--admin-primary);
           color: white;
           border-color: var(--admin-primary);
           transform: translateY(-2px);
           box-shadow: var(--shadow-md);
       }
       
       .pagination button.active {
           background: var(--admin-gradient);
           color: white;
           border-color: var(--admin-primary);
           box-shadow: var(--shadow-lg);
       }
       
       .pagination button:disabled {
           opacity: 0.4;
           cursor: not-allowed;
           transform: none;
       }
       
       .pagination button:disabled:hover {
           background: var(--bg-card);
           color: var(--text-primary);
           border-color: var(--border-color);
           transform: none;
           box-shadow: var(--shadow-sm);
       }
       
       /* Toolbar */
       .toolbar {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 24px;
           flex-wrap: wrap;
           gap: 16px;
           padding: 16px 0;
       }
       
       .toolbar-left,
       .toolbar-right {
           display: flex;
           align-items: center;
           gap: 12px;
           flex-wrap: wrap;
       }
       
       /* Dark Mode Toggle */
       .dark-mode-toggle {
           background: var(--admin-gradient);
           color: white;
           border: none;
           border-radius: var(--radius-2xl);
           padding: 12px 20px;
           cursor: pointer;
           font-size: var(--font-sm);
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
           display: flex;
           align-items: center;
           gap: 8px;
           font-weight: 600;
           box-shadow: var(--shadow-md);
       }
       
       .dark-mode-toggle:hover {
           transform: scale(1.05) translateY(-2px);
           box-shadow: var(--shadow-lg);
       }
       
       /* Selection Controls */
       .selection-controls {
           background: var(--admin-gradient);
           color: white;
           padding: 20px 24px;
           border-radius: var(--radius-xl);
           margin-bottom: 24px;
           display: none;
           align-items: center;
           justify-content: space-between;
           flex-wrap: wrap;
           gap: 16px;
           box-shadow: var(--shadow-lg);
           backdrop-filter: blur(20px);
       }
       
       .selection-controls.show {
           display: flex;
           animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
       }
       
       @keyframes slideDown {
           from { opacity: 0; transform: translateY(-20px); }
           to { opacity: 1; transform: translateY(0); }
       }
       
       /* Progress Bar */
       .progress {
           width: 100%;
           height: 12px;
           background: var(--bg-light);
           border-radius: var(--radius-lg);
           overflow: hidden;
           margin: 16px 0;
           box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
       }
       
       .progress-bar {
           height: 100%;
           background: var(--admin-gradient);
           transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
           border-radius: var(--radius-lg);
           position: relative;
       }
       
       .progress-bar::after {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           bottom: 0;
           right: 0;
           background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
           animation: progressShine 2s ease-in-out infinite;
       }
       
       @keyframes progressShine {
           0% { transform: translateX(-100%); }
           50% { transform: translateX(100%); }
           100% { transform: translateX(100%); }
       }
       
       /* Sort Indicators */
       .sort-indicator {
           margin-left: 8px;
           color: var(--text-muted);
           font-size: 12px;
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
       }
       
       .table th:hover .sort-indicator {
           color: var(--admin-primary);
           transform: scale(1.2);
       }
       
       /* Notification Toast */
       .notification-toast {
           position: fixed;
           top: 24px;
           left: 50%;
           transform: translateX(-50%);
           z-index: 9999;
           min-width: 350px;
           max-width: 600px;
           text-align: center;
           box-shadow: var(--shadow-2xl);
           animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
           backdrop-filter: blur(20px);
           border: 1px solid rgba(255,255,255,0.2);
           border-radius: var(--radius-xl);
       }
       
       /* Custom Scrollbar */
       ::-webkit-scrollbar {
           width: 8px;
           height: 8px;
       }
       
       ::-webkit-scrollbar-track {
           background: var(--bg-light);
           border-radius: var(--radius-lg);
       }
       
       ::-webkit-scrollbar-thumb {
           background: var(--admin-gradient);
           border-radius: var(--radius-lg);
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
       }
       
       ::-webkit-scrollbar-thumb:hover {
           background: linear-gradient(135deg, #ee5a24 0%, #ff6b6b 100%);
       }
       
       /* Hover Effects for Interactive Elements */
       .card:hover .card-title {
           color: var(--admin-secondary);
           transform: translateX(4px);
       }
       
       .table tbody tr:hover .btn {
           transform: scale(1.05);
       }
       
       /* Focus States */
       .btn:focus,
       .form-control:focus,
       .nav-tab:focus {
           outline: 2px solid var(--admin-primary);
           outline-offset: 2px;
       }
       
       /* Utility Classes */
       .hidden { display: none !important; }
       .text-center { text-align: center; }
       .text-right { text-align: right; }
       .text-left { text-align: left; }
       .text-muted { color: var(--text-muted); }
       .mb-0 { margin-bottom: 0; }
       .mb-10 { margin-bottom: 10px; }
       .mb-20 { margin-bottom: 20px; }
       .mt-20 { margin-top: 20px; }
       .p-20 { padding: 20px; }
       .fw-bold { font-weight: 700; }
       .fs-small { font-size: var(--font-sm); }
       .cursor-pointer { cursor: pointer; }
       
       /* Glassmorphism Effect */
       .glass {
           background: rgba(255, 255, 255, 0.1);
           backdrop-filter: blur(20px);
           border: 1px solid rgba(255, 255, 255, 0.2);
       }
       
       /* Floating Action Elements */
       .floating {
           animation: floating 3s ease-in-out infinite;
       }
       
       /* Pulse Animation for Important Elements */
       .pulse {
           animation: pulse 2s ease-in-out infinite;
       }
       
       /* Glow Effect */
       .glow {
           box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
       }
       
       .glow:hover {
           box-shadow: 0 0 30px rgba(255, 107, 107, 0.5);
       }
       
       /* Enhanced Input Focus */
       .form-control:focus {
           background: var(--bg-card);
           transform: translateY(-2px);
           box-shadow: 
               0 0 0 4px rgba(255,107,107,0.1),
               0 8px 25px rgba(0,0,0,0.1);
       }
       
       /* Modern Checkbox Styling */
       input[type="checkbox"] {
           appearance: none;
           width: 20px;
           height: 20px;
           border: 2px solid var(--border-color);
           border-radius: var(--radius-sm);
           background: var(--bg-card);
           cursor: pointer;
           transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
           position: relative;
       }
       
       input[type="checkbox"]:checked {
           background: var(--admin-gradient);
           border-color: var(--admin-primary);
           transform: scale(1.1);
       }
       
       input[type="checkbox"]:checked::after {
           content: 'âœ“';
           position: absolute;
           top: 50%;
           left: 50%;
           transform: translate(-50%, -50%);
           color: white;
           font-weight: 700;
           font-size: 12px;
       }
       
       input[type="checkbox"]:hover {
           border-color: var(--admin-primary);
           box-shadow: 0 0 0 3px rgba(255,107,107,0.1);
       }
       
       /* Responsive Design */
       @media (max-width: 1200px) {
           .stats-grid { 
               grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
           }
           .charts-grid { 
               grid-template-columns: 1fr; 
           }
           .container { 
               padding: 16px; 
           }
       }
       
       @media (max-width: 768px) {
           .admin-header { 
               padding: 24px; 
               text-align: center; 
           }
           .admin-header h1 { 
               font-size: var(--font-3xl); 
               flex-direction: column; 
           }
           .admin-controls { 
               width: 100%; 
               justify-content: center; 
           }
           .admin-nav { 
               flex-direction: column; 
               padding: 4px;
           }
           .nav-tab {
               width: 100%;
               justify-content: center;
           }
           .stats-grid { 
               grid-template-columns: 1fr; 
               gap: 16px;
           }
           .form-row { 
               grid-template-columns: 1fr; 
           }
           .search-filters { 
               grid-template-columns: 1fr; 
               padding: 16px;
           }
           .modal-content { 
               width: 95%; 
               padding: 24px; 
               margin: 16px;
           }
           .toolbar { 
               flex-direction: column; 
               align-items: stretch; 
           }
           .table-container { 
               font-size: 12px; 
           }
           .table th, 
           .table td { 
               padding: 12px 8px; 
           }
           .card {
               padding: 20px;
               margin-bottom: 20px;
           }
           .stat-card {
               padding: 24px;
           }
           .stat-number {
               font-size: 36px;
           }
       }
       
       @media (max-width: 480px) {
           .admin-header h1 { 
               font-size: var(--font-2xl); 
           }
           .stat-number { 
               font-size: 32px; 
           }
           .stat-icon { 
               font-size: 36px; 
           }
           .card { 
               padding: 16px; 
           }
           .nav-tab { 
               padding: 12px 16px; 
               font-size: 11px;
           }
           .btn {
               padding: 10px 16px;
               font-size: 11px;
           }
           .btn-lg {
               padding: 14px 24px;
               font-size: var(--font-sm);
           }
       }
       
       /* Print Styles */
       @media print {
           .admin-nav,
           .admin-controls,
           .btn,
           .modal {
               display: none !important;
           }
           
           .card {
               box-shadow: none;
               border: 1px solid #ccc;
           }
           
           body {
               background: white;
               color: black;
           }
       }
       
       /* High Contrast Mode */
       @media (prefers-contrast: high) {
           :root {
               --border-color: #000;
               --text-primary: #000;
               --bg-card: #fff;
           }
           
           .btn {
               border: 2px solid #000;
           }
       }
       
       /* Reduced Motion */
       @media (prefers-reduced-motion: reduce) {
           * {
               animation-duration: 0.01ms !important;
               animation-iteration-count: 1 !important;
               transition-duration: 0.01ms !important;
           }
       }
       
       /* Dark mode specific improvements */
       .dark-mode .table tbody tr:hover {
           background: linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,107,107,0.05) 100%);
       }
       
       .dark-mode .form-control {
           background: rgba(255,255,255,0.05);
           border-color: rgba(255,255,255,0.1);
       }
       
       .dark-mode .form-control:focus {
           background: rgba(255,255,255,0.1);
           border-color: var(--admin-primary);
       }
       
       .dark-mode .search-filters {
           background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
       }
       
       .dark-mode .upload-area {
           background: linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,107,107,0.05) 100%);
       }
       
       /* Enhanced button states */
       .btn:disabled {
           opacity: 0.6;
           cursor: not-allowed;
           transform: none !important;
       }
       
       .btn:disabled:hover {
           transform: none !important;
           box-shadow: var(--shadow-md) !important;
       }
       
       /* Table enhancements */
       .table thead th {
           background: linear-gradient(135deg, var(--bg-light) 0%, rgba(255,107,107,0.05) 100%);
           border-bottom: 2px solid var(--admin-primary);
       }
       
       /* Enhanced modal backdrop */
       .modal {
           background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(45,52,54,0.6) 100%);
       }
       
       /* Selection highlight */
       ::selection {
           background: rgba(255,107,107,0.2);
           color: var(--text-primary);
       }
       
       /* Enhanced focus rings */
       *:focus-visible {
           outline: 2px solid var(--admin-primary);
           outline-offset: 2px;
           border-radius: var(--radius-sm);
       }
   </style>
</head>
<body>
   <!-- ×›×•×ª×¨×ª ××“××™×Ÿ -->
   <div class="container">
       <div class="admin-header">
           <h1>
               ×¤×× ×œ × ×™×”×•×œ ××“××™×Ÿ
           </h1>
           <p class="admin-subtitle">
               × ×™×”×•×œ ××œ× ×©×œ ××¢×¨×›×ª ×”×ª×•×¨××™× - ×’×™×©×” ××ª×§×“××ª ×œ×× ×”×œ×™ ×”××¢×¨×›×ª
           </p>
           <div class="admin-controls">
               <div class="admin-welcome" id="adminWelcome">
                   ×©×œ×•× ××“××™×Ÿ
               </div>
               <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                   <span id="darkModeIcon">ğŸŒ™</span>
                   <span id="darkModeText">××¦×‘ ×œ×™×œ×”</span>
               </button>
               <button class="btn btn-warning btn-sm" onclick="showSystemSettings()">
                   âš™ï¸ ×”×’×“×¨×•×ª ××¢×¨×›×ª
               </button>
               <button class="btn btn-info btn-sm" onclick="exportSystemData()">
                   ğŸ’¾ ×’×™×‘×•×™ ××¢×¨×›×ª
               </button>
               <button class="btn btn-danger" onclick="logout()">
                   ğŸšª ×”×ª× ×ª×§
               </button>
           </div>
       </div>

       <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ×¨××©×™×•×ª -->
       <div class="stats-grid">
           <div class="stat-card" onclick="showTab('donors')">
               <span class="stat-icon">ğŸ‘¥</span>
               <span class="stat-number" id="totalDonors">0</span>
               <span class="stat-label">×¡×”"×› ×ª×•×¨××™×</span>
               <div class="stat-change" id="donorsChange">+0 ×”×©×‘×•×¢</div>
           </div>
           
           <div class="stat-card" onclick="showTab('users')">
               <span class="stat-icon">ğŸ‘¤</span>
               <span class="stat-number" id="totalUsers">0</span>
               <span class="stat-label">××©×ª××©×™ ××¢×¨×›×ª</span>
               <div class="stat-change" id="usersChange">+0 ×”×—×•×“×©</div>
           </div>
           
           <div class="stat-card" onclick="showTab('reports')">
               <span class="stat-icon">ğŸ”</span>
               <span class="stat-number" id="totalSearches">0</span>
               <span class="stat-label">×—×™×¤×•×©×™× ×”×™×•×</span>
               <div class="stat-change" id="searchesChange">+0% ×××ª××•×œ</div>
           </div>
           
           <div class="stat-card" onclick="showTicketsOverview()">
               <span class="stat-icon">ğŸ«</span>
               <span class="stat-number" id="openTickets">0</span>
               <span class="stat-label">×›×¨×˜×™×¡×™ ×ª××™×›×” ×¤×ª×•×—×™×</span>
               <div class="stat-change" id="ticketsChange">-0 ×××ª××•×œ</div>
           </div>
           
           <div class="stat-card" onclick="showSystemHealth()">
               <span class="stat-icon">ğŸ’¾</span>
               <span class="stat-number" id="systemHealth">100%</span>
               <span class="stat-label">×ª×§×™× ×•×ª ××¢×¨×›×ª</span>
               <div class="stat-change">ğŸŸ¢ ×¤×¢×™×œ×”</div>
           </div>
           
           <div class="stat-card" onclick="showTab('reports')">
               <span class="stat-icon">ğŸ“Š</span>
               <span class="stat-number" id="dailyActivity">0</span>
               <span class="stat-label">×¤×¢×™×œ×•×ª ×™×•××™×ª</span>
               <div class="stat-change">ğŸ“ˆ ×××•×¦×¢ ×©×‘×•×¢×™</div>
           </div>
       </div>

      <!-- × ×™×•×•×˜ ×¨××©×™ -->
      <div class="admin-nav">
          <div class="nav-tab active" onclick="showTab('dashboard')">
              ğŸ“Š ×œ×•×— ×‘×§×¨×”
          </div>
          <div class="nav-tab" onclick="showTab('donors')">
              ğŸ‘¥ × ×™×”×•×œ ×ª×•×¨××™×
          </div>
          <div class="nav-tab" onclick="showTab('users')">
              ğŸ”§ × ×™×”×•×œ ××©×ª××©×™×
          </div>
          <div class="nav-tab" onclick="showTab('reports')">
              ğŸ“ˆ ×“×•×—×•×ª ×•×¡×˜×˜×™×¡×˜×™×§×•×ª
          </div>
          <div class="nav-tab" onclick="showTab('upload')">
              ğŸ“„ ×”×¢×œ××ª ×§×‘×¦×™×
          </div>
          <div class="nav-tab" onclick="showTab('messages')">
              ğŸ’¬ × ×™×”×•×œ ×”×•×“×¢×•×ª
          </div>
          <div class="nav-tab" onclick="showTab('tickets')">
              ğŸ« ×›×¨×˜×™×¡×™ ×ª××™×›×”
          </div>
          <div class="nav-tab" onclick="showTab('logs')">
              ğŸ“‹ ×œ×•×’×™ ××¢×¨×›×ª
          </div>
         <div class="nav-tab" onclick="showTab('donation-management')">
             ğŸ’³ × ×™×”×•×œ ×ª×¨×•××•×ª
         </div>
      </div>

      <!-- ×ª×•×›×Ÿ ×”×œ×©×•× ×™×•×ª -->
      
      <!-- ×œ×•×— ×‘×§×¨×” -->
      <div id="dashboardTab" class="tab-content">
          <div class="charts-grid">
              <div class="chart-container">
                  <h3>ğŸ“Š ×—×™×¤×•×©×™× ×™×•××™×™× - 7 ×™××™× ××—×¨×•× ×™×</h3>
                  <canvas id="searchesChart" width="400" height="200"></canvas>
              </div>
              
              <div class="chart-container">
                  <h3>ğŸ‘¥ ×¤×¢×™×œ×•×ª ××©×ª××©×™×</h3>
                  <canvas id="usersChart" width="400" height="200"></canvas>
              </div>
          </div>
          
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ• ×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h3>
                  <button class="btn btn-info btn-sm" onclick="refreshActivity()">
                      ğŸ”„ ×¨×¢× ×Ÿ
                  </button>
              </div>
              <div id="recentActivity">
                  <div class="loading">
                      <div class="loading-spinner"></div>
                      ×˜×•×¢×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”...
                  </div>
              </div>
          </div>
      </div>

      <!-- × ×™×”×•×œ ×ª×•×¨××™× -->
      <div id="donorsTab" class="tab-content hidden">
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ‘¥ × ×™×”×•×œ ×ª×•×¨××™×</h3>
                  <div>
                      <button class="btn btn-success" onclick="showAddDonorModal()">
                          â• ×”×•×¡×£ ×ª×•×¨× ×—×“×©
                      </button>
                      <button class="btn btn-warning" onclick="showBulkEditModal()">
                          ğŸ“ ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª
                      </button>
                      <button class="btn btn-info" onclick="exportDonors()">
                          ğŸ“Š ×™×™×¦× ×œ××§×¡×œ
                      </button>
                  </div>
              </div>
              
              <!-- ×‘×§×¨×•×ª ×‘×—×™×¨×” -->
              <div class="selection-controls" id="donorSelectionControls">
                  <div>
                      <span id="selectedCount">0</span> ×ª×•×¨××™× × ×‘×—×¨×•
                  </div>
                  <div>
                      <button class="btn btn-sm" onclick="bulkEdit()">ğŸ“ ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª</button>
                      <button class="btn btn-danger btn-sm" onclick="bulkDelete()">ğŸ—‘ï¸ ××—×™×§×” ×§×‘×•×¦×ª×™×ª</button>
                      <button class="btn btn-secondary btn-sm" onclick="clearSelection()">âŒ ×‘×˜×œ ×‘×—×™×¨×”</button>
                  </div>
              </div>
              
              <!-- ×¡×™× ×•× ×™× ×•×—×™×¤×•×© -->
              <div class="search-filters">
                  <div class="form-group">
                      <label>ğŸ” ×—×™×¤×•×© ×›×œ×œ×™:</label>
                      <input type="text" id="donorSearch" class="form-control" 
                             placeholder="×—×¤×© ×œ×¤×™ ×©×, ×˜×œ×¤×•×Ÿ ××• ××™××™×™×œ..." 
                             oninput="filterDonors()">
                  </div>
                  <div class="form-group">
                      <label>ğŸŒ† ×¢×™×¨:</label>
                      <select id="cityFilter" class="form-control" onchange="filterDonors()">
                          <option value="">×›×œ ×”×¢×™×¨</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ·ï¸ ×¡×•×’ ×ª×•×¨×:</label>
                      <select id="typeFilter" class="form-control" onchange="filterDonors()">
                          <option value="">×›×œ ×”×¡×•×’×™×</option>
                          <option value="VIP">VIP</option>
                          <option value="×§×‘×•×¢">×§×‘×•×¢</option>
                          <option value="×¨×’×™×œ">×¨×’×™×œ</option>
                          <option value="×—×“×©">×—×“×©</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“Š ×¡×˜×˜×•×¡:</label>
                      <select id="statusFilter" class="form-control" onchange="filterDonors()">
                          <option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
                          <option value="active">×¤×¢×™×œ</option>
                          <option value="inactive">×œ× ×¤×¢×™×œ</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <button class="btn btn-secondary" onclick="clearFilters()" style="margin-top: 25px;">
                          ğŸ—‘ï¸ × ×§×” ×¡×™× ×•× ×™×
                      </button>
                  </div>
              </div>
              
              <!-- ×˜×‘×œ×ª ×ª×•×¨××™× -->
              <div class="table-container">
                  <table class="table" id="donorsTable">
                      <thead>
                          <tr>
                              <th>
                                  <input type="checkbox" id="selectAllDonors" onchange="toggleSelectAll()">
                              </th>
                              <th onclick="sortTable('name')">ğŸ‘¤ ×©× <span class="sort-indicator">â‡…</span></th>
                              <th onclick="sortTable('phone')">ğŸ“ ×˜×œ×¤×•×Ÿ <span class="sort-indicator">â‡…</span></th>
                              <th onclick="sortTable('email')">ğŸ“§ ××™××™×™×œ <span class="sort-indicator">â‡…</span></th>
                              <th onclick="sortTable('city')">ğŸŒ† ×¢×™×¨ <span class="sort-indicator">â‡…</span></th>
                              <th onclick="sortTable('donor_type')">ğŸ·ï¸ ×¡×•×’ <span class="sort-indicator">â‡…</span></th>
                              <th onclick="sortTable('donation_amount')">ğŸ’° ×ª×¨×•××” <span class="sort-indicator">â‡…</span></th>
                              <th onclick="sortTable('created_at')">ğŸ“… × ×•×¦×¨ <span class="sort-indicator">â‡…</span></th>
                              <th>âš¡ ×¤×¢×•×œ×•×ª</th>
                          </tr>
                      </thead>
                      <tbody id="donorsTableBody">
                          <tr>
                              <td colspan="9" class="text-center">
                                  <div class="loading">
                                      <div class="loading-spinner"></div>
                                      ×˜×•×¢×Ÿ ×ª×•×¨××™×...
                                  </div>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
              
              <!-- ×¢××•×“×•× ×™× -->
              <div class="pagination" id="donorsPagination"></div>
          </div>
      </div>
	  <!-- × ×™×”×•×œ ××©×ª××©×™× -->
      <div id="usersTab" class="tab-content hidden">
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ”§ × ×™×”×•×œ ××©×ª××©×™×</h3>
                  <button class="btn btn-success" onclick="showAddUserModal()">
                      â• ×”×•×¡×£ ××©×ª××© ×—×“×©
                  </button>
              </div>
              
              <!-- ×¡×™× ×•×Ÿ ××©×ª××©×™× -->
              <div class="search-filters">
                  <div class="form-group">
                      <label>ğŸ” ×—×™×¤×•×© ××©×ª××©:</label>
                      <input type="text" id="userSearch" class="form-control" 
                             placeholder="×—×¤×© ×œ×¤×™ ×©× ××©×ª××© ××• ×©× ××œ×..." 
                             oninput="filterUsers()">
                  </div>
                  <div class="form-group">
                      <label>ğŸ‘‘ ×ª×¤×§×™×“:</label>
                      <select id="roleFilter" class="form-control" onchange="filterUsers()">
                          <option value="">×›×œ ×”×ª×¤×§×™×“×™×</option>
                          <option value="admin">××“××™×Ÿ</option>
                          <option value="operator">×˜×œ×¤×Ÿ</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“Š ×¡×˜×˜×•×¡:</label>
                      <select id="userStatusFilter" class="form-control" onchange="filterUsers()">
                          <option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
                          <option value="1">×¤×¢×™×œ</option>
                          <option value="0">×œ× ×¤×¢×™×œ</option>
                      </select>
                  </div>
              </div>
              
              <!-- ×˜×‘×œ×ª ××©×ª××©×™× -->
              <div class="table-container">
                  <table class="table" id="usersTable">
                      <thead>
                          <tr>
                              <th>ğŸ‘¤ ×©× ××©×ª××©</th>
                              <th>ğŸ“› ×©× ××œ×</th>
                              <th>ğŸ“§ ××™××™×™×œ</th>
                              <th>ğŸ“ ×˜×œ×¤×•×Ÿ</th>
                              <th>ğŸ¢ ××—×œ×§×”</th>
                              <th>ğŸ‘‘ ×ª×¤×§×™×“</th>
                              <th>ğŸ“Š ×¡×˜×˜×•×¡</th>
                              <th>ğŸ• ×”×ª×—×‘×¨×•×ª ××—×¨×•× ×”</th>
                              <th>ğŸ“Š ××¡×¤×¨ ×—×™×¤×•×©×™×</th>
                              <th>âš¡ ×¤×¢×•×œ×•×ª</th>
                          </tr>
                      </thead>
                      <tbody id="usersTableBody">
                          <tr>
                              <td colspan="10" class="text-center">
                                  <div class="loading">
                                      <div class="loading-spinner"></div>
                                      ×˜×•×¢×Ÿ ××©×ª××©×™×...
                                  </div>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>

      <!-- ×“×•×—×•×ª ×•×¡×˜×˜×™×¡×˜×™×§×•×ª -->
      <div id="reportsTab" class="tab-content hidden">
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ“ˆ ×“×•×—×•×ª ×•×¡×˜×˜×™×¡×˜×™×§×•×ª</h3>
                  <div>
                      <button class="btn btn-info" onclick="exportReports()">
                          ğŸ“Š ×™×™×¦× ×“×•×—×•×ª ×œ××§×¡×œ
                      </button>
                      <button class="btn btn-success" onclick="generateReport()">
                          ğŸ“‹ ×¦×•×¨ ×“×•×— ××•×ª××
                      </button>
                  </div>
              </div>
              
              <!-- ×‘×—×™×¨×ª ×ª××¨×™×›×™× -->
              <div class="search-filters">
                  <div class="form-group">
                      <label>ğŸ“… ××ª××¨×™×š:</label>
                      <input type="date" id="fromDate" class="form-control" onchange="updateReports()">
                  </div>
                  <div class="form-group">
                      <label>ğŸ“… ×¢×“ ×ª××¨×™×š:</label>
                      <input type="date" id="toDate" class="form-control" onchange="updateReports()">
                  </div>
                  <div class="form-group">
                      <label>ğŸ‘¤ ××©×ª××©:</label>
                      <select id="userReportFilter" class="form-control" onchange="updateReports()">
                          <option value="">×›×œ ×”××©×ª××©×™×</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <button class="btn btn-admin" onclick="loadReports()" style="margin-top: 25px;">
                          ğŸ”„ ×¨×¢× ×Ÿ ×“×•×—×•×ª
                      </button>
                  </div>
              </div>
              
              <!-- ×“×•×— ×—×™×¤×•×©×™× -->
              <div class="card">
                  <h4>ğŸ” ×“×•×— ×—×™×¤×•×©×™×</h4>
                  <div class="table-container">
                      <table class="table">
                          <thead>
                              <tr>
                                  <th>ğŸ‘¤ ××©×ª××©</th>
                                  <th>ğŸ“… ×ª××¨×™×š</th>
                                  <th>ğŸ” ×¡×”"×› ×—×™×¤×•×©×™×</th>
                                  <th>ğŸ¯ ×—×™×¤×•×©×™× ×™×™×—×•×“×™×™×</th>
                                  <th>ğŸ“Š ×××•×¦×¢ ×ª×•×¦××•×ª</th>
                                  <th>â° ×©×¢×•×ª ×¤×¢×™×œ×•×ª</th>
                              </tr>
                          </thead>
                          <tbody id="searchReportBody">
                              <tr>
                                  <td colspan="6" class="text-center">
                                      <div class="loading">
                                          <div class="loading-spinner"></div>
                                          ×˜×•×¢×Ÿ ×“×•×— ×—×™×¤×•×©×™×...
                                      </div>
                                  </td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>
              
              <!-- ×“×¤×•×¡×™ ×¢×‘×•×“×” -->
              <div class="card">
                  <h4>â° ×“×¤×•×¡×™ ×¢×‘×•×“×” ×©×œ ×˜×œ×¤× ×™×</h4>
                  <div class="charts-grid">
                      <div class="chart-container">
                          <h5>ğŸ“Š ×¤×¢×™×œ×•×ª ×œ×¤×™ ×©×¢×•×ª</h5>
                          <canvas id="workPatternsChart" width="400" height="200"></canvas>
                      </div>
                      <div class="chart-container">
                          <h5>ğŸ“ˆ ×¤×¢×™×œ×•×ª ×œ×¤×™ ×™××™×</h5>
                          <canvas id="dailyActivityChart" width="400" height="200"></canvas>
                      </div>
                  </div>
              </div>
          </div>
      </div>

<!-- ×”×¢×œ××ª ×§×‘×¦×™× -->
<div id="uploadTab" class="tab-content hidden">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">ğŸ“„ ×”×¢×œ××ª ×§×‘×¦×™×</h3>
            <div>
                <button class="btn btn-info" onclick="downloadTemplate()">
                    ğŸ“‹ ×”×•×¨×“ ×ª×‘× ×™×ª CSV
                </button>
                <button class="btn btn-warning" onclick="showDataQuality()">
                    ğŸ” ×‘×“×™×§×ª ××™×›×•×ª × ×ª×•× ×™×
                </button>
            </div>
        </div>
        
        <div id="uploadMessage"></div>
        
        <!-- ××–×•×¨ ×”×¢×œ××” -->
        <div class="upload-area" id="uploadArea" 
             ondrop="handleDrop(event)" 
             ondragover="handleDragOver(event)"
             ondragleave="handleDragLeave(event)">
            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“</div>
            <h3>×’×¨×•×¨ ×§×•×‘×¥ CSV ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</h3>
            <p style="margin: 15px 0; color: #666;">
                ×ª×•××š ×‘×§×‘×¦×™ CSV ×¢×“ 50MB
            </p>
            <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleFileSelect(this)">
            <button class="btn btn-admin btn-lg" onclick="document.getElementById('csvFile').click()">
                ğŸ“ ×‘×—×¨ ×§×•×‘×¥ CSV
            </button>
        </div>
        
        <!-- ×¤×¨×˜×™ ×”×§×•×‘×¥ -->
        <div id="fileDetails" class="hidden">
            <div class="card">
                <h4>ğŸ“‹ ×¤×¨×˜×™ ×”×§×•×‘×¥</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“ ×©× ×”×§×•×‘×¥:</label>
                        <input type="text" id="fileName" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“Š ×’×•×“×œ:</label>
                        <input type="text" id="fileSize" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“ ×¡×•×’:</label>
                        <input type="text" id="fileType" class="form-control" readonly>
                    </div>
                </div>
                
                <!-- ××¤×©×¨×•×™×•×ª ×”×¢×œ××” -->
                <div class="form-row">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="replaceData" checked>
                            ×”×—×œ×£ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×™×™××™×
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="skipDuplicates" checked>
                            ×“×œ×’ ×¢×œ ×›×¤×™×œ×•×™×•×ª
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="validateData" checked>
                            ×‘×“×•×§ ××™×›×•×ª × ×ª×•× ×™×
                        </label>
                    </div>
                </div>
                
                <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” -->
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success btn-lg" onclick="uploadCSV()">
                        ğŸš€ ×”×¢×œ×” ×§×•×‘×¥
                    </button>
                    <button class="btn btn-secondary" onclick="cancelUpload()">
                        âŒ ×‘×˜×œ
                    </button>
                </div>
                
                <!-- ×”×ª×§×“××•×ª -->
                <div id="uploadProgress" class="hidden">
                    <h5>ğŸ“Š ×”×ª×§×“××•×ª ×”×¢×œ××”:</h5>
                    <div class="progress">
                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                    <p id="progressText">0%</p>
                </div>
            </div>
        </div>
        
        <!-- ×›×¨×˜×™×¡ ×¡×™× ×›×¨×•×Ÿ Airtable -->
        <div class="card">
            <h3>ğŸ”„ ×¡×™× ×›×¨×•×Ÿ × ×ª×•× ×™×</h3>
            <p>×¢×“×›×•×Ÿ ××™×“×¢ ×ª×•×¨××™× ×-Airtable</p>
            <button class="btn btn-primary" onclick="manualAirtableSync()" id="syncButton">
                ğŸ”„ ×¢×“×›×Ÿ ×ª×•×¨××™× ×-Airtable ×¢×›×©×™×•
            </button>
            <div id="syncStatus" style="margin-top: 15px;"></div>
        </div>
        
        <!-- ×”×™×¡×˜×•×¨×™×™×ª ×”×¢×œ××•×ª -->
        <div class="card">
            <h4>ğŸ“š ×”×™×¡×˜×•×¨×™×™×ª ×”×¢×œ××•×ª</h4>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ğŸ“… ×ª××¨×™×š</th>
                            <th>ğŸ“ ×©× ×§×•×‘×¥</th>
                            <th>ğŸ‘¤ ×”×•×¢×œ×” ×¢×œ ×™×“×™</th>
                            <th>ğŸ“Š ×¨×©×•××•×ª</th>
                            <th>âš ï¸ ×›×¤×™×œ×•×™×•×ª</th>
                            <th>âŒ ×©×’×™××•×ª</th>
                            <th>ğŸ“Š ×¡×˜×˜×•×¡</th>
                        </tr>
                    </thead>
                    <tbody id="uploadHistoryBody">
                        <tr>
                            <td colspan="7" class="text-center">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    ×˜×•×¢×Ÿ ×”×™×¡×˜×•×¨×™×”...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

      <!-- × ×™×”×•×œ ×”×•×“×¢×•×ª -->
      <div id="messagesTab" class="tab-content hidden">
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ’¬ × ×™×”×•×œ ×”×•×“×¢×•×ª ××¢×¨×›×ª</h3>
                  <button class="btn btn-success" onclick="showCreateMessageModal()">
                      â• ×¦×•×¨ ×”×•×“×¢×” ×—×“×©×”
                  </button>
              </div>
              
              <!-- ×¨×©×™××ª ×”×•×“×¢×•×ª -->
              <div class="table-container">
                  <table class="table">
                      <thead>
                          <tr>
                              <th>ğŸ“‹ ×›×•×ª×¨×ª</th>
                              <th>ğŸ“ ×ª×•×›×Ÿ</th>
                              <th>ğŸ·ï¸ ×¡×•×’</th>
                              <th>ğŸ¯ ×™×¢×“</th>
                              <th>âš¡ ×¢×“×™×¤×•×ª</th>
                              <th>ğŸ“… × ×•×¦×¨</th>
                              <th>â° ×¤×•×§×¢</th>
                              <th>ğŸ“Š ×¡×˜×˜×•×¡</th>
                              <th>âš¡ ×¤×¢×•×œ×•×ª</th>
                          </tr>
                      </thead>
                      <tbody id="messagesTableBody">
                          <tr>
                              <td colspan="9" class="text-center">
                                  <div class="loading">
                                      <div class="loading-spinner"></div>
                                      ×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...
                                  </div>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>

      <!-- ×›×¨×˜×™×¡×™ ×ª××™×›×” -->
      <div id="ticketsTab" class="tab-content hidden">
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ« × ×™×”×•×œ ×›×¨×˜×™×¡×™ ×ª××™×›×”</h3>
                  <div>
                      <span class="badge badge-warning" id="pendingTickets">0 ×××ª×™× ×™×</span>
                      <span class="badge badge-info" id="inProgressTickets">0 ×‘×˜×™×¤×•×œ</span>
                  </div>
              </div>
              
              <!-- ×¡×™× ×•×Ÿ ×›×¨×˜×™×¡×™× -->
              <div class="search-filters">
                  <div class="form-group">
                      <label>ğŸ“Š ×¡×˜×˜×•×¡:</label>
                      <select id="ticketStatusFilter" class="form-control" onchange="filterTickets()">
                          <option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
                          <option value="open">×¤×ª×•×—</option>
                          <option value="in_progress">×‘×˜×™×¤×•×œ</option>
                          <option value="resolved">× ×¤×ª×¨</option>
                          <option value="closed">×¡×’×•×¨</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“‚ ×§×˜×’×•×¨×™×”:</label>
                      <select id="ticketCategoryFilter" class="form-control" onchange="filterTickets()">
                          <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                          <option value="technical">×˜×›× ×™</option>
                          <option value="data">× ×ª×•× ×™×</option>
                          <option value="access">×’×™×©×”</option>
                          <option value="training">×”×“×¨×›×”</option>
                          <option value="other">××—×¨</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>âš¡ ×¢×“×™×¤×•×ª:</label>
                      <select id="ticketPriorityFilter" class="form-control" onchange="filterTickets()">
                          <option value="">×›×œ ×”×¢×“×™×¤×•×™×•×ª</option>
                          <option value="urgent">×“×—×•×£</option>
                          <option value="high">×’×‘×•×”×”</option>
                          <option value="medium">×‘×™× ×•× ×™×ª</option>
                          <option value="low">× ××•×›×”</option>
                      </select>
                  </div>
              </div>
              
              <!-- ×˜×‘×œ×ª ×›×¨×˜×™×¡×™× -->
              <div class="table-container">
                  <table class="table">
                      <thead>
                          <tr>
                              <th>ğŸ« ××¡×¤×¨</th>
                              <th>ğŸ“‹ ×›×•×ª×¨×ª</th>
                              <th>ğŸ‘¤ ×¤×•×ª×—</th>
                              <th>ğŸ“‚ ×§×˜×’×•×¨×™×”</th>
                              <th>âš¡ ×¢×“×™×¤×•×ª</th>
                              <th>ğŸ“Š ×¡×˜×˜×•×¡</th>
                              <th>ğŸ‘¨â€ğŸ’¼ ××˜×¤×œ</th>
                              <th>ğŸ“… × ×•×¦×¨</th>
                              <th>ğŸ”„ ×¢×•×“×›×Ÿ</th>
                              <th>âš¡ ×¤×¢×•×œ×•×ª</th>
                          </tr>
                      </thead>
                      <tbody id="ticketsTableBody">
                          <tr>
                              <td colspan="10" class="text-center">
                                  <div class="loading">
                                      <div class="loading-spinner"></div>
                                      ×˜×•×¢×Ÿ ×›×¨×˜×™×¡×™×...
                                  </div>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>

      <!-- ×œ×•×’×™ ××¢×¨×›×ª -->
      <div id="logsTab" class="tab-content hidden">
          <div class="card">
              <div class="card-header">
                  <h3 class="card-title">ğŸ“‹ ×œ×•×’×™ ××¢×¨×›×ª</h3>
                  <div>
                      <button class="btn btn-warning" onclick="clearOldLogs()">
                          ğŸ—‘ï¸ × ×§×” ×œ×•×’×™× ×™×©× ×™×
                      </button>
                      <button class="btn btn-info" onclick="exportLogs()">
                          ğŸ“Š ×™×™×¦× ×œ×•×’×™×
                      </button>
                  </div>
              </div>
              
              <!-- ×¡×™× ×•×Ÿ ×œ×•×’×™× -->
              <div class="search-filters">
                  <div class="form-group">
                      <label>ğŸ‘¤ ××©×ª××©:</label>
                      <select id="logUserFilter" class="form-control" onchange="filterLogs()">
                          <option value="">×›×œ ×”××©×ª××©×™×</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>âš¡ ×¤×¢×•×œ×”:</label>
                      <select id="logActionFilter" class="form-control" onchange="filterLogs()">
                          <option value="">×›×œ ×”×¤×¢×•×œ×•×ª</option>
                          <option value="LOGIN">×”×ª×—×‘×¨×•×ª</option>
                          <option value="SEARCH">×—×™×¤×•×©</option>
                          <option value="CREATE_DONOR">×™×¦×™×¨×ª ×ª×•×¨×</option>
                          <option value="UPDATE_DONOR">×¢×“×›×•×Ÿ ×ª×•×¨×</option>
                          <option value="DELETE_DONOR">××—×™×§×ª ×ª×•×¨×</option>
                          <option value="CSV_UPLOAD">×”×¢×œ××ª CSV</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“… ××ª××¨×™×š:</label>
                      <input type="date" id="logFromDate" class="form-control" onchange="filterLogs()">
                  </div>
                  <div class="form-group">
                      <label>ğŸ“… ×¢×“ ×ª××¨×™×š:</label>
                      <input type="date" id="logToDate" class="form-control" onchange="filterLogs()">
                  </div>
              </div>
              
              <!-- ×˜×‘×œ×ª ×œ×•×’×™× -->
              <div class="table-container">
                  <table class="table">
                      <thead>
                          <tr>
                              <th>ğŸ• ×–××Ÿ</th>
                              <th>ğŸ‘¤ ××©×ª××©</th>
                              <th>âš¡ ×¤×¢×•×œ×”</th>
                              <th>ğŸ¯ ×™×¢×“</th>
                              <th>ğŸ“ ×¤×¨×˜×™×</th>
                              <th>ğŸŒ IP</th>
                              <th>ğŸ–¥ï¸ ×“×¤×“×¤×Ÿ</th>
                          </tr>
                      </thead>
                      <tbody id="logsTableBody">
                          <tr>
                              <td colspan="7" class="text-center">
                                  <div class="loading">
                                      <div class="loading-spinner"></div>
                                      ×˜×•×¢×Ÿ ×œ×•×’×™×...
                                  </div>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              </div>
              
              <!-- ×¢××•×“×•× ×™× -->
              <div class="pagination" id="logsPagination"></div>
          </div>
      </div>
  </div>

     <!-- × ×™×”×•×œ ×ª×¨×•××•×ª -->
     <div id="donation-managementTab" class="tab-content hidden">
         <div class="card">
             <div class="card-header">
                 <h3 class="card-title">ğŸ’³ × ×™×”×•×œ ×¡×•×’×™ ×ª×¨×•××•×ª</h3>
                 <div>
                     <button class="btn btn-success" onclick="showAddDonationTypeModal()">
                         â• ×”×•×¡×£ ×¡×•×’ ×ª×¨×•××” ×—×“×©
                     </button>
                     <button class="btn btn-info" onclick="showDonationStats()">
                         ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×™××•×©
                     </button>
                     <button class="btn btn-warning" onclick="showDonationLogs()">
                         ğŸ“‹ ×œ×•×’×™ ×’×™×©×”
                     </button>
                 </div>
             </div>
             
             <!-- ×˜×‘×œ×ª ×¡×•×’×™ ×ª×¨×•××•×ª -->
             <div class="table-container">
                 <table class="table" id="donationTypesTable">
                     <thead>
                         <tr>
                             <th>ğŸ“ ×©× ×”×ª×¨×•××”</th>
                             <th>ğŸ”— ×§×™×©×•×¨</th>
                             <th>ğŸ“… ×ª××¨×™×š ×”×ª×—×œ×”</th>
                             <th>ğŸ“… ×ª××¨×™×š ×¡×™×•×</th>
                             <th>ğŸ“Š ×¡×˜×˜×•×¡</th>
                             <th>ğŸ‘¤ × ×•×¦×¨ ×¢×œ ×™×“×™</th>
                             <th>ğŸ“… × ×•×¦×¨</th>
                             <th>âš¡ ×¤×¢×•×œ×•×ª</th>
                         </tr>
                     </thead>
                     <tbody id="donationTypesTableBody">
                         <tr>
                             <td colspan="8" class="text-center">
                                 <div class="loading">
                                     <div class="loading-spinner"></div>
                                     ×˜×•×¢×Ÿ ×¡×•×’×™ ×ª×¨×•××•×ª...
                                 </div>
                             </td>
                         </tr>
                     </tbody>
                 </table>
             </div>
         </div>
     </div>
 </div>

  <!-- ××•×“×œ×™× -->
  
  <!-- ××•×“×œ ×”×•×¡×¤×ª ×ª×•×¨× -->
  <div id="addDonorModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>â• ×”×•×¡×¤×ª ×ª×•×¨× ×—×“×©</h3>
              <button class="modal-close" onclick="closeModal('addDonorModal')">&times;</button>
          </div>
          <form id="addDonorForm">
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ‘¤ ×©× ××œ×: *</label>
                      <input type="text" id="donorName" class="form-control" required>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“ ×˜×œ×¤×•×Ÿ: *</label>
                      <input type="tel" id="donorPhone" class="form-control" required>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ“§ ××™××™×™×œ:</label>
                      <input type="email" id="donorEmail" class="form-control">
                  </div>
                  <div class="form-group">
                      <label>ğŸŒ† ×¢×™×¨:</label>
                      <input type="text" id="donorCity" class="form-control">
                  </div>
              </div>
              <div class="form-group">
                  <label>ğŸ  ×›×ª×•×‘×ª ××œ××”:</label>
                  <input type="text" id="donorAddress" class="form-control">
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ’° ×¡×›×•× ×ª×¨×•××”:</label>
                      <input type="number" id="donorAmount" class="form-control" min="0" step="0.01">
                  </div>
                  <div class="form-group">
                      <label>ğŸ·ï¸ ×¡×•×’ ×ª×•×¨×:</label>
                      <select id="donorType" class="form-control">
                          <option value="×¨×’×™×œ">×¨×’×™×œ</option>
                          <option value="×§×‘×•×¢">×§×‘×•×¢</option>
                          <option value="VIP">VIP</option>
                          <option value="×—×“×©">×—×“×©</option>
                      </select>
                  </div>
              </div>
              <div class="form-group">
                  <label>ğŸ“ ×”×¢×¨×•×ª:</label>
                  <textarea id="donorNotes" class="form-control" rows="3"></textarea>
              </div>
              <div style="text-align: center; margin-top: 25px;">
                  <button type="submit" class="btn btn-success btn-lg">ğŸ’¾ ×©××•×¨ ×ª×•×¨×</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('addDonorModal')">âŒ ×‘×˜×œ</button>
              </div>
          </form>
      </div>
  </div>

  <!-- ××•×“×œ ×¢×¨×™×›×ª ×ª×•×¨× -->
  <div id="editDonorModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>âœï¸ ×¢×¨×™×›×ª ×ª×•×¨×</h3>
              <button class="modal-close" onclick="closeModal('editDonorModal')">&times;</button>
          </div>
          <form id="editDonorForm">
              <input type="hidden" id="editDonorId">
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ‘¤ ×©× ××œ×: *</label>
                      <input type="text" id="editDonorName" class="form-control" required>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“ ×˜×œ×¤×•×Ÿ: *</label>
                      <input type="tel" id="editDonorPhone" class="form-control" required>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ“§ ××™××™×™×œ:</label>
                      <input type="email" id="editDonorEmail" class="form-control">
                  </div>
                  <div class="form-group">
                      <label>ğŸŒ† ×¢×™×¨:</label>
                      <input type="text" id="editDonorCity" class="form-control">
                  </div>
              </div>
              <div class="form-group">
                  <label>ğŸ  ×›×ª×•×‘×ª ××œ××”:</label>
                  <input type="text" id="editDonorAddress" class="form-control">
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ’° ×¡×›×•× ×ª×¨×•××”:</label>
                      <input type="number" id="editDonorAmount" class="form-control" min="0" step="0.01">
                  </div>
                  <div class="form-group">
                      <label>ğŸ·ï¸ ×¡×•×’ ×ª×•×¨×:</label>
                      <select id="editDonorType" class="form-control">
                          <option value="×¨×’×™×œ">×¨×’×™×œ</option>
                          <option value="×§×‘×•×¢">×§×‘×•×¢</option>
                          <option value="VIP">VIP</option>
                          <option value="×—×“×©">×—×“×©</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ“Š ×¡×˜×˜×•×¡:</label>
                      <select id="editDonorStatus" class="form-control">
                          <option value="active">×¤×¢×™×œ</option>
                          <option value="inactive">×œ× ×¤×¢×™×œ</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“… ×ª××¨×™×š ×™×¦×™×¨×”:</label>
                      <input type="text" id="editDonorCreated" class="form-control" readonly>
                  </div>
              </div>
              <div class="form-group">
                  <label>ğŸ“ ×”×¢×¨×•×ª:</label>
                  <textarea id="editDonorNotes" class="form-control" rows="3"></textarea>
              </div>
              <div style="text-align: center; margin-top: 25px;">
                  <button type="submit" class="btn btn-success btn-lg">ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('editDonorModal')">âŒ ×‘×˜×œ</button>
                  <button type="button" class="btn btn-danger" onclick="deleteDonor()">ğŸ—‘ï¸ ××—×§ ×ª×•×¨×</button>
              </div>
          </form>
      </div>
  </div>

  <!-- ××•×“×œ ×”×•×¡×¤×ª ××©×ª××© -->
  <div id="addUserModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>ğŸ‘¤ ×”×•×¡×¤×ª ××©×ª××© ×—×“×©</h3>
              <button class="modal-close" onclick="closeModal('addUserModal')">&times;</button>
          </div>
          <form id="addUserForm">
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ‘¤ ×©× ××©×ª××©: *</label>
                      <input type="text" id="newUsername" class="form-control" required 
                             placeholder="××•×ª×™×•×ª ×× ×’×œ×™×•×ª ×•××¡×¤×¨×™× ×‘×œ×‘×“">
                  </div>
                  <div class="form-group">
                      <label>ğŸ“› ×©× ××œ×: *</label>
                      <input type="text" id="newUserFullName" class="form-control" required 
                             placeholder="×©× ×¤×¨×˜×™ ×•×©× ××©×¤×—×”">
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ”’ ×¡×™×¡××”: *</label>
                      <input type="password" id="newUserPassword" class="form-control" required 
                             minlength="6" placeholder="×œ×¤×—×•×ª 6 ×ª×•×•×™×">
                  </div>
                  <div class="form-group">
                      <label>ğŸ”’ ××™××•×ª ×¡×™×¡××”: *</label>
                      <input type="password" id="confirmUserPassword" class="form-control" required 
                             placeholder="×”×›× ×¡ ×©×•×‘ ××ª ×”×¡×™×¡××”">
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ“§ ××™××™×™×œ:</label>
                      <input type="email" id="newUserEmail" class="form-control" 
                             placeholder="user@example.com">
                  </div>
                  <div class="form-group">
				  <label>ğŸ“ ×˜×œ×¤×•×Ÿ:</label>
                      <input type="tel" id="newUserPhone" class="form-control" 
                             placeholder="050-1234567">
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ¢ ××—×œ×§×”:</label>
                      <input type="text" id="newUserDepartment" class="form-control" 
                             placeholder="××•×§×“ ×˜×œ×¤×•× ×™">
                  </div>
                  <div class="form-group">
                      <label>ğŸ‘‘ ×ª×¤×§×™×“: *</label>
                      <select id="newUserRole" class="form-control" required>
                          <option value="operator">×˜×œ×¤×Ÿ ×¨×’×™×œ</option>
                          <option value="admin">××“××™×Ÿ</option>
                      </select>
                  </div>
              </div>
              <div class="form-group">
                  <label>ğŸ“ ×”×¢×¨×•×ª:</label>
                  <textarea id="newUserNotes" class="form-control" rows="2" 
                            placeholder="×”×¢×¨×•×ª ×¢×œ ×”××©×ª××© (××•×¤×¦×™×•× ×œ×™)"></textarea>
              </div>
              <div style="text-align: center; margin-top: 25px;">
                  <button type="submit" class="btn btn-success btn-lg">ğŸ‘¤ ×¦×•×¨ ××©×ª××©</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">âŒ ×‘×˜×œ</button>
              </div>
          </form>
      </div>
  </div>

  <!-- ××•×“×œ ×¢×¨×™×›×ª ××©×ª××© -->
  <div id="editUserModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>âœï¸ ×¢×¨×™×›×ª ××©×ª××©</h3>
              <button class="modal-close" onclick="closeModal('editUserModal')">&times;</button>
          </div>
          <form id="editUserForm">
              <input type="hidden" id="editUserId">
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ‘¤ ×©× ××©×ª××©: *</label>
                      <input type="text" id="editUsername" class="form-control" required readonly 
                             style="background: #f0f0f0;">
                      <small class="text-muted">×œ× × ×™×ª×Ÿ ×œ×©× ×•×ª ×©× ××©×ª××©</small>
                  </div>
                  <div class="form-group">
                      <label>ğŸ“› ×©× ××œ×: *</label>
                      <input type="text" id="editUserFullName" class="form-control" required>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ“§ ××™××™×™×œ:</label>
                      <input type="email" id="editUserEmail" class="form-control">
                  </div>
                  <div class="form-group">
                      <label>ğŸ“ ×˜×œ×¤×•×Ÿ:</label>
                      <input type="tel" id="editUserPhone" class="form-control">
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ¢ ××—×œ×§×”:</label>
                      <input type="text" id="editUserDepartment" class="form-control">
                  </div>
                  <div class="form-group">
                      <label>ğŸ‘‘ ×ª×¤×§×™×“: *</label>
                      <select id="editUserRole" class="form-control" required>
                          <option value="operator">×˜×œ×¤×Ÿ ×¨×’×™×œ</option>
                          <option value="admin">××“××™×Ÿ</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ“Š ×¡×˜×˜×•×¡:</label>
                      <select id="editUserStatus" class="form-control">
                          <option value="1">×¤×¢×™×œ</option>
                          <option value="0">×œ× ×¤×¢×™×œ</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>ğŸ• ×”×ª×—×‘×¨×•×ª ××—×¨×•× ×”:</label>
                      <input type="text" id="editUserLastLogin" class="form-control" readonly>
                  </div>
              </div>
              <div class="form-group">
                  <label>ğŸ”’ ×¡×™×¡××” ×—×“×©×”:</label>
                  <input type="password" id="editUserPassword" class="form-control" 
                         placeholder="×”×©××¨ ×¨×™×§ ×× ×œ× ×¨×•×¦×” ×œ×©× ×•×ª">
                  <small class="text-muted">×”×©××¨ ×¨×™×§ ×›×“×™ ×œ× ×œ×©× ×•×ª ××ª ×”×¡×™×¡××”</small>
              </div>
              <div class="form-group">
                  <label>ğŸ“ ×”×¢×¨×•×ª:</label>
                  <textarea id="editUserNotes" class="form-control" rows="2"></textarea>
              </div>
              <div style="text-align: center; margin-top: 25px;">
                  <button type="submit" class="btn btn-success btn-lg">ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×</button>
                  <button type="button" class="btn btn-warning" onclick="resetUserPassword()">ğŸ”’ ××™×¤×•×¡ ×¡×™×¡××”</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('editUserModal')">âŒ ×‘×˜×œ</button>
              </div>
          </form>
      </div>
  </div>

  <!-- ××•×“×œ ×™×¦×™×¨×ª ×”×•×“×¢×” -->
  <div id="createMessageModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>ğŸ’¬ ×™×¦×™×¨×ª ×”×•×“×¢×” ×—×“×©×”</h3>
              <button class="modal-close" onclick="closeModal('createMessageModal')">&times;</button>
          </div>
          <form id="createMessageForm">
              <div class="form-group">
                  <label>ğŸ“‹ ×›×•×ª×¨×ª ×”×”×•×“×¢×”: *</label>
                  <input type="text" id="messageTitle" class="form-control" required 
                         placeholder="×›×•×ª×¨×ª ×§×¦×¨×” ×•××•×‘× ×ª">
              </div>
              <div class="form-group">
                  <label>ğŸ“ ×ª×•×›×Ÿ ×”×”×•×“×¢×”: *</label>
                  <textarea id="messageContent" class="form-control" rows="4" required 
                            placeholder="×ª×•×›×Ÿ ××¤×•×¨×˜ ×©×œ ×”×”×•×“×¢×”..."></textarea>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ·ï¸ ×¡×•×’ ×”×•×“×¢×”:</label>
                      <select id="messageType" class="form-control">
                          <option value="info">××™×“×¢ ×›×œ×œ×™</option>
                          <option value="success">×”×•×“×¢×ª ×”×¦×œ×—×”</option>
                          <option value="warning">××–×”×¨×”</option>
                          <option value="error">×©×’×™××” ×—×©×•×‘×”</option>
                      </select>
                  </div>
                  <div class="form-group">
                      <label>âš¡ ×¢×“×™×¤×•×ª:</label>
                      <select id="messagePriority" class="form-control">
                          <option value="1">×¨×’×™×œ×”</option>
                          <option value="2">×—×©×•×‘×”</option>
                          <option value="3">×§×¨×™×˜×™×ª</option>
                      </select>
                  </div>
              </div>
              <div class="form-row">
                  <div class="form-group">
                      <label>ğŸ¯ ×™×¢×“:</label>
                      <select id="messageTarget" class="form-control" onchange="toggleTargetUser()">
                          <option value="all">×›×œ ×”××©×ª××©×™×</option>
                          <option value="operator">×˜×œ×¤× ×™× ×‘×œ×‘×“</option>
                          <option value="admin">××“××™× ×™× ×‘×œ×‘×“</option>
                          <option value="specific">××©×ª××© ×¡×¤×¦×™×¤×™</option>
                      </select>
                  </div>
                  <div class="form-group" id="specificUserGroup" style="display: none;">
                      <label>ğŸ‘¤ ××©×ª××© ×¡×¤×¦×™×¤×™:</label>
                      <select id="targetUserId" class="form-control">
                          <option value="">×‘×—×¨ ××©×ª××©...</option>
                      </select>
                  </div>
              </div>
              <div class="form-group">
                  <label>â° ×ª××¨×™×š ×¤×§×™×¢×” (××•×¤×¦×™×•× ×œ×™):</label>
                  <input type="datetime-local" id="messageExpires" class="form-control">
                  <small class="text-muted">×”×©××¨ ×¨×™×§ ×× ×”×”×•×“×¢×” ×œ× ×¤×•×§×¢×ª</small>
              </div>
              <div style="text-align: center; margin-top: 25px;">
                  <button type="submit" class="btn btn-success btn-lg">ğŸ“¨ ×©×œ×— ×”×•×“×¢×”</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('createMessageModal')">âŒ ×‘×˜×œ</button>
              </div>
          </form>
      </div>
  </div>

  <!-- ××•×“×œ ×¤×¨×˜×™ ×›×¨×˜×™×¡ ×ª××™×›×” -->
  <div id="ticketDetailsModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>ğŸ« ×¤×¨×˜×™ ×›×¨×˜×™×¡ ×ª××™×›×”</h3>
              <button class="modal-close" onclick="closeModal('ticketDetailsModal')">&times;</button>
          </div>
          <div id="ticketDetailsContent">
              <div class="loading">
                  <div class="loading-spinner"></div>
                  ×˜×•×¢×Ÿ ×¤×¨×˜×™ ×›×¨×˜×™×¡...
              </div>
          </div>
      </div>
  </div>

  <!-- ××•×“×œ ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª -->
  <div id="bulkEditModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h3>ğŸ“ ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª</h3>
              <button class="modal-close" onclick="closeModal('bulkEditModal')">&times;</button>
          </div>
          <div class="message info">
              <span>ğŸ“Š</span>
              <span id="bulkEditCount">0 ×ª×•×¨××™× × ×‘×—×¨×• ×œ×¢×¨×™×›×”</span>
          </div>
          <form id="bulkEditForm">
              <div class="form-group">
                  <label>
                      <input type="checkbox" id="bulkEditCity"> 
                      ğŸŒ† ×¢×“×›×Ÿ ×¢×™×¨ ×œ×›×œ ×”× ×‘×—×¨×™×:
                  </label>
                  <input type="text" id="bulkCityValue" class="form-control" disabled>
              </div>
              <div class="form-group">
                  <label>
                      <input type="checkbox" id="bulkEditType"> 
                      ğŸ·ï¸ ×¢×“×›×Ÿ ×¡×•×’ ×ª×•×¨× ×œ×›×œ ×”× ×‘×—×¨×™×:
                  </label>
                  <select id="bulkTypeValue" class="form-control" disabled>
                      <option value="×¨×’×™×œ">×¨×’×™×œ</option>
                      <option value="×§×‘×•×¢">×§×‘×•×¢</option>
                      <option value="VIP">VIP</option>
                      <option value="×—×“×©">×—×“×©</option>
                  </select>
              </div>
              <div class="form-group">
                  <label>
                      <input type="checkbox" id="bulkEditStatus"> 
                      ğŸ“Š ×¢×“×›×Ÿ ×¡×˜×˜×•×¡ ×œ×›×œ ×”× ×‘×—×¨×™×:
                  </label>
                  <select id="bulkStatusValue" class="form-control" disabled>
                      <option value="active">×¤×¢×™×œ</option>
                      <option value="inactive">×œ× ×¤×¢×™×œ</option>
                  </select>
              </div>
              <div style="text-align: center; margin-top: 25px;">
                  <button type="submit" class="btn btn-success btn-lg">ğŸ’¾ ×‘×¦×¢ ×¢×“×›×•×Ÿ ×§×‘×•×¦×ª×™</button>
                  <button type="button" class="btn btn-secondary" onclick="closeModal('bulkEditModal')">âŒ ×‘×˜×œ</button>
              </div>
          </form>
      </div>
  </div>

 <!-- ××•×“×œ ×”×•×¡×¤×ª ×¡×•×’ ×ª×¨×•××” -->
 <div id="addDonationTypeModal" class="modal">
     <div class="modal-content">
         <div class="modal-header">
             <h3>â• ×”×•×¡×¤×ª ×¡×•×’ ×ª×¨×•××” ×—×“×©</h3>
             <button class="modal-close" onclick="closeModal('addDonationTypeModal')">&times;</button>
         </div>
         <form id="addDonationTypeForm">
             <div class="form-group">
                 <label>ğŸ“ ×©× ×”×ª×¨×•××”: *</label>
                 <input type="text" id="donationTypeName" class="form-control" required 
                        placeholder="×œ×“×•×’××”: ×ª×™×§×•×Ÿ × ×¤×˜×¨×™×, ×”×›× ×¡×ª ×¡×¤×¨ ×ª×•×¨×”">
             </div>
             
             <div class="form-group">
                 <label>ğŸ”— ×§×™×©×•×¨ ×“×£ ×”×—×™×•×‘: *</label>
                 <input type="url" id="donationTypeUrl" class="form-control" required 
                        placeholder="https://example.com/donation-page">
                 <small class="text-muted">×”×›× ×¡ ×§×™×©×•×¨ ××œ× ×œ×“×£ ×”×—×™×•×‘</small>
             </div>
             
             <div class="form-group">
                 <label>ğŸ“ ×ª×™××•×¨ (××•×¤×¦×™×•× ×œ×™):</label>
                 <textarea id="donationTypeDescription" class="form-control" rows="3" 
                           placeholder="×ª×™××•×¨ ×§×¦×¨ ×¢×œ ×”×ª×¨×•××”..."></textarea>
             </div>
             
             <div class="form-row">
                 <div class="form-group">
                     <label>ğŸ“… ×ª××¨×™×š ×”×ª×—×œ×”:</label>
                     <input type="date" id="donationTypeStartDate" class="form-control">
                 </div>
                 <div class="form-group">
                     <label>ğŸ“… ×ª××¨×™×š ×¡×™×•×:</label>
                     <input type="date" id="donationTypeEndDate" class="form-control">
                 </div>
             </div>
             
             <div class="form-group">
                 <label>
                     <input type="checkbox" id="donationTypeNoExpiry"> 
                     â™¾ï¸ ×œ×œ× ×ª××¨×™×š ×¤×§×™×¢×” (×ª××™×“ ×¤×¢×™×œ)
                 </label>
             </div>
             
             <div style="text-align: center; margin-top: 25px;">
                 <button type="submit" class="btn btn-success btn-lg">ğŸ’¾ ×¦×•×¨ ×¡×•×’ ×ª×¨×•××”</button>
                 <button type="button" class="btn btn-secondary" onclick="closeModal('addDonationTypeModal')">âŒ ×‘×˜×œ</button>
             </div>
         </form>
     </div>
 </div>

 <!-- ××•×“×œ ×¢×¨×™×›×ª ×¡×•×’ ×ª×¨×•××” -->
 <div id="editDonationTypeModal" class="modal">
     <div class="modal-content">
         <div class="modal-header">
             <h3>âœï¸ ×¢×¨×™×›×ª ×¡×•×’ ×ª×¨×•××”</h3>
             <button class="modal-close" onclick="closeModal('editDonationTypeModal')">&times;</button>
         </div>
         <form id="editDonationTypeForm">
             <input type="hidden" id="editDonationTypeId">
             
             <div class="form-group">
                 <label>ğŸ“ ×©× ×”×ª×¨×•××”: *</label>
                 <input type="text" id="editDonationTypeName" class="form-control" required>
             </div>
             
             <div class="form-group">
                 <label>ğŸ”— ×§×™×©×•×¨ ×“×£ ×”×—×™×•×‘: *</label>
                 <input type="url" id="editDonationTypeUrl" class="form-control" required>
             </div>
             
             <div class="form-group">
                 <label>ğŸ“ ×ª×™××•×¨:</label>
                 <textarea id="editDonationTypeDescription" class="form-control" rows="3"></textarea>
             </div>
             
             <div class="form-row">
                 <div class="form-group">
                     <label>ğŸ“… ×ª××¨×™×š ×”×ª×—×œ×”:</label>
                     <input type="date" id="editDonationTypeStartDate" class="form-control">
                 </div>
                 <div class="form-group">
                     <label>ğŸ“… ×ª××¨×™×š ×¡×™×•×:</label>
                     <input type="date" id="editDonationTypeEndDate" class="form-control">
                 </div>
             </div>
             
             <div class="form-row">
                 <div class="form-group">
                     <label>
                         <input type="checkbox" id="editDonationTypeNoExpiry"> 
                         â™¾ï¸ ×œ×œ× ×ª××¨×™×š ×¤×§×™×¢×”
                     </label>
                 </div>
                 <div class="form-group">
                     <label>
                         <input type="checkbox" id="editDonationTypeIsActive"> 
                         âœ… ×¤×¢×™×œ ×‘××¢×¨×›×ª
                     </label>
                 </div>
             </div>
             
             <div style="text-align: center; margin-top: 25px;">
                 <button type="submit" class="btn btn-success btn-lg">ğŸ’¾ ×©××•×¨ ×©×™× ×•×™×™×</button>
                 <button type="button" class="btn btn-danger" onclick="deleteDonationType()">ğŸ—‘ï¸ ××—×§ ×¡×•×’ ×ª×¨×•××”</button>
                 <button type="button" class="btn btn-secondary" onclick="closeModal('editDonationTypeModal')">âŒ ×‘×˜×œ</button>
             </div>
         </form>
     </div>
 </div>

 <!-- ××•×“×œ ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
 <div id="donationStatsModal" class="modal">
     <div class="modal-content">
         <div class="modal-header">
             <h3>ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×©×™××•×© ×‘×ª×¨×•××•×ª</h3>
             <button class="modal-close" onclick="closeModal('donationStatsModal')">&times;</button>
         </div>
         <div>
             <div class="search-filters">
                 <div class="form-group">
                     <label>ğŸ“… ××ª××¨×™×š:</label>
                     <input type="date" id="statsFromDate" class="form-control" onchange="loadDonationStats()">
                 </div>
                 <div class="form-group">
                     <label>ğŸ“… ×¢×“ ×ª××¨×™×š:</label>
                     <input type="date" id="statsToDate" class="form-control" onchange="loadDonationStats()">
                 </div>
                 <div class="form-group">
                     <button class="btn btn-admin" onclick="loadDonationStats()" style="margin-top: 25px;">
                         ğŸ”„ ×¨×¢× ×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
                     </button>
                 </div>
             </div>
             
             <div class="table-container">
                 <table class="table">
                     <thead>
                         <tr>
                             <th>ğŸ’³ ×©× ×”×ª×¨×•××”</th>
                             <th>ğŸ‘ï¸ ×¦×¤×™×•×ª</th>
                             <th>ğŸ‘¤ ××©×ª××©×™× ×™×™×—×•×“×™×™×</th>
                             <th>ğŸ“… ×’×™×©×” ××—×¨×•× ×”</th>
                             <th>ğŸ† ×”××©×ª××© ×”×¤×¢×™×œ ×‘×™×•×ª×¨</th>
                         </tr>
                     </thead>
                     <tbody id="donationStatsBody">
                         <tr>
                             <td colspan="5" class="text-center">
                                 <div class="loading">
                                     <div class="loading-spinner"></div>
                                     ×˜×•×¢×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª...
                                 </div>
                             </td>
                         </tr>
                     </tbody>
                 </table>
             </div>
         </div>
     </div>
 </div>

 <!-- ××•×“×œ ×œ×•×’×™ ×’×™×©×” -->
 <div id="donationLogsModal" class="modal">
     <div class="modal-content">
         <div class="modal-header">
             <h3>ğŸ“‹ ×œ×•×’×™ ×’×™×©×” ×œ×ª×¨×•××•×ª</h3>
             <button class="modal-close" onclick="closeModal('donationLogsModal')">&times;</button>
         </div>
         <div>
             <div class="table-container">
                 <table class="table">
                     <thead>
                         <tr>
                             <th>ğŸ“… ×–××Ÿ</th>
                             <th>ğŸ‘¤ ××©×ª××©</th>
                             <th>ğŸ’³ ×¡×•×’ ×ª×¨×•××”</th>
                             <th>âš¡ ×¤×¢×•×œ×”</th>
                             <th>ğŸŒ IP</th>
                         </tr>
                     </thead>
                     <tbody id="donationLogsBody">
                         <tr>
                             <td colspan="5" class="text-center">
                                 <div class="loading">
                                     <div class="loading-spinner"></div>
                                     ×˜×•×¢×Ÿ ×œ×•×’×™×...
                                 </div>
                             </td>
                         </tr>
                     </tbody>
                 </table>
             </div>
         </div>
     </div>
 </div>

  <script>
      // ××©×ª× ×™ ×’×œ×•×‘×œ×™×™×
      let currentUser = null;
      let authToken = null;
      let allDonors = [];
      let filteredDonors = [];
      let allUsers = [];
      let selectedDonors = new Set();
      let currentPage = 1;
      let itemsPerPage = 50;
      let sortColumn = '';
      let sortDirection = 'asc';

      // ×˜×¢×™× ×ª ×”×“×£
      window.onload = function() {
          console.log('ğŸ‘‘ ×¤×× ×œ ××“××™×Ÿ × ×˜×¢×Ÿ');
          checkAuthentication();
          
          // ×‘×“×™×§×ª ××¦×‘ ×œ×™×œ×”
          if (localStorage.getItem('darkMode') === 'true') {
              document.body.classList.add('dark-mode');
              updateDarkModeButton();
          }
      };

      // ×‘×“×™×§×ª ×”×–×“×”×•×ª
      function checkAuthentication() {
          const token = localStorage.getItem('authToken');
          const user = localStorage.getItem('currentUser');
          
          if (!token || !user) {
              console.log('âŒ ×œ× ××–×•×”×” - ××¤× ×” ×œ×“×£ ×”×ª×—×‘×¨×•×ª');
              window.location.href = 'login.html';
              return;
          }
          
          try {
              currentUser = JSON.parse(user);
              authToken = token;
              
              // ×‘×“×™×§×” ×©×”××©×ª××© ×”×•× ××“××™×Ÿ
              if (currentUser.role !== 'admin') {
                  console.log('ğŸ”„ ×œ× ××“××™×Ÿ - ××¤× ×” ×œ×××©×§ ×˜×œ×¤×Ÿ');
                  window.location.href = 'index.html';
                  return;
              }
              
              console.log('âœ… ××“××™×Ÿ ××–×•×”×”:', currentUser.username);
              initializeAdminPanel();
              
          } catch (error) {
              console.error('âŒ ×©×’×™××” ×‘×¤×¢× ×•×— × ×ª×•× ×™ ××©×ª××©:', error);
              logout();
          }
      }

      // ××ª×—×•×œ ×¤×× ×œ ×”××“××™×Ÿ
      function initializeAdminPanel() {
          // ×¢×“×›×•×Ÿ ×‘×¨×›×”
          const welcomeEl = document.getElementById('adminWelcome');
          const fullName = currentUser.full_name || currentUser.username;
          welcomeEl.textContent = `×©×œ×•× ${fullName} `;
          
          // ×˜×¢×™× ×ª × ×ª×•× ×™× ×¨××©×•× ×™×™×
          loadDashboardData();
          
          // ×”×•×¡×¤×ª event listeners
          setupEventListeners();
          
          console.log('âœ… ×¤×× ×œ ××“××™×Ÿ ×”×•×›×Ÿ ×‘×”×¦×œ×—×”');
      }

// ×¤×•× ×§×¦×™×•×ª ×˜×™×¤×•×œ ×‘×˜×¤×¡×™× - ×¦×¨×™×›×•×ª ×œ×”×™×•×ª ××•×’×“×¨×•×ª ×œ×¤× ×™ setupEventListeners
async function handleAddDonationType(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('donationTypeName').value.trim(),
        url: document.getElementById('donationTypeUrl').value.trim(),
        description: document.getElementById('donationTypeDescription').value.trim(),
        start_date: document.getElementById('donationTypeStartDate').value || null,
        end_date: document.getElementById('donationTypeEndDate').value || null,
        no_expiry: document.getElementById('donationTypeNoExpiry').checked
    };
    
    if (!formData.name || !formData.url) {
        showNotification('×©× ×•-URL × ×“×¨×©×™×', 'error');
        return;
    }
    
    try {
        const response = await fetch('/api/admin/donation-types', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×¡×•×’ ×ª×¨×•××” × ×•×¦×¨ ×‘×”×¦×œ×—×”! ğŸ’³', 'success');
            closeModal('addDonationTypeModal');
            document.getElementById('addDonationTypeForm').reset();
            loadDonationTypesAdmin();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×™×¦×™×¨×ª ×¡×•×’ ×ª×¨×•××”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

async function handleEditDonationType(e) {
    e.preventDefault();
    
    const id = document.getElementById('editDonationTypeId').value;
    const formData = {
        name: document.getElementById('editDonationTypeName').value.trim(),
        url: document.getElementById('editDonationTypeUrl').value.trim(),
        description: document.getElementById('editDonationTypeDescription').value.trim(),
        start_date: document.getElementById('editDonationTypeStartDate').value || null,
        end_date: document.getElementById('editDonationTypeEndDate').value || null,
        no_expiry: document.getElementById('editDonationTypeNoExpiry').checked,
        is_active: document.getElementById('editDonationTypeIsActive').checked
    };
    
    if (!formData.name || !formData.url) {
        showNotification('×©× ×•-URL × ×“×¨×©×™×', 'error');
        return;
    }
    
    try {
        const response = await fetch(`/api/admin/donation-types/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×¡×•×’ ×ª×¨×•××” ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”! âœï¸', 'success');
            closeModal('editDonationTypeModal');
            loadDonationTypesAdmin();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¡×•×’ ×ª×¨×•××”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×¤×•× ×§×¦×™×•×ª ×˜×™×¤×•×œ ×‘×˜×¤×¡×™× ××—×¨×™× - ×–×× ×™×•×ª
async function handleAddDonor(e) { e.preventDefault(); console.log('×”×•×¡×¤×ª ×ª×•×¨×'); }
async function handleEditDonor(e) { e.preventDefault(); console.log('×¢×¨×™×›×ª ×ª×•×¨×'); }
async function handleAddUser(e) { e.preventDefault(); console.log('×”×•×¡×¤×ª ××©×ª××©'); }
async function handleEditUser(e) { e.preventDefault(); console.log('×¢×¨×™×›×ª ××©×ª××©'); }
async function handleCreateMessage(e) { e.preventDefault(); console.log('×™×¦×™×¨×ª ×”×•×“×¢×”'); }
async function handleBulkEdit(e) { e.preventDefault(); console.log('×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª'); }

// ×”×’×“×¨×ª ×××–×™× ×™ ××™×¨×•×¢×™×
function setupEventListeners() {
    // checkbox ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª
    document.getElementById('bulkEditCity').addEventListener('change', function(e) {
        document.getElementById('bulkCityValue').disabled = !e.target.checked;
    });
    
    document.getElementById('bulkEditType').addEventListener('change', function(e) {
        document.getElementById('bulkTypeValue').disabled = !e.target.checked;
    });
    
    document.getElementById('bulkEditStatus').addEventListener('change', function(e) {
        document.getElementById('bulkStatusValue').disabled = !e.target.checked;
    });

    // ×˜×¤×¡×™× - ×‘×“×™×§×” ×©×”××œ×× ×˜×™× ×§×™×™××™× ×œ×¤× ×™ ×”×—×™×‘×•×¨
    const addDonorForm = document.getElementById('addDonorForm');
    const editDonorForm = document.getElementById('editDonorForm');
    const addUserForm = document.getElementById('addUserForm');
    const editUserForm = document.getElementById('editUserForm');
    const createMessageForm = document.getElementById('createMessageForm');
    const bulkEditForm = document.getElementById('bulkEditForm');
    
    if (addDonorForm) addDonorForm.addEventListener('submit', handleAddDonor);
    if (editDonorForm) editDonorForm.addEventListener('submit', handleEditDonor);
    if (addUserForm) addUserForm.addEventListener('submit', handleAddUser);
    if (editUserForm) editUserForm.addEventListener('submit', handleEditUser);
    if (createMessageForm) createMessageForm.addEventListener('submit', handleCreateMessage);
    if (bulkEditForm) bulkEditForm.addEventListener('submit', handleBulkEdit);

    // drag & drop ×œ×§×‘×¦×™×
    const uploadArea = document.getElementById('uploadArea');
    if (uploadArea) {
        uploadArea.addEventListener('dragenter', handleDragEnter);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
    }

    // ×”×’×“×¨×•×ª ×—×“×©×•×ª ×œ× ×™×”×•×œ ×ª×¨×•××•×ª - ×™×ª×—×‘×¨×• ×¨×§ ×× ×”×˜×¤×¡×™× ×§×™×™××™×
    const addDonationForm = document.getElementById('addDonationTypeForm');
    const editDonationForm = document.getElementById('editDonationTypeForm');
    
    if (addDonationForm) {
        addDonationForm.addEventListener('submit', handleAddDonationType);
    }
    if (editDonationForm) {
        editDonationForm.addEventListener('submit', handleEditDonationType);
    }
    
    // checkbox ×¢×‘×•×¨ ×ª××¨×™×›×™ ×ª×¨×•××•×ª
    const noExpiryCheckbox = document.getElementById('donationTypeNoExpiry');
    if (noExpiryCheckbox) {
        noExpiryCheckbox.addEventListener('change', function(e) {
            const startDate = document.getElementById('donationTypeStartDate');
            const endDate = document.getElementById('donationTypeEndDate');
            
            if (startDate && endDate) {
                if (e.target.checked) {
                    startDate.disabled = true;
                    endDate.disabled = true;
                    startDate.value = '';
                    endDate.value = '';
                } else {
                    startDate.disabled = false;
                    endDate.disabled = false;
                }
            }
        });
    }

    const editNoExpiryCheckbox = document.getElementById('editDonationTypeNoExpiry');
    if (editNoExpiryCheckbox) {
        editNoExpiryCheckbox.addEventListener('change', function(e) {
            const startDate = document.getElementById('editDonationTypeStartDate');
            const endDate = document.getElementById('editDonationTypeEndDate');
            
            if (startDate && endDate) {
                if (e.target.checked) {
                    startDate.disabled = true;
                    endDate.disabled = true;
                    startDate.value = '';
                    endDate.value = '';
                } else {
                    startDate.disabled = false;
                    endDate.disabled = false;
                }
            }
        });
    }
}

      // ××¦×‘ ×œ×™×œ×”
      function toggleDarkMode() {
          document.body.classList.toggle('dark-mode');
          const isDark = document.body.classList.contains('dark-mode');
          localStorage.setItem('darkMode', isDark);
          updateDarkModeButton();
      }

      function updateDarkModeButton() {
          const isDark = document.body.classList.contains('dark-mode');
          document.getElementById('darkModeIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
          document.getElementById('darkModeText').textContent = isDark ? '××¦×‘ ×™×•×' : '××¦×‘ ×œ×™×œ×”';
      }

// ×”×—×œ×£ ××ª ×”×¤×•× ×§×¦×™×” showTab ×”×§×™×™××ª ×¢× ×”×’×¨×¡×” ×”××ª×•×§× ×ª ×”×–×•:
function showTab(tabName) {
    console.log('ğŸ”„ ××¢×‘×¨ ×œ×˜××‘:', tabName); // ×œ×“×™×‘×•×’
    
    // ×”×¡×¨×ª active ××›×œ ×”×œ×©×•× ×™×•×ª
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // ×”×¡×ª×¨×ª ×›×œ ×”×ª×•×›×Ÿ
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // ×”×¦×’×ª ×”×œ×©×•× ×™×ª ×”× ×‘×—×¨×ª
    const activeTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    const tabContent = document.getElementById(`${tabName}Tab`);
    if (tabContent) {
        tabContent.classList.remove('hidden');
    } else {
        console.error('âŒ ×œ× × ××¦× ×ª×•×›×Ÿ ×¢×‘×•×¨ ×˜××‘:', tabName);
    }
    
    // ×˜×¢×™× ×ª × ×ª×•× ×™× ×¡×¤×¦×™×¤×™×™× ×œ×œ×©×•× ×™×ª
    switch(tabName) {
        case 'dashboard':
            loadDashboardData();
            break;
        case 'donors':
            loadDonors();
            break;
        case 'users':
            loadUsers();
            break;
        case 'reports':
            loadReports();
            break;
        case 'upload':
            loadUploadHistory();
            break;
        case 'messages':
            loadMessages();
            break;
        case 'tickets':
            loadTickets();
            break;
        case 'logs':
            loadLogs();
            break;
        case 'donation-management':
            loadDonationTypesAdmin();
            break;
        default:
            console.warn('âš ï¸ ×˜××‘ ×œ× ××•×›×¨:', tabName);
    }
}

      // ×˜×¢×™× ×ª × ×ª×•× ×™ ×œ×•×— ×”×‘×§×¨×”
      async function loadDashboardData() {
          try {
              const response = await fetch('/api/admin/dashboard', {
                  headers: { 'Authorization': `Bearer ${authToken}` }
              });
              
              if (response.ok) {
                  const data = await response.json();
                  updateDashboardStats(data);
                  loadRecentActivity();
              }
          } catch (error) {
              console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×— ×‘×§×¨×”:', error);
          }
      }

      function updateDashboardStats(data) {
          document.getElementById('totalDonors').textContent = data.totalDonors || 0;
          document.getElementById('totalUsers').textContent = data.totalUsers || 0;
          document.getElementById('totalSearches').textContent = data.totalSearches || 0;
          document.getElementById('openTickets').textContent = data.openTickets || 0;
          document.getElementById('dailyActivity').textContent = data.dailyActivity || 0;
          
          // ×¢×“×›×•×Ÿ ×©×™× ×•×™×™×
          document.getElementById('donorsChange').textContent = `+${data.donorsChange || 0} ×”×©×‘×•×¢`;
          document.getElementById('usersChange').textContent = `+${data.usersChange || 0} ×”×—×•×“×©`;
          document.getElementById('searchesChange').textContent = `+${data.searchesChange || 0}% ×××ª××•×œ`;
          document.getElementById('ticketsChange').textContent = `-${data.ticketsChange || 0} ×××ª××•×œ`;
      }

      // ×˜×¢×™× ×ª ×¤×¢×™×œ×•×ª ××—×¨×•× ×”
      async function loadRecentActivity() {
          try {
              const response = await fetch('/api/admin/recent-activity', {
                  headers: { 'Authorization': `Bearer ${authToken}` }
              });
              
              if (response.ok) {
                  const activities = await response.json();
                  displayRecentActivity(activities);
              }
          } catch (error) {
              console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¢×™×œ×•×ª:', error);
              document.getElementById('recentActivity').innerHTML = 
                  '<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><h3>×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</h3></div>';
          }
      }

      function displayRecentActivity(activities) {
          const container = document.getElementById('recentActivity');
          
          if (activities.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <div class="empty-state-icon">ğŸ“Š</div>
                      <h3>××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h3>
                      <p>×¤×¢×™×œ×•×™×•×ª ×”××¢×¨×›×ª ×™×•×¤×™×¢×• ×›××Ÿ</p>
                  </div>
              `;
              return;
          }
          
          container.innerHTML = activities.map(activity => `
              <div class="message ${getActivityType(activity.action)}" style="margin-bottom: 10px;">
                  <div>
                      <strong>${activity.username || '××©×ª××© ×œ× ×™×“×•×¢'}</strong>
                      <span>${getActivityText(activity.action)}</span>
                      ${activity.details ? `<span class="text-muted">- ${activity.details}</span>` : ''}
                      <br>
                      <small class="text-muted">
                          ğŸ• ${new Date(activity.created_at).toLocaleString('he-IL')}
                          ${activity.ip_address ? `| ğŸŒ ${activity.ip_address}` : ''}
                      </small>
                  </div>
              </div>
          `).join('');
      }

function getActivityType(action) {
          const typeMap = {
              'LOGIN': 'info',
              'SEARCH': 'info',
              'CREATE_DONOR': 'success',
              'UPDATE_DONOR': 'warning',
              'DELETE_DONOR': 'error',
              'CSV_UPLOAD': 'success',
              'CREATE_USER': 'success',
              'UPDATE_USER': 'warning'
          };
          return typeMap[action] || 'info';
      }

      function getActivityText(action) {
          const textMap = {
              'LOGIN': '×”×ª×—×‘×¨ ×œ××¢×¨×›×ª',
              'SEARCH': '×‘×™×¦×¢ ×—×™×¤×•×©',
              'CREATE_DONOR': '×™×¦×¨ ×ª×•×¨× ×—×“×©',
              'UPDATE_DONOR': '×¢×“×›×Ÿ ×ª×•×¨×',
              'DELETE_DONOR': '××—×§ ×ª×•×¨×',
              'CSV_UPLOAD': '×”×¢×œ×” ×§×•×‘×¥ CSV',
              'CREATE_USER': '×™×¦×¨ ××©×ª××© ×—×“×©',
              'UPDATE_USER': '×¢×“×›×Ÿ ××©×ª××©'
          };
          return textMap[action] || action;
      }

      // ×˜×¢×™× ×ª ×ª×•×¨××™×
async function loadDonors() {
    try {
        showLoading('donorsTableBody');
        
        const response = await fetch('/api/admin/donors?page=1&limit=1000', {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            const data = await response.json();
            allDonors = data.donors || [];
            filteredDonors = [...allDonors];
            displayDonors();
            populateFilterOptions();
        } else {
            throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×•×¨××™×');
        }
    } catch (error) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×•×¨××™×:', error);
        document.getElementById('donorsTableBody').innerHTML = 
            '<tr><td colspan="9" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
    }
}

function displayDonors() {
    const tbody = document.getElementById('donorsTableBody');
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    
    if (filteredDonors.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" class="text-center">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ‘¥</div>
                        <h3>××™×Ÿ ×ª×•×¨××™× ×œ×”×¦×’×”</h3>
						                       <p>× ×¡×” ×œ×©× ×•×ª ××ª ×”×¡×™× ×•× ×™× ××• ×œ×”×•×¡×™×£ ×ª×•×¨××™× ×—×“×©×™×</p>
                   </div>
               </td>
           </tr>
       `;
       return;
   }
   
   const paginatedDonors = filteredDonors.slice(startIndex, endIndex);
   
   tbody.innerHTML = paginatedDonors.map(donor => `
       <tr ${selectedDonors.has(donor.id) ? 'class="selected"' : ''}>
           <td>
               <input type="checkbox" 
                      ${selectedDonors.has(donor.id) ? 'checked' : ''}
                      onchange="toggleDonorSelection(${donor.id})">
           </td>
           <td>
               <strong>${donor.name || ''}</strong>
               ${donor.donations_count > 1 ? `
                   <br><small class="text-muted">${donor.donations_count} ×ª×¨×•××•×ª</small>
               ` : ''}
           </td>
           <td>${donor.phone || ''}</td>
           <td>${donor.email || ''}</td>
           <td>${donor.city || ''}</td>
           <td>
               ${donor.total_amount ? `
                   <span class="badge badge-success">â‚ª${donor.total_amount.toLocaleString()}</span>
               ` : ''}
           </td>
           <td>
               <span class="badge ${donor.donations_count > 1 ? 'badge-warning' : 'badge-info'}">
                   ${donor.donations_count > 1 ? '×ª×•×¨× ×—×•×–×¨' : '×ª×¨×•××” ×™×—×™×“×”'}
               </span>
           </td>
           <td>${new Date(donor.created_at).toLocaleDateString('he-IL')}</td>
           <td>
               <button class="btn btn-info btn-sm" onclick="editDonor(${donor.id})" title="×¢×¨×™×›×”">
                   âœï¸
               </button>
               <button class="btn btn-danger btn-sm" onclick="confirmDeleteDonor(${donor.id})" title="××—×™×§×”">
                   ğŸ—‘ï¸
               </button>
               ${donor.donations_count > 1 ? `
                   <button class="btn btn-success btn-sm" onclick="viewDonorDetails(${donor.id})" title="×¤×¨×˜×™× ××œ××™×">
                       ğŸ“Š
                   </button>
               ` : ''}
           </td>
       </tr>
   `).join('');
   
   updatePagination('donorsPagination', filteredDonors.length);
   updateSelectionControls();
}

async function viewDonorDetails(donorId) {
   try {
       // ×§×‘×œ×ª ×›×œ ×”×ª×¨×•××•×ª ×©×œ ×”×ª×•×¨×
       const response = await fetch(`/api/admin/donor/${donorId}/all-donations`, {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const donations = await response.json();
           displayDonorDetailsModal(donations);
       } else {
           showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×˜×™ ×ª×•×¨×', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

function displayDonorDetailsModal(donations) {
   if (donations.length === 0) {
       showNotification('×œ× × ××¦××• ×ª×¨×•××•×ª ×œ×ª×•×¨× ×–×”', 'warning');
       return;
   }
   
   const firstDonation = donations[0];
   const totalAmount = donations.reduce((sum, d) => {
       const amount = d.payment_amount ? 
           parseFloat(d.payment_amount.replace('â‚ª', '').replace(/,/g, '')) || 0 : 
           d.donation_amount || 0;
       return sum + amount;
   }, 0);
   
   const modal = document.createElement('div');
   modal.className = 'modal show';
   modal.innerHTML = `
       <div class="modal-content" style="max-width: 1000px;">
           <div class="modal-header">
               <h3>ğŸ‘¤ ×¤×¨×˜×™ ×ª×•×¨× ××œ××™×</h3>
               <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
           </div>
           <div>
               <div class="card">
                   <h4>${firstDonation.name || (firstDonation.first_name + ' ' + firstDonation.last_name)}</h4>
                   
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                       <div><strong>ğŸ“ ×˜×œ×¤×•×Ÿ:</strong> ${firstDonation.phone || ''}</div>
                       <div><strong>ğŸ“§ ××™××™×™×œ:</strong> ${firstDonation.email || ''}</div>
                       <div><strong>ğŸŒ† ×¢×™×¨:</strong> ${firstDonation.city || ''}</div>
                       <div><strong>ğŸ  ×¨×—×•×‘:</strong> ${firstDonation.street || ''}</div>
                       <div><strong>ğŸ¢ ×‘× ×™×™×Ÿ:</strong> ${firstDonation.building || ''}</div>
                       <div><strong>ğŸšª ×“×™×¨×”:</strong> ${firstDonation.apartment || ''}</div>
                       <div><strong>ğŸ’° ×¡×”"×› ×ª×¨×:</strong> â‚ª${totalAmount.toLocaleString()}</div>
                       <div><strong>ğŸ¯ ××¡×¤×¨ ×ª×¨×•××•×ª:</strong> ${donations.length}</div>
                   </div>
                   
                   <div style="margin-top: 25px;">
                       <h4>ğŸ’° ×”×™×¡×˜×•×¨×™×™×ª ×ª×¨×•××•×ª:</h4>
                       <div style="max-height: 500px; overflow-y: auto;">
                           ${donations.map((donation, index) => `
                               <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                                   <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                       <h5>×ª×¨×•××” #${index + 1} ${donation.order_number ? `(×”×–×× ×”: ${donation.order_number})` : ''}</h5>
                                       <span class="badge badge-success">${donation.payment_status || '×œ× ×™×“×•×¢'}</span>
                                   </div>
                                   
                                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                       ${donation.project_name ? `<div><strong>ğŸ“‹ ×¤×¨×•×™×§×˜:</strong> ${donation.project_name}</div>` : ''}
                                       ${donation.prayer_name ? `<div><strong>ğŸ™ ×©× ×œ×ª×¤×™×œ×”:</strong> ${donation.prayer_name}</div>` : ''}
                                       ${donation.payment_amount ? `<div><strong>ğŸ’° ×¡×›×•×:</strong> ${donation.payment_amount} ×©"×—</div>` : ''}
                                       ${donation.payment_method ? `<div><strong>ğŸ’³ ×ª×©×œ×•×:</strong> ${donation.payment_method}</div>` : ''}
                                       ${donation.delivery_date ? `<div><strong>ğŸ“… ××¡×™×¨×”:</strong> ${donation.delivery_date}</div>` : ''}
                                       ${donation.marketing_source ? `<div><strong>ğŸ“¢ ××§×•×¨:</strong> ${donation.marketing_source}</div>` : ''}
                                   </div>
                                   
                                   ${donation.comments ? `
                                       <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                                           <strong>ğŸ’¬ ×”×¢×¨×•×ª:</strong> ${donation.comments}
                                       </div>
                                   ` : ''}
                                   
                                   <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                       ğŸ“… ${new Date(donation.created_at).toLocaleDateString('he-IL')} ${new Date(donation.created_at).toLocaleTimeString('he-IL')}
                                   </div>
                               </div>
                           `).join('')}
                       </div>
                   </div>
                   
                   <div style="text-align: center; margin-top: 25px;">
                       <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                           âŒ ×¡×’×•×¨
                       </button>
                   </div>
               </div>
           </div>
       </div>
   `;
   document.body.appendChild(modal);
}

// ×¤×•× ×§×¦×™×” ×œ×™×™×¦×•× × ×ª×•× ×™ ×ª×•×¨× ×¡×¤×¦×™×¤×™
function exportDonorData(donorId) {
    // ××™××•×© ×™×™×¦×•× × ×ª×•× ×™ ×”×ª×•×¨×
    showNotification('××™×™×¦× × ×ª×•× ×™ ×ª×•×¨×...', 'info');
}

      function getDonorTypeBadge(type) {
          const badgeMap = {
              'VIP': 'badge-warning',
              '×§×‘×•×¢': 'badge-success',
              '×¨×’×™×œ': 'badge-info',
              '×—×“×©': 'badge-secondary'
          };
          return badgeMap[type] || 'badge-info';
      }

      function populateFilterOptions() {
          // ××™×œ×•×™ ×¡×™× ×•×Ÿ ×¢×¨×™×
          const cities = [...new Set(allDonors.map(d => d.city).filter(c => c))].sort();
          const cityFilter = document.getElementById('cityFilter');
          cityFilter.innerHTML = '<option value="">×›×œ ×”×¢×¨×™×</option>' +
              cities.map(city => `<option value="${city}">${city}</option>`).join('');
      }

      // ×¡×™× ×•×Ÿ ×ª×•×¨××™×
      function filterDonors() {
          const searchTerm = document.getElementById('donorSearch').value.toLowerCase();
          const cityFilter = document.getElementById('cityFilter').value;
          const typeFilter = document.getElementById('typeFilter').value;
          const statusFilter = document.getElementById('statusFilter').value;
          
          filteredDonors = allDonors.filter(donor => {
              const matchesSearch = !searchTerm || 
                  (donor.name && donor.name.toLowerCase().includes(searchTerm)) ||
                  (donor.phone && donor.phone.includes(searchTerm)) ||
                  (donor.email && donor.email.toLowerCase().includes(searchTerm));
              
              const matchesCity = !cityFilter || donor.city === cityFilter;
              const matchesType = !typeFilter || donor.donor_type === typeFilter;
              const matchesStatus = !statusFilter || donor.status === statusFilter;
              
              return matchesSearch && matchesCity && matchesType && matchesStatus;
          });
          
          currentPage = 1;
          displayDonors();
      }

      function clearFilters() {
          document.getElementById('donorSearch').value = '';
          document.getElementById('cityFilter').value = '';
          document.getElementById('typeFilter').value = '';
          document.getElementById('statusFilter').value = '';
          filteredDonors = [...allDonors];
          currentPage = 1;
          displayDonors();
      }

      // ×‘×—×™×¨×ª ×ª×•×¨××™×
      function toggleDonorSelection(donorId) {
          if (selectedDonors.has(donorId)) {
              selectedDonors.delete(donorId);
          } else {
              selectedDonors.add(donorId);
          }
          updateSelectionControls();
          displayDonors();
      }

      function toggleSelectAll() {
          const checkbox = document.getElementById('selectAllDonors');
          const currentPageDonors = filteredDonors.slice(
              (currentPage - 1) * itemsPerPage,
              currentPage * itemsPerPage
          );
          
          if (checkbox.checked) {
              currentPageDonors.forEach(donor => selectedDonors.add(donor.id));
          } else {
              currentPageDonors.forEach(donor => selectedDonors.delete(donor.id));
          }
          
          updateSelectionControls();
          displayDonors();
      }

      function updateSelectionControls() {
          const count = selectedDonors.size;
          const controls = document.getElementById('donorSelectionControls');
          const countEl = document.getElementById('selectedCount');
          
          if (count > 0) {
              controls.classList.add('show');
              countEl.textContent = count;
			  } else {
              controls.classList.remove('show');
          }
      }

      function clearSelection() {
          selectedDonors.clear();
          updateSelectionControls();
          displayDonors();
          document.getElementById('selectAllDonors').checked = false;
      }

      // ××™×•×Ÿ ×˜×‘×œ×”
      function sortTable(column) {
          if (sortColumn === column) {
              sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
          } else {
              sortColumn = column;
              sortDirection = 'asc';
          }
          
          filteredDonors.sort((a, b) => {
              let aVal = a[column] || '';
              let bVal = b[column] || '';
              
              if (column === 'donation_amount') {
                  aVal = parseFloat(aVal) || 0;
                  bVal = parseFloat(bVal) || 0;
              } else if (column === 'created_at') {
                  aVal = new Date(aVal);
                  bVal = new Date(bVal);
              } else {
                  aVal = aVal.toString().toLowerCase();
                  bVal = bVal.toString().toLowerCase();
              }
              
              if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
              if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
              return 0;
          });
          
          displayDonors();
          updateSortIndicators();
      }

      function updateSortIndicators() {
          document.querySelectorAll('.sort-indicator').forEach(indicator => {
              indicator.textContent = 'â‡…';
          });
          
          if (sortColumn) {
              const header = document.querySelector(`th[onclick="sortTable('${sortColumn}')"] .sort-indicator`);
              if (header) {
                  header.textContent = sortDirection === 'asc' ? 'â†‘' : 'â†“';
              }
          }
      }

      // ×¢××•×“×•× ×™×
      function updatePagination(containerId, totalItems) {
          const container = document.getElementById(containerId);
          const totalPages = Math.ceil(totalItems / itemsPerPage);
          
          if (totalPages <= 1) {
              container.innerHTML = '';
              return;
          }
          
          let html = '';
          
          // ×›×¤×ª×•×¨ ×”×§×•×“×
          html += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Â« ×”×§×•×“×</button>`;
          
          // ××¡×¤×¨×™ ×¢××•×“×™×
          for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
              html += `<button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>${i}</button>`;
          }
          
          // ×›×¤×ª×•×¨ ×”×‘×
          html += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>×”×‘× Â»</button>`;
          
          container.innerHTML = html;
      }

      function changePage(page) {
          currentPage = page;
          displayDonors();
      }

      // ×˜×¢×™× ×ª ××©×ª××©×™×
      async function loadUsers() {
          try {
              showLoading('usersTableBody');
              
              const response = await fetch('/api/admin/users', {
                  headers: { 'Authorization': `Bearer ${authToken}` }
              });
              
              if (response.ok) {
                  allUsers = await response.json();
                  displayUsers();
                  populateUserSelects();
              } else {
                  throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ××©×ª××©×™×');
              }
          } catch (error) {
              console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ××©×ª××©×™×:', error);
              document.getElementById('usersTableBody').innerHTML = 
                  '<tr><td colspan="10" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
          }
      }

      function displayUsers() {
          const tbody = document.getElementById('usersTableBody');
          
          if (allUsers.length === 0) {
              tbody.innerHTML = `
                  <tr>
                      <td colspan="10" class="text-center">
                          <div class="empty-state">
                              <div class="empty-state-icon">ğŸ‘¤</div>
                              <h3>××™×Ÿ ××©×ª××©×™× ×‘××¢×¨×›×ª</h3>
                              <p>×¦×•×¨ ××©×ª××© ×¨××©×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ</p>
                          </div>
                      </td>
                  </tr>
              `;
              return;
          }
          
          tbody.innerHTML = allUsers.map(user => `
              <tr>
                  <td><strong>${user.username}</strong></td>
                  <td>${user.full_name || ''}</td>
                  <td>${user.email || ''}</td>
                  <td>${user.phone || ''}</td>
                  <td>${user.department || ''}</td>
                  <td>
                      <span class="badge ${user.role === 'admin' ? 'badge-danger' : 'badge-info'}">
                          ${user.role === 'admin' ? '××“××™×Ÿ' : '×˜×œ×¤×Ÿ'}
                      </span>
                  </td>
                  <td>
                      <span class="badge ${user.is_active ? 'badge-success' : 'badge-secondary'}">
                          ${user.is_active ? '×¤×¢×™×œ' : '×œ× ×¤×¢×™×œ'}
                      </span>
                  </td>
                  <td>${user.last_login ? new Date(user.last_login).toLocaleString('he-IL') : '××£ ×¤×¢×'}</td>
                  <td>${user.login_count || 0}</td>
                  <td>
                      <button class="btn btn-info btn-sm" onclick="editUser(${user.id})" title="×¢×¨×™×›×”">
                          âœï¸
                      </button>
                      <button class="btn btn-warning btn-sm" onclick="resetUserPassword(${user.id})" title="××™×¤×•×¡ ×¡×™×¡××”">
                          ğŸ”’
                      </button>
                      <button class="btn btn-success btn-sm" onclick="viewUserLogs(${user.id})" title="×œ×•×’×™×">
                          ğŸ“‹
                      </button>
                      ${user.username !== currentUser.username ? `
                          <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser(${user.id})" title="××—×™×§×”">
                              ğŸ—‘ï¸
                          </button>
                      ` : ''}
                  </td>
              </tr>
          `).join('');
      }

      function populateUserSelects() {
          // ×¢×“×›×•×Ÿ ×¨×©×™××ª ××©×ª××©×™× ×‘×¡×œ×§×˜×™× ×©×•× ×™×
          const userSelect = document.getElementById('targetUserId');
          const reportUserSelect = document.getElementById('userReportFilter');
          const logUserSelect = document.getElementById('logUserFilter');
          
          const options = allUsers.map(user => 
              `<option value="${user.id}">${user.full_name || user.username}</option>`
          ).join('');
          
          if (userSelect) {
              userSelect.innerHTML = '<option value="">×‘×—×¨ ××©×ª××©...</option>' + options;
          }
          if (reportUserSelect) {
              reportUserSelect.innerHTML = '<option value="">×›×œ ×”××©×ª××©×™×</option>' + options;
          }
          if (logUserSelect) {
              logUserSelect.innerHTML = '<option value="">×›×œ ×”××©×ª××©×™×</option>' + options;
          }
      }

      // ×¡×™× ×•×Ÿ ××©×ª××©×™×
      function filterUsers() {
          const searchTerm = document.getElementById('userSearch').value.toLowerCase();
          const roleFilter = document.getElementById('roleFilter').value;
          const statusFilter = document.getElementById('userStatusFilter').value;
          
          let filteredUsers = allUsers.filter(user => {
              const matchesSearch = !searchTerm || 
                  (user.username && user.username.toLowerCase().includes(searchTerm)) ||
                  (user.full_name && user.full_name.toLowerCase().includes(searchTerm));
              
              const matchesRole = !roleFilter || user.role === roleFilter;
              const matchesStatus = statusFilter === '' || user.is_active.toString() === statusFilter;
              
              return matchesSearch && matchesRole && matchesStatus;
          });
          
          // ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ×¢× ××©×ª××©×™× ××¡×•× × ×™×
          const tbody = document.getElementById('usersTableBody');
          tbody.innerHTML = filteredUsers.map(user => `
              <tr>
                  <td><strong>${user.username}</strong></td>
                  <td>${user.full_name || ''}</td>
                  <td>${user.email || ''}</td>
                  <td>${user.phone || ''}</td>
                  <td>${user.department || ''}</td>
                  <td>
                      <span class="badge ${user.role === 'admin' ? 'badge-danger' : 'badge-info'}">
                          ${user.role === 'admin' ? '××“××™×Ÿ' : '×˜×œ×¤×Ÿ'}
                      </span>
                  </td>
                  <td>
                      <span class="badge ${user.is_active ? 'badge-success' : 'badge-secondary'}">
                          ${user.is_active ? '×¤×¢×™×œ' : '×œ× ×¤×¢×™×œ'}
                      </span>
                  </td>
                  <td>${user.last_login ? new Date(user.last_login).toLocaleString('he-IL') : '××£ ×¤×¢×'}</td>
                  <td>${user.login_count || 0}</td>
                  <td>
                      <button class="btn btn-info btn-sm" onclick="editUser(${user.id})" title="×¢×¨×™×›×”">
                          âœï¸
                      </button>
                      <button class="btn btn-warning btn-sm" onclick="resetUserPassword(${user.id})" title="××™×¤×•×¡ ×¡×™×¡××”">
                          ğŸ”’
                      </button>
                      <button class="btn btn-success btn-sm" onclick="viewUserLogs(${user.id})" title="×œ×•×’×™×">
                          ğŸ“‹
                      </button>
                      ${user.username !== currentUser.username ? `
                          <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser(${user.id})" title="××—×™×§×”">
                              ğŸ—‘ï¸
                          </button>
                      ` : ''}
                  </td>
              </tr>
          `).join('');
      }

      // ×”×¦×’×ª loading
      function showLoading(elementId) {
          document.getElementById(elementId).innerHTML = `
              <tr>
                  <td colspan="10" class="text-center">
                      <div class="loading">
                          <div class="loading-spinner"></div>
                          ×˜×•×¢×Ÿ × ×ª×•× ×™×...
                      </div>
                  </td>
              </tr>
          `;
      }

      // ××•×“×œ×™×
      function openModal(modalId) {
          document.getElementById(modalId).classList.add('show');
          document.body.style.overflow = 'hidden';
      }

      function closeModal(modalId) {
          document.getElementById(modalId).classList.remove('show');
          document.body.style.overflow = 'auto';
      }

      // ×”×¦×’×ª ×”×•×“×¢×•×ª
      function showNotification(message, type = 'info', duration = 4000) {
          const notification = document.createElement('div');
          notification.className = `notification-toast message ${type}`;
          notification.style.cssText = `
              position: fixed;
              top: 20px;
              left: 50%;
              transform: translateX(-50%);
              z-index: 9999;
              min-width: 350px;
              max-width: 600px;
              text-align: center;
              box-shadow: 0 8px 32px rgba(0,0,0,0.3);
              animation: slideDown 0.3s ease;
          `;
          
          notification.innerHTML = `
              <div style="display: flex; align-items: center; justify-content: space-between;">
                  <span>${message}</span>
                  <button onclick="this.parentElement.parentElement.remove()" 
                          style="background: none; border: none; color: inherit; cursor: pointer; font-size: 20px; margin-right: 15px;">
                      Ã—
                  </button>
              </div>
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
              if (notification.parentNode) {
                  notification.style.animation = 'slideUp 0.3s ease';
                  setTimeout(() => notification.remove(), 300);
              }
          }, duration);
      }

      // ×”×ª× ×ª×§×•×ª
      function logout() {
          if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª× ×ª×§ ××¤×× ×œ ×”××“××™×Ÿ?')) {
              console.log('ğŸ‘‹ ××“××™×Ÿ ××ª× ×ª×§...');
              localStorage.removeItem('authToken');
              localStorage.removeItem('currentUser');
              window.location.href = 'login.html';
          }
      }

      // ×¤×•× ×§×¦×™×•×ª ×©×™×•×©×œ××• ×‘×”××©×š...
      function showAddDonorModal() { openModal('addDonorModal'); }
      function showAddUserModal() { openModal('addUserModal'); }
      function showCreateMessageModal() { openModal('createMessageModal'); }
      function showBulkEditModal() { 
          if (selectedDonors.size === 0) {
              showNotification('×× × ×‘×—×¨ ×ª×•×¨××™× ×œ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª', 'warning');
              return;
          }
          document.getElementById('bulkEditCount').textContent = `${selectedDonors.size} ×ª×•×¨××™× × ×‘×—×¨×• ×œ×¢×¨×™×›×”`;
          openModal('bulkEditModal'); 
      }

      function loadReports() { console.log('×˜×•×¢×Ÿ ×“×•×—×•×ª...'); }
      function loadUploadHistory() { console.log('×˜×•×¢×Ÿ ×”×™×¡×˜×•×¨×™×™×ª ×”×¢×œ××•×ª...'); }
      function loadMessages() { console.log('×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...'); }
      function loadTickets() { console.log('×˜×•×¢×Ÿ ×›×¨×˜×™×¡×™×...'); }
      function loadLogs() { console.log('×˜×•×¢×Ÿ ×œ×•×’×™×...'); }

      // ××™×¨×•×¢×™ drag & drop
      function handleDragEnter(e) { e.preventDefault(); }
      function handleDragOver(e) { 
          e.preventDefault(); 
          e.currentTarget.classList.add('dragover');
      }
      function handleDragLeave(e) { 
          e.currentTarget.classList.remove('dragover'); 
      }
      function handleDrop(e) { 
          e.preventDefault(); 
          e.currentTarget.classList.remove('dragover');
          console.log('×§×•×‘×¥ × ×’×¨×¨:', e.dataTransfer.files[0]);
      }

      // ×˜×¤×¡×™× - ×™×•×©×œ××• ×‘×”××©×š
      function handleAddDonor(e) { e.preventDefault(); console.log('×”×•×¡×¤×ª ×ª×•×¨×'); }
      function handleEditDonor(e) { e.preventDefault(); console.log('×¢×¨×™×›×ª ×ª×•×¨×'); }
      function handleAddUser(e) { e.preventDefault(); console.log('×”×•×¡×¤×ª ××©×ª××©'); }
      function handleEditUser(e) { e.preventDefault(); console.log('×¢×¨×™×›×ª ××©×ª××©'); }
      function handleCreateMessage(e) { e.preventDefault(); console.log('×™×¦×™×¨×ª ×”×•×“×¢×”'); }
      function handleBulkEdit(e) { e.preventDefault(); console.log('×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª'); }

      console.log('âœ… ×¤×× ×œ ××“××™×Ÿ ×”×•×›×Ÿ ×‘××œ×•××•!');


// === ×¤×•× ×§×¦×™×•×ª × ×™×”×•×œ ×ª×•×¨××™× ===

     // ×˜×¢×™× ×ª ×¡×•×’×™ ×ª×¨×•××•×ª (××“××™×Ÿ)
     async function loadDonationTypesAdmin() {
         try {
             showLoading('donationTypesTableBody');
             
             const response = await fetch('/api/admin/donation-types', {
                 headers: { 'Authorization': `Bearer ${authToken}` }
             });
             
             if (response.ok) {
                 const donationTypes = await response.json();
                 allDonationTypes = donationTypes;
                 displayDonationTypesAdmin(donationTypes);
             } else {
                 throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×•×’×™ ×ª×¨×•××•×ª');
             }
         } catch (error) {
             console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×¨×•××•×ª:', error);
             document.getElementById('donationTypesTableBody').innerHTML = 
                 '<tr><td colspan="8" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
         }
     }

     // ×”×¦×’×ª ×¡×•×’×™ ×ª×¨×•××•×ª ×‘×˜×‘×œ×”
     function displayDonationTypesAdmin(donationTypes) {
         const tbody = document.getElementById('donationTypesTableBody');
         
         if (donationTypes.length === 0) {
             tbody.innerHTML = `
                 <tr>
                     <td colspan="8" class="text-center">
                         <div class="empty-state">
                             <div class="empty-state-icon">ğŸ’³</div>
                             <h3>××™×Ÿ ×¡×•×’×™ ×ª×¨×•××•×ª ×‘××¢×¨×›×ª</h3>
                             <p>×¦×•×¨ ×¡×•×’ ×ª×¨×•××” ×¨××©×•×Ÿ</p>
                         </div>
                     </td>
                 </tr>
             `;
             return;
         }
         
         tbody.innerHTML = donationTypes.map(donation => `
             <tr>
                 <td><strong>${donation.name}</strong></td>
                 <td>
                     <a href="${donation.url}" target="_blank" title="×¤×ª×— ×§×™×©×•×¨">
                         ğŸ”— ${donation.url.length > 30 ? donation.url.substring(0, 30) + '...' : donation.url}
                     </a>
                 </td>
                 <td>${donation.start_date ? new Date(donation.start_date).toLocaleDateString('he-IL') : '×œ×œ× ×”×’×‘×œ×”'}</td>
                 <td>${donation.end_date ? new Date(donation.end_date).toLocaleDateString('he-IL') : '×œ×œ× ×”×’×‘×œ×”'}</td>
                 <td>
                     <span class="badge ${donation.is_active ? 'badge-success' : 'badge-secondary'}">
                         ${donation.is_active ? 'âœ… ×¤×¢×™×œ' : 'âŒ ×œ× ×¤×¢×™×œ'}
                     </span>
                     ${donation.no_expiry ? '<span class="badge badge-info">â™¾ï¸ ×œ×œ× ×¤×§×™×¢×”</span>' : ''}
                 </td>
                 <td>${donation.created_by_name || donation.created_by_username || '×œ× ×™×“×•×¢'}</td>
                 <td>${new Date(donation.created_at).toLocaleDateString('he-IL')}</td>
                 <td>
                     <button class="btn btn-info btn-sm" onclick="editDonationType(${donation.id})" title="×¢×¨×™×›×”">
                         âœï¸
                     </button>
                     <button class="btn btn-warning btn-sm" onclick="testDonationPage('${donation.url}')" title="×‘×“×•×§ ×“×£">
                         ğŸ”
                     </button>
                     <button class="btn btn-danger btn-sm" onclick="confirmDeleteDonationType(${donation.id})" title="××—×™×§×”">
                         ğŸ—‘ï¸
                     </button>
                 </td>
             </tr>
         `).join('');
     }

     // ×”×¦×’×ª ××•×“×œ ×”×•×¡×¤×”
     function showAddDonationTypeModal() {
         openModal('addDonationTypeModal');
         document.getElementById('donationTypeName').focus();
     }

     // ×¢×¨×™×›×ª ×¡×•×’ ×ª×¨×•××”
     function editDonationType(id) {
         // ××¦× ××ª ×¡×•×’ ×”×ª×¨×•××”
         const donationType = allDonationTypes?.find(d => d.id === id);
         if (!donationType) {
             showNotification('×¡×•×’ ×ª×¨×•××” ×œ× × ××¦×', 'error');
             return;
         }
         
         // ××™×œ×•×™ ×”×˜×•×¤×¡
         document.getElementById('editDonationTypeId').value = donationType.id;
         document.getElementById('editDonationTypeName').value = donationType.name || '';
         document.getElementById('editDonationTypeUrl').value = donationType.url || '';
         document.getElementById('editDonationTypeDescription').value = donationType.description || '';
         document.getElementById('editDonationTypeStartDate').value = donationType.start_date || '';
         document.getElementById('editDonationTypeEndDate').value = donationType.end_date || '';
         document.getElementById('editDonationTypeNoExpiry').checked = donationType.no_expiry || false;
         document.getElementById('editDonationTypeIsActive').checked = donationType.is_active || false;
         
         openModal('editDonationTypeModal');
     }

     // ×‘×“×™×§×ª ×“×£ ×ª×¨×•××”
     function testDonationPage(url) {
         window.open(url, '_blank', 'width=800,height=600');
         showNotification('×“×£ ×”×ª×¨×•××” × ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©', 'info');
     }

     // ××—×™×§×ª ×¡×•×’ ×ª×¨×•××”
     function confirmDeleteDonationType(id) {
         if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×¡×•×’ ×”×ª×¨×•××”? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!')) {
             deleteDonationTypeById(id);
         }
     }

     async function deleteDonationTypeById(id) {
         try {
             const response = await fetch(`/api/admin/donation-types/${id}`, {
                 method: 'DELETE',
                 headers: { 'Authorization': `Bearer ${authToken}` }
             });
             
             const data = await response.json();
             
             if (response.ok) {
                 showNotification(data.message || '×¡×•×’ ×ª×¨×•××” × ××—×§ ×‘×”×¦×œ×—×”', 'success');
                 loadDonationTypesAdmin();
             } else {
                 showNotification(data.error || '×©×’×™××” ×‘××—×™×§×ª ×¡×•×’ ×ª×¨×•××”', 'error');
             }
         } catch (error) {
             showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
         }
     }

     // ×¡×˜×˜×™×¡×˜×™×§×•×ª
     function showDonationStats() {
         openModal('donationStatsModal');
         loadDonationStats();
     }

     async function loadDonationStats() {
         try {
             const fromDate = document.getElementById('statsFromDate').value;
             const toDate = document.getElementById('statsToDate').value;
             
             const params = new URLSearchParams();
             if (fromDate) params.append('from_date', fromDate);
             if (toDate) params.append('to_date', toDate);
             
             const response = await fetch(`/api/admin/donation-types/stats?${params.toString()}`, {
                 headers: { 'Authorization': `Bearer ${authToken}` }
             });
             
             if (response.ok) {
                 const stats = await response.json();
                 displayDonationStats(stats);
             } else {
                 throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª');
             }
         } catch (error) {
             console.error('âŒ ×©×’×™××” ×‘×¡×˜×˜×™×¡×˜×™×§×•×ª:', error);
             document.getElementById('donationStatsBody').innerHTML = 
                 '<tr><td colspan="5" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
         }
     }

     function displayDonationStats(stats) {
         const tbody = document.getElementById('donationStatsBody');
         
         if (stats.length === 0) {
             tbody.innerHTML = `
                 <tr>
                     <td colspan="5" class="text-center">
                         <div class="empty-state">
                             <div class="empty-state-icon">ğŸ“Š</div>
                             <h3>××™×Ÿ × ×ª×•× ×™ ×©×™××•×©</h3>
                         </div>
                     </td>
                 </tr>
             `;
             return;
         }
         
         tbody.innerHTML = stats.map(stat => `
             <tr>
                 <td><strong>${stat.donation_name}</strong></td>
                 <td><span class="badge badge-info">${stat.access_count || 0}</span></td>
                 <td><span class="badge badge-success">${stat.unique_users || 0}</span></td>
                 <td>${stat.last_access ? new Date(stat.last_access).toLocaleDateString('he-IL') : '××£ ×¤×¢×'}</td>
                 <td>${stat.most_active_user || '×œ×œ× × ×ª×•× ×™×'}</td>
             </tr>
         `).join('');
     }

     // ×œ×•×’×™ ×’×™×©×”
     function showDonationLogs() {
         openModal('donationLogsModal');
         loadDonationLogs();
     }

     async function loadDonationLogs() {
         try {
             const response = await fetch('/api/admin/donation-access-logs?limit=100', {
                 headers: { 'Authorization': `Bearer ${authToken}` }
             });
             
             if (response.ok) {
                 const logs = await response.json();
                 displayDonationLogs(logs);
             } else {
                 throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×’×™×');
             }
         } catch (error) {
             console.error('âŒ ×©×’×™××” ×‘×œ×•×’×™×:', error);
             document.getElementById('donationLogsBody').innerHTML = 
                 '<tr><td colspan="5" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
         }
     }

     function displayDonationLogs(logs) {
         const tbody = document.getElementById('donationLogsBody');
         
         if (logs.length === 0) {
             tbody.innerHTML = `
                 <tr>
                     <td colspan="5" class="text-center">
                         <div class="empty-state">
                             <div class="empty-state-icon">ğŸ“‹</div>
                             <h3>××™×Ÿ ×œ×•×’×™ ×’×™×©×”</h3>
                         </div>
                     </td>
                 </tr>
             `;
             return;
         }
         
         tbody.innerHTML = logs.map(log => `
             <tr>
                 <td>${new Date(log.created_at).toLocaleString('he-IL')}</td>
                 <td>${log.user_name || log.username || '×œ× ×™×“×•×¢'}</td>
                 <td>${log.donation_name || '×œ× ×™×“×•×¢'}</td>
                 <td>
                     <span class="badge ${log.action === 'VIEW' ? 'badge-info' : 'badge-success'}">
                         ${log.action === 'VIEW' ? 'ğŸ‘ï¸ ×¦×¤×™×™×”' : log.action === 'LOADED' ? 'âœ… × ×˜×¢×Ÿ' : log.action}
                     </span>
                 </td>
                 <td>${log.ip_address || ''}</td>
             </tr>
         `).join('');
     }

// ×”×•×¡×¤×ª ×ª×•×¨× ×—×“×©
async function handleAddDonor(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('donorName').value.trim(),
        phone: document.getElementById('donorPhone').value.trim(),
        email: document.getElementById('donorEmail').value.trim(),
        address: document.getElementById('donorAddress').value.trim(),
        city: document.getElementById('donorCity').value.trim(),
        donation_amount: parseFloat(document.getElementById('donorAmount').value) || null,
        donor_type: document.getElementById('donorType').value,
        notes: document.getElementById('donorNotes').value.trim()
    };
    
    if (!formData.name || !formData.phone) {
        showNotification('×©× ×•×˜×œ×¤×•×Ÿ × ×“×¨×©×™×', 'error');
        return;
    }
    
    try {
        const response = await fetch('/api/admin/donors', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×ª×•×¨× × ×•×¡×£ ×‘×”×¦×œ×—×”! ğŸ‘¤', 'success');
            closeModal('addDonorModal');
            document.getElementById('addDonorForm').reset();
            loadDonors(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×”×•×¡×¤×ª ×ª×•×¨×', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×¢×¨×™×›×ª ×ª×•×¨×
function editDonor(id) {
    const donor = allDonors.find(d => d.id === id);
    if (!donor) {
        showNotification('×ª×•×¨× ×œ× × ××¦×', 'error');
        return;
    }
    
    // ××™×œ×•×™ ×”×˜×•×¤×¡
    document.getElementById('editDonorId').value = donor.id;
    document.getElementById('editDonorName').value = donor.name || '';
    document.getElementById('editDonorPhone').value = donor.phone || '';
    document.getElementById('editDonorEmail').value = donor.email || '';
    document.getElementById('editDonorCity').value = donor.city || '';
    document.getElementById('editDonorAddress').value = donor.address || '';
    document.getElementById('editDonorAmount').value = donor.donation_amount || '';
    document.getElementById('editDonorType').value = donor.donor_type || '×¨×’×™×œ';
    document.getElementById('editDonorStatus').value = donor.status || 'active';
    document.getElementById('editDonorNotes').value = donor.notes || '';
    document.getElementById('editDonorCreated').value = new Date(donor.created_at).toLocaleDateString('he-IL');
    
    openModal('editDonorModal');
}

// ×©××™×¨×ª ×¢×¨×™×›×ª ×ª×•×¨×
async function handleEditDonor(e) {
    e.preventDefault();
    
    const id = document.getElementById('editDonorId').value;
    const formData = {
        name: document.getElementById('editDonorName').value.trim(),
        phone: document.getElementById('editDonorPhone').value.trim(),
        email: document.getElementById('editDonorEmail').value.trim(),
        address: document.getElementById('editDonorAddress').value.trim(),
        city: document.getElementById('editDonorCity').value.trim(),
        donation_amount: parseFloat(document.getElementById('editDonorAmount').value) || null,
        donor_type: document.getElementById('editDonorType').value,
        status: document.getElementById('editDonorStatus').value,
        notes: document.getElementById('editDonorNotes').value.trim()
    };
    
    try {
        const response = await fetch(`/api/admin/donors/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×ª×•×¨× ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”! âœï¸', 'success');
            closeModal('editDonorModal');
            loadDonors();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×ª×•×¨×', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ××—×™×§×ª ×ª×•×¨×
async function deleteDonor() {
    const id = document.getElementById('editDonorId').value;
    
    if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×ª×•×¨×? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/admin/donors/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×ª×•×¨× × ××—×§ ×‘×”×¦×œ×—×”', 'success');
            closeModal('editDonorModal');
            loadDonors();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘××—×™×§×ª ×ª×•×¨×', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ××™×©×•×¨ ××—×™×§×ª ×ª×•×¨×
function confirmDeleteDonor(id) {
    if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×ª×•×¨×? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!')) {
        deleteDonorById(id);
    }
}

async function deleteDonorById(id) {
    try {
        const response = await fetch(`/api/admin/donors/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×ª×•×¨× × ××—×§ ×‘×”×¦×œ×—×”', 'success');
            loadDonors();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘××—×™×§×ª ×ª×•×¨×', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª
async function handleBulkEdit(e) {
    e.preventDefault();
    
    if (selectedDonors.size === 0) {
        showNotification('×× × ×‘×—×¨ ×ª×•×¨××™× ×œ×¢×¨×™×›×”', 'warning');
        return;
    }
    
    const updates = {};
    
    if (document.getElementById('bulkEditCity').checked) {
        updates.city = document.getElementById('bulkCityValue').value.trim();
    }
    if (document.getElementById('bulkEditType').checked) {
        updates.donor_type = document.getElementById('bulkTypeValue').value;
    }
    if (document.getElementById('bulkEditStatus').checked) {
        updates.status = document.getElementById('bulkStatusValue').value;
    }
    
    if (Object.keys(updates).length === 0) {
        showNotification('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×©×“×” ××—×“ ×œ×¢×“×›×•×Ÿ', 'warning');
        return;
    }
    
    try {
        const response = await fetch('/api/admin/donors/bulk-edit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
                donor_ids: Array.from(selectedDonors),
                updates: updates
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification(`${data.updated} ×ª×•×¨××™× ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”! ğŸ“`, 'success');
            closeModal('bulkEditModal');
            clearSelection();
            loadDonors();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×¢×¨×™×›×” ×§×‘×•×¦×ª×™×ª', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ××—×™×§×” ×§×‘×•×¦×ª×™×ª
async function bulkDelete() {
    if (selectedDonors.size === 0) {
        showNotification('×× × ×‘×—×¨ ×ª×•×¨××™× ×œ××—×™×§×”', 'warning');
        return;
    }
    
    if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ${selectedDonors.size} ×ª×•×¨××™×? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!`)) {
        return;
    }
    
    try {
        const response = await fetch('/api/admin/donors/bulk-delete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
                donor_ids: Array.from(selectedDonors)
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification(`${data.deleted} ×ª×•×¨××™× × ××—×§×• ×‘×”×¦×œ×—×”`, 'success');
            clearSelection();
            loadDonors();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘××—×™×§×” ×§×‘×•×¦×ª×™×ª', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×™×™×¦×•× ×ª×•×¨××™×
async function exportDonors() {
    try {
        const response = await fetch('/api/admin/export/donors', {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'donors_export.csv';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            showNotification('×ª×•×¨××™× ×™×•×¦××• ×‘×”×¦×œ×—×”! ğŸ“Š', 'success');
        } else {
            showNotification('×©×’×™××” ×‘×™×™×¦×•× ×ª×•×¨××™×', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// === ×¤×•× ×§×¦×™×•×ª × ×™×”×•×œ ××©×ª××©×™× ===

// ×”×•×¡×¤×ª ××©×ª××© ×—×“×©
async function handleAddUser(e) {
    e.preventDefault();
    
    const username = document.getElementById('newUsername').value.trim();
    const password = document.getElementById('newUserPassword').value;
    const confirmPassword = document.getElementById('confirmUserPassword').value;
    const fullName = document.getElementById('newUserFullName').value.trim();
    
    // ×‘×“×™×§×•×ª ×•×•×œ×™×“×¦×™×”
    if (!username || !password || !fullName) {
        showNotification('×©× ××©×ª××©, ×¡×™×¡××” ×•×©× ××œ× × ×“×¨×©×™×', 'error');
        return;
    }
    
    if (password !== confirmPassword) {
        showNotification('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª', 'error');
        return;
    }
    
    if (password.length < 6) {
        showNotification('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×', 'error');
        return;
    }
    
    // ×‘×“×™×§×ª ×–××™× ×•×ª ×©× ×”××©×ª××©
    try {
        const checkResponse = await fetch(`/api/admin/check-username/${encodeURIComponent(username)}`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (checkResponse.ok) {
            const checkData = await checkResponse.json();
            if (!checkData.available) {
                showNotification('×©× ×”××©×ª××© ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª. ×× × ×‘×—×¨ ×©× ××©×ª××© ××—×¨.', 'error');
                document.getElementById('newUsername').focus();
                return;
            }
        }
    } catch (error) {
        console.error('×©×’×™××” ×‘×‘×“×™×§×ª ×©× ××©×ª××©:', error);
    }
    
    const formData = {
        username: username,
        password: password,
        full_name: fullName,
        email: document.getElementById('newUserEmail').value.trim(),
        phone: document.getElementById('newUserPhone').value.trim(),
        department: document.getElementById('newUserDepartment').value.trim(),
        role: document.getElementById('newUserRole').value,
        notes: document.getElementById('newUserNotes').value.trim()
    };
    
    try {
        const response = await fetch('/api/admin/users', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('××©×ª××© × ×•×¦×¨ ×‘×”×¦×œ×—×”! ğŸ‘¤', 'success');
            closeModal('addUserModal');
            document.getElementById('addUserForm').reset();
            loadUsers();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×™×¦×™×¨×ª ××©×ª××©', 'error');
            
            // ×× ×”×©×’×™××” ×”×™× ×©× ××©×ª××© ×§×™×™×, ×¤×•×§×•×¡ ×¢×œ ×”×©×“×”
            if (data.error && data.error.includes('×›×‘×¨ ×§×™×™×')) {
                document.getElementById('newUsername').focus();
                document.getElementById('newUsername').select();
            }
        }
    } catch (error) {
        console.error('×©×’×™××” ×‘×™×¦×™×¨×ª ××©×ª××©:', error);
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×”×•×¡×¤×ª ×‘×“×™×§×” ×“×™× ××™×ª ×œ×©× ××©×ª××© ×‘×–××Ÿ ×”×§×œ×“×”
document.addEventListener('DOMContentLoaded', function() {
    const usernameInput = document.getElementById('newUsername');
    if (usernameInput) {
        let checkTimeout;
        
        usernameInput.addEventListener('input', function() {
            clearTimeout(checkTimeout);
            const username = this.value.trim();
            
            if (username.length >= 3) {
                // ×”×•×¡×¤×ª ××™× ×“×™×§×˜×•×¨ ×‘×“×™×§×”
                this.style.borderColor = '#ffc107';
                
                checkTimeout = setTimeout(async () => {
                    try {
                        const response = await fetch(`/api/admin/check-username/${encodeURIComponent(username)}`, {
                            headers: { 'Authorization': `Bearer ${authToken}` }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.available) {
                                usernameInput.style.borderColor = '#28a745';
                                usernameInput.title = '×©× ×”××©×ª××© ×–××™×Ÿ âœ“';
                            } else {
                                usernameInput.style.borderColor = '#dc3545';
                                usernameInput.title = '×©× ×”××©×ª××© ×›×‘×¨ ×§×™×™× âœ—';
                            }
                        }
                    } catch (error) {
                        console.error('×©×’×™××” ×‘×‘×“×™×§×ª ×©× ××©×ª××©:', error);
                        usernameInput.style.borderColor = '';
                        usernameInput.title = '';
                    }
                }, 500);
            } else {
                this.style.borderColor = '';
                this.title = '';
            }
        });
    }
});

// ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×¨×©×™××ª ××©×ª××©×™× ×§×™×™××™× (×œ×¢×–×¨×” ×‘×‘×—×™×¨×ª ×©×)
function showExistingUsernames() {
    if (allUsers && allUsers.length > 0) {
        const existingUsernames = allUsers.map(user => user.username).join(', ');
        showNotification(`×©××•×ª ××©×ª××© ×§×™×™××™×: ${existingUsernames}`, 'info', 8000);
    }
}

// ×¤×•× ×§×¦×™×” ×œ×’× ×¨×¦×™×” ××•×˜×•××˜×™×ª ×©×œ ×©× ××©×ª××©
function generateUsername() {
    const fullName = document.getElementById('newUserFullName').value.trim();
    const usernameInput = document.getElementById('newUsername');
    
    if (fullName) {
        // ×™×¦×™×¨×ª ×©× ××©×ª××© ××”×©× ×”××œ×
        const names = fullName.split(' ');
        let suggestion = '';
        
        if (names.length >= 2) {
            // ×©× ×¤×¨×˜×™ + ××•×ª ×¨××©×•× ×” ×©×œ ×©× ××©×¤×—×”
            suggestion = names[0] + names[1].charAt(0);
        } else {
            suggestion = names[0];
        }
        
        // ×”×¡×¨×ª ×ª×•×•×™× ××™×•×—×“×™× ×•×”××¨×” ×œ×× ×’×œ×™×ª (×‘×¡×™×¡×™×ª)
        suggestion = suggestion.replace(/[^a-zA-Z0-9×-×ª]/g, '');
        
        // ×× ×™×© ×¢×‘×¨×™×ª, ×”××¨×” ×‘×¡×™×¡×™×ª ×œ×× ×’×œ×™×ª
        const hebrewToEnglish = {
            '×': 'a', '×‘': 'b', '×’': 'g', '×“': 'd', '×”': 'h', '×•': 'v', '×–': 'z', '×—': 'h',
            '×˜': 't', '×™': 'y', '×›': 'k', '×š': 'k', '×œ': 'l', '×': 'm', '×': 'm', '×Ÿ': 'n',
            '× ': 'n', '×¡': 's', '×¢': 'a', '×¤': 'p', '×£': 'p', '×¦': 'z', '×¥': 'z', '×§': 'k',
            '×¨': 'r', '×©': 's', '×ª': 't'
        };
        
        suggestion = suggestion.split('').map(char => hebrewToEnglish[char] || char).join('');
        suggestion = suggestion.toLowerCase();
        
        usernameInput.value = suggestion;
        
        // ×”×¤×¢×œ×ª ×‘×“×™×§×ª ×–××™× ×•×ª
        usernameInput.dispatchEvent(new Event('input'));
    }
}

// ×¢×¨×™×›×ª ××©×ª××©
function editUser(id) {
    const user = allUsers.find(u => u.id === id);
    if (!user) {
        showNotification('××©×ª××© ×œ× × ××¦×', 'error');
        return;
    }
    
    // ××™×œ×•×™ ×”×˜×•×¤×¡
    document.getElementById('editUserId').value = user.id;
    document.getElementById('editUsername').value = user.username || '';
    document.getElementById('editUserFullName').value = user.full_name || '';
    document.getElementById('editUserEmail').value = user.email || '';
    document.getElementById('editUserPhone').value = user.phone || '';
    document.getElementById('editUserDepartment').value = user.department || '';
    document.getElementById('editUserRole').value = user.role || 'operator';
    document.getElementById('editUserStatus').value = user.is_active ? '1' : '0';
    document.getElementById('editUserLastLogin').value = user.last_login ? 
        new Date(user.last_login).toLocaleString('he-IL') : '××£ ×¤×¢×';
    document.getElementById('editUserNotes').value = user.notes || '';
    
    openModal('editUserModal');
}

// ×©××™×¨×ª ×¢×¨×™×›×ª ××©×ª××©
async function handleEditUser(e) {
    e.preventDefault();
    
    const id = document.getElementById('editUserId').value;
    const formData = {
        full_name: document.getElementById('editUserFullName').value.trim(),
        email: document.getElementById('editUserEmail').value.trim(),
        phone: document.getElementById('editUserPhone').value.trim(),
        department: document.getElementById('editUserDepartment').value.trim(),
        role: document.getElementById('editUserRole').value,
        is_active: document.getElementById('editUserStatus').value === '1',
        notes: document.getElementById('editUserNotes').value.trim()
    };
    
    const password = document.getElementById('editUserPassword').value.trim();
    if (password) {
        formData.password = password;
    }
    
    try {
        const response = await fetch(`/api/admin/users/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('××©×ª××© ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”! âœï¸', 'success');
            closeModal('editUserModal');
            loadUsers();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ××©×ª××©', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ××™×¤×•×¡ ×¡×™×¡××”
async function resetUserPassword(userId) {
    const newPassword = prompt('×”×›× ×¡ ×¡×™×¡××” ×—×“×©×” (××™× ×™××•× 6 ×ª×•×•×™×):');
    
    if (!newPassword || newPassword.length < 6) {
        showNotification('×¡×™×¡××” ×—×“×©×” × ×“×¨×©×ª (××™× ×™××•× 6 ×ª×•×•×™×)', 'warning');
        return;
    }
    
    try {
        const response = await fetch(`/api/admin/users/${userId}/reset-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ new_password: newPassword })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×¡×™×¡××” ××•×¤×¡×” ×‘×”×¦×œ×—×”! ğŸ”’', 'success');
        } else {
            showNotification(data.error || '×©×’×™××” ×‘××™×¤×•×¡ ×¡×™×¡××”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ××—×™×§×ª ××©×ª××©
function confirmDeleteUser(id) {
    if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××©×ª××©? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!')) {
        deleteUser(id);
    }
}

async function deleteUser(id) {
   try {
       const response = await fetch(`/api/admin/users/${id}`, {
           method: 'DELETE',
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       const data = await response.json();
       
       if (response.ok) {
           showNotification('××©×ª××© × ××—×§ ×‘×”×¦×œ×—×”', 'success');
           loadUsers();
       } else {
           showNotification(data.error || '×©×’×™××” ×‘××—×™×§×ª ××©×ª××©', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// ×¦×¤×™×™×” ×‘×œ×•×’×™ ××©×ª××©
async function viewUserLogs(userId) {
   try {
       const response = await fetch(`/api/admin/logs/user/${userId}`, {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const logs = await response.json();
           displayUserLogsModal(logs);
       } else {
           showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×’×™ ××©×ª××©', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

function displayUserLogsModal(logs) {
   const modal = document.createElement('div');
   modal.className = 'modal show';
   modal.innerHTML = `
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ“‹ ×œ×•×’×™ ××©×ª××©</h3>
               <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
           </div>
           <div style="max-height: 400px; overflow-y: auto;">
               ${logs.length === 0 ? 
                   '<div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div><h3>××™×Ÿ ×¤×¢×™×œ×•×ª</h3></div>' :
                   `<table class="table">
                       <thead>
                           <tr>
                               <th>×–××Ÿ</th>
                               <th>×¤×¢×•×œ×”</th>
                               <th>×¤×¨×˜×™×</th>
                               <th>IP</th>
                           </tr>
                       </thead>
                       <tbody>
                           ${logs.map(log => `
                               <tr>
                                   <td>${new Date(log.created_at).toLocaleString('he-IL')}</td>
                                   <td>${getActivityText(log.action)}</td>
                                   <td>${log.details || ''}</td>
                                   <td>${log.ip_address || ''}</td>
                               </tr>
                           `).join('')}
                       </tbody>
                   </table>`
               }
           </div>
       </div>
   `;
   document.body.appendChild(modal);
}

// === ×¤×•× ×§×¦×™×•×ª ×”×•×“×¢×•×ª ××¢×¨×›×ª ===

// ×˜×¢×™× ×ª ×”×•×“×¢×•×ª
async function loadMessages() {
   try {
       showLoading('messagesTableBody');
       
       const response = await fetch('/api/admin/messages', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const messages = await response.json();
           displayMessages(messages);
       } else {
           throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×•×“×¢×•×ª');
       }
   } catch (error) {
       console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×•×“×¢×•×ª:', error);
       document.getElementById('messagesTableBody').innerHTML = 
           '<tr><td colspan="9" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
   }
}

function displayMessages(messages) {
   const tbody = document.getElementById('messagesTableBody');
   
   if (messages.length === 0) {
       tbody.innerHTML = `
           <tr>
               <td colspan="9" class="text-center">
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ’¬</div>
                       <h3>××™×Ÿ ×”×•×“×¢×•×ª ×‘××¢×¨×›×ª</h3>
                       <p>×¦×•×¨ ×”×•×“×¢×” ×¨××©×•× ×”</p>
                   </div>
               </td>
           </tr>
       `;
       return;
   }
   
   tbody.innerHTML = messages.map(msg => `
       <tr>
           <td><strong>${msg.title}</strong></td>
           <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
               ${msg.content}
           </td>
           <td>
               <span class="badge ${getMessageTypeBadge(msg.type)}">
                   ${getMessageTypeText(msg.type)}
               </span>
           </td>
           <td>${getTargetText(msg.target_role, msg.target_user_id)}</td>
           <td>
               <span class="badge ${getPriorityBadge(msg.priority)}">
                   ${getPriorityText(msg.priority)}
               </span>
           </td>
           <td>${new Date(msg.created_at).toLocaleDateString('he-IL')}</td>
           <td>${msg.expires_at ? new Date(msg.expires_at).toLocaleDateString('he-IL') : '×œ×œ× ×ª×¤×•×’×”'}</td>
           <td>
               <span class="badge ${msg.is_active ? 'badge-success' : 'badge-secondary'}">
                   ${msg.is_active ? '×¤×¢×™×œ' : '×œ× ×¤×¢×™×œ'}
               </span>
           </td>
           <td>
               <button class="btn btn-info btn-sm" onclick="editMessage(${msg.id})" title="×¢×¨×™×›×”">
                   âœï¸
               </button>
               <button class="btn btn-danger btn-sm" onclick="deleteMessage(${msg.id})" title="××—×™×§×”">
                   ğŸ—‘ï¸
               </button>
           </td>
       </tr>
   `).join('');
}

function getMessageTypeBadge(type) {
   const badgeMap = {
       'info': 'badge-info',
       'success': 'badge-success',
       'warning': 'badge-warning',
       'error': 'badge-danger'
   };
   return badgeMap[type] || 'badge-info';
}

function getMessageTypeText(type) {
   const textMap = {
       'info': '××™×“×¢',
       'success': '×”×¦×œ×—×”',
       'warning': '××–×”×¨×”',
       'error': '×©×’×™××”'
   };
   return textMap[type] || type;
}

function getPriorityBadge(priority) {
   const badgeMap = {
       1: 'badge-secondary',
       2: 'badge-warning',
       3: 'badge-danger'
   };
   return badgeMap[priority] || 'badge-secondary';
}

function getPriorityText(priority) {
   const textMap = {
       1: '×¨×’×™×œ×”',
       2: '×—×©×•×‘×”',
       3: '×§×¨×™×˜×™×ª'
   };
   return textMap[priority] || '×¨×’×™×œ×”';
}

function getTargetText(target_role, target_user_id) {
   if (target_user_id) return '××©×ª××© ×¡×¤×¦×™×¤×™';
   if (target_role === 'admin') return '××“××™× ×™×';
   if (target_role === 'operator') return '×˜×œ×¤× ×™×';
   return '×›×œ ×”××©×ª××©×™×';
}

// ×™×¦×™×¨×ª ×”×•×“×¢×” ×—×“×©×”
async function handleCreateMessage(e) {
   e.preventDefault();
   
   const formData = {
       title: document.getElementById('messageTitle').value.trim(),
       content: document.getElementById('messageContent').value.trim(),
       type: document.getElementById('messageType').value,
       priority: parseInt(document.getElementById('messagePriority').value),
       target_role: document.getElementById('messageTarget').value === 'all' ? null : 
                   document.getElementById('messageTarget').value === 'specific' ? null :
                   document.getElementById('messageTarget').value,
       target_user_id: document.getElementById('messageTarget').value === 'specific' ? 
                       parseInt(document.getElementById('targetUserId').value) || null : null,
       expires_at: document.getElementById('messageExpires').value || null
   };
   
   try {
       const response = await fetch('/api/admin/messages', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json',
               'Authorization': `Bearer ${authToken}`
           },
           body: JSON.stringify(formData)
       });
       
       const data = await response.json();
       
       if (response.ok) {
           showNotification('×”×•×“×¢×” × ×•×¦×¨×” ×‘×”×¦×œ×—×”! ğŸ’¬', 'success');
           closeModal('createMessageModal');
           document.getElementById('createMessageForm').reset();
           loadMessages();
       } else {
           showNotification(data.error || '×©×’×™××” ×‘×™×¦×™×¨×ª ×”×•×“×¢×”', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// ×”×¦×’×”/×”×¡×ª×¨×” ×©×œ ×‘×—×™×¨×ª ××©×ª××© ×¡×¤×¦×™×¤×™
function toggleTargetUser() {
   const target = document.getElementById('messageTarget').value;
   const userGroup = document.getElementById('specificUserGroup');
   
   if (target === 'specific') {
       userGroup.style.display = 'block';
   } else {
       userGroup.style.display = 'none';
   }
}

// ×¢×¨×™×›×ª ×”×•×“×¢×”
function editMessage(id) {
   // ×œ×¦×•×¨×š ×”×“×•×’××” - ×ª×•×›×œ ×œ×”×•×¡×™×£ ××•×“×œ ×¢×¨×™×›×”
   showNotification('×¤×•× ×§×¦×™×™×ª ×¢×¨×™×›×” ×ª×ª×•×•×¡×£ ×‘×§×¨×•×‘', 'info');
}

// ××—×™×§×ª ×”×•×“×¢×”
async function deleteMessage(id) {
   if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×”×•×“×¢×”?')) {
       return;
   }
   
   try {
       const response = await fetch(`/api/admin/messages/${id}`, {
           method: 'DELETE',
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       const data = await response.json();
       
       if (response.ok) {
           showNotification('×”×•×“×¢×” × ××—×§×” ×‘×”×¦×œ×—×”', 'success');
           loadMessages();
       } else {
           showNotification(data.error || '×©×’×™××” ×‘××—×™×§×ª ×”×•×“×¢×”', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// === ×¤×•× ×§×¦×™×•×ª ×›×¨×˜×™×¡×™ ×ª××™×›×” ===

// ×”×•×¡×£ ××ª ×”×¤×•× ×§×¦×™×•×ª ×”×œ×œ×• ×‘-admin.html ×œ×¤× ×™ ×”×¤×•× ×§×¦×™×” loadTickets

function getCategoryText(category) {
    const categoryMap = {
        'technical': '×‘×¢×™×” ×˜×›× ×™×ª',
        'data': '×‘×¢×™×” ×‘× ×ª×•× ×™×', 
        'access': '×‘×¢×™×™×ª ×’×™×©×”',
        'training': '×”×“×¨×›×”',
        'general': '×›×œ×œ×™',
        'other': '××—×¨'
    };
    return categoryMap[category] || category;
}

function getStatusText(status) {
    const statusMap = {
        'open': '×¤×ª×•×—',
        'in_progress': '×‘×˜×™×¤×•×œ',
        'resolved': '× ×¤×ª×¨', 
        'closed': '×¡×’×•×¨'
    };
    return statusMap[status] || status;
}

function getStatusColor(status) {
    const colorMap = {
        'open': 'btn-warning',
        'in_progress': 'btn-info',
        'resolved': 'btn-success',
        'closed': 'btn-secondary'
    };
    return colorMap[status] || 'btn-secondary';
}

function getPriorityText(priority) {
    const priorityMap = {
        'low': '× ××•×›×”',
        'medium': '×‘×™× ×•× ×™×ª', 
        'high': '×’×‘×•×”×”',
        'urgent': '×“×—×•×£'
    };
    return priorityMap[priority] || priority;
}

// ×˜×¢×™× ×ª ×›×¨×˜×™×¡×™×
async function loadTickets() {
   try {
       showLoading('ticketsTableBody');
       
       const response = await fetch('/api/admin/tickets', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const tickets = await response.json();
           displayTickets(tickets);
           updateTicketStats(tickets);
       } else {
           throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×¨×˜×™×¡×™×');
       }
   } catch (error) {
       console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×¨×˜×™×¡×™×:', error);
       document.getElementById('ticketsTableBody').innerHTML = 
           '<tr><td colspan="10" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
   }
}

function displayTickets(tickets) {
   const tbody = document.getElementById('ticketsTableBody');
   
   if (tickets.length === 0) {
       tbody.innerHTML = `
           <tr>
               <td colspan="10" class="text-center">
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ«</div>
                       <h3>××™×Ÿ ×›×¨×˜×™×¡×™ ×ª××™×›×”</h3>
                       <p>×›×œ ×”×›×¨×˜×™×¡×™× ×™×•×¤×™×¢×• ×›××Ÿ</p>
                   </div>
               </td>
           </tr>
       `;
       return;
   }
   
   tbody.innerHTML = tickets.map(ticket => `
       <tr>
           <td><strong>#${ticket.id}</strong></td>
           <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
               ${ticket.title}
           </td>
           <td>${ticket.creator_name || '×œ× ×™×“×•×¢'}</td>
           <td>
               <span class="badge badge-info">
                   ${getCategoryText(ticket.category)}
               </span>
           </td>
           <td>
               <span class="badge ${getPriorityBadgeFromText(ticket.priority)}">
                   ${getPriorityTextFromValue(ticket.priority)}
               </span>
           </td>
           <td>
               <span class="badge ${getTicketStatusBadge(ticket.status)}">
                   ${getTicketStatusText(ticket.status)}
               </span>
           </td>
           <td>${ticket.assigned_name || '×œ× ××•×§×¦×”'}</td>
           <td>${new Date(ticket.created_at).toLocaleDateString('he-IL')}</td>
           <td>${new Date(ticket.updated_at).toLocaleDateString('he-IL')}</td>
           <td>
               <button class="btn btn-info btn-sm" onclick="viewTicketDetails(${ticket.id})" title="×¤×¨×˜×™×">
                   ğŸ‘ï¸
               </button>
               <button class="btn btn-warning btn-sm" onclick="assignTicket(${ticket.id})" title="×”×§×¦×”">
                   ğŸ‘¨â€ğŸ’¼
               </button>
               <button class="btn btn-success btn-sm" onclick="updateTicketStatus(${ticket.id})" title="×¢×“×›×Ÿ ×¡×˜×˜×•×¡">
                   ğŸ”„
               </button>
           </td>
       </tr>
   `).join('');
}

function updateTicketStats(tickets) {
   const pending = tickets.filter(t => t.status === 'open').length;
   const inProgress = tickets.filter(t => t.status === 'in_progress').length;
   
   document.getElementById('pendingTickets').textContent = `${pending} ×××ª×™× ×™×`;
   document.getElementById('inProgressTickets').textContent = `${inProgress} ×‘×˜×™×¤×•×œ`;
}

function getTicketStatusBadge(status) {
   const badgeMap = {
       'open': 'badge-warning',
       'in_progress': 'badge-info',
       'resolved': 'badge-success',
       'closed': 'badge-secondary'
   };
   return badgeMap[status] || 'badge-secondary';
}

function getTicketStatusText(status) {
   const textMap = {
       'open': '×¤×ª×•×—',
       'in_progress': '×‘×˜×™×¤×•×œ',
       'resolved': '× ×¤×ª×¨',
       'closed': '×¡×’×•×¨'
   };
   return textMap[status] || status;
}

function getPriorityBadgeFromText(priority) {
   const badgeMap = {
       'urgent': 'badge-danger',
       'high': 'badge-warning',
       'medium': 'badge-info',
       'low': 'badge-secondary'
   };
   return badgeMap[priority] || 'badge-secondary';
}

function getPriorityTextFromValue(priority) {
   const textMap = {
       'urgent': '×“×—×•×£',
       'high': '×’×‘×•×”×”',
       'medium': '×‘×™× ×•× ×™×ª',
       'low': '× ××•×›×”'
   };
   return textMap[priority] || priority;
}

async function viewTicketDetails(ticketId) {
    try {
        const response = await fetch(`/api/admin/tickets/${ticketId}/details`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
            const ticket = await response.json();
            displayTicketDetailsModal(ticket);
        } else {
            showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×˜×™ ×›×¨×˜×™×¡', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

function displayTicketDetailsModal(ticket) {
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>ğŸ« ×›×¨×˜×™×¡ ×ª××™×›×” #${ticket.id}</h3>
                <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
            </div>
            <div>
                <div class="card">
                    <h4>${ticket.title}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                        <div>
                            <strong>ğŸ‘¤ × ×•×¦×¨ ×¢×œ ×™×“×™:</strong> ${ticket.creator_name || '×œ× ×™×“×•×¢'}
                        </div>
                        <div>
                            <strong>ğŸ“‚ ×§×˜×’×•×¨×™×”:</strong> ${getCategoryText(ticket.category)}
                        </div>
                        <div>
                            <strong>âš¡ ×¢×“×™×¤×•×ª:</strong> 
                            <span class="badge ${getPriorityBadgeFromText(ticket.priority)}">
                                ${getPriorityTextFromValue(ticket.priority)}
                            </span>
                        </div>
                        <div>
                            <strong>ğŸ“Š ×¡×˜×˜×•×¡:</strong>
                            <span class="badge ${getTicketStatusBadge(ticket.status)}">
                                ${getTicketStatusText(ticket.status)}
                            </span>
                        </div>
                        <div>
                            <strong>ğŸ‘¨â€ğŸ’¼ ××˜×¤×œ:</strong> ${ticket.assigned_name || '×œ× ××•×§×¦×”'}
                        </div>
                        <div>
                            <strong>ğŸ“… × ×•×¦×¨:</strong> ${new Date(ticket.created_at).toLocaleString('he-IL')}
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <strong>ğŸ“ ×ª×™××•×¨ ×”×‘×¢×™×”:</strong>
                        <div style="background: #e2edfb; padding: 15px; border-radius: 8px; margin-top: 10px;">
                            ${ticket.description}
                        </div>
                    </div>
                    
                    ${ticket.responses && ticket.responses.length > 0 ? `
                        <div style="margin: 20px 0;">
                            <strong>ğŸ’¬ ×ª×’×•×‘×•×ª:</strong>
                            <div style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                                ${ticket.responses.map(response => `
                                    <div style="background: ${response.is_internal ? '#fff3cd' : '#000000'}; 
                                                padding: 10px; margin: 10px 0; border-radius: 8px; 
                                                border-right: 4px solid ${response.is_internal ? '#ffc107' : '#007bff'};">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <strong>${response.user_name}</strong>
                                            <small>${new Date(response.created_at).toLocaleString('he-IL')}</small>
                                        </div>
                                        <div>${response.content}</div>
                                        ${response.is_internal ? '<small style="color: #856404;">ğŸ’¼ ×ª×’×•×‘×” ×¤× ×™××™×ª</small>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 25px; text-align: center;">
                        <button class="btn btn-warning" onclick="showAssignTicketModal(${ticket.id}, '${ticket.assigned_to || ''}')">
                            ğŸ‘¨â€ğŸ’¼ ×”×§×¦×” ××˜×¤×œ
                        </button>
                        <button class="btn btn-info" onclick="showUpdateStatusModal(${ticket.id}, '${ticket.status}')">
                            ğŸ”„ ×¢×“×›×Ÿ ×¡×˜×˜×•×¡
                        </button>
                        <button class="btn btn-success" onclick="showAddResponseModal(${ticket.id})">
                            ğŸ’¬ ×”×•×¡×£ ×ª×’×•×‘×”
                        </button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            âŒ ×¡×’×•×¨
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function assignTicket(ticketId, currentAssigned = '') {
    showAssignTicketModal(ticketId, currentAssigned);
}

function showAssignTicketModal(ticketId, currentAssigned) {
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ‘¨â€ğŸ’¼ ×”×§×¦××ª ××˜×¤×œ ×œ×›×¨×˜×™×¡</h3>
                <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>×‘×—×¨ ××˜×¤×œ:</label>
                    <select id="assignUserSelect" class="form-control">
                        <option value="">×‘×—×¨ ××˜×¤×œ...</option>
                        ${allUsers.filter(u => u.role === 'admin').map(user => `
                            <option value="${user.id}" ${user.id == currentAssigned ? 'selected' : ''}>
                                ${user.full_name || user.username}
                            </option>
                        `).join('')}
                    </select>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="executeAssignTicket(${ticketId}); this.closest('.modal').remove();">
                        âœ… ×”×§×¦×”
                    </button>
                    <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                        âŒ ×‘×˜×œ
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

async function executeAssignTicket(ticketId) {
    const assignedTo = document.getElementById('assignUserSelect').value;
    
    if (!assignedTo) {
        showNotification('×× × ×‘×—×¨ ××˜×¤×œ', 'warning');
        return;
    }
    
    try {
        const response = await fetch(`/api/admin/tickets/${ticketId}/assign`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ assigned_to: parseInt(assignedTo) })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×›×¨×˜×™×¡ ×”×•×§×¦×” ×‘×”×¦×œ×—×”! ğŸ‘¨â€ğŸ’¼', 'success');
            loadTickets();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×”×§×¦××ª ×›×¨×˜×™×¡', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

function updateTicketStatus(ticketId, currentStatus = 'open') {
    showUpdateStatusModal(ticketId, currentStatus);
}

// ×¡×™× ×•×Ÿ ×›×¨×˜×™×¡×™×
function filterTickets() {
   // ×”×¤×•× ×§×¦×™×” ×ª×§×¨× ×©×•×‘ ×œ-loadTickets ×¢× ×¤×¨××˜×¨×™ ×¡×™× ×•×Ÿ
   loadTickets();
}

function showUpdateStatusModal(ticketId, currentStatus) {
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ”„ ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×›×¨×˜×™×¡</h3>
                <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>×‘×—×¨ ×¡×˜×˜×•×¡ ×—×“×©:</label>
                    <select id="statusSelect" class="form-control">
                        <option value="open" ${currentStatus === 'open' ? 'selected' : ''}>ğŸ”´ ×¤×ª×•×—</option>
                        <option value="in_progress" ${currentStatus === 'in_progress' ? 'selected' : ''}>ğŸ”µ ×‘×˜×™×¤×•×œ</option>
                        <option value="resolved" ${currentStatus === 'resolved' ? 'selected' : ''}>ğŸŸ¢ × ×¤×ª×¨</option>
                        <option value="closed" ${currentStatus === 'closed' ? 'selected' : ''}>âš« ×¡×’×•×¨</option>
                    </select>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="executeUpdateStatus(${ticketId}); this.closest('.modal').remove();">
                        âœ… ×¢×“×›×Ÿ
                    </button>
                    <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                        âŒ ×‘×˜×œ
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

async function executeUpdateStatus(ticketId) {
    const newStatus = document.getElementById('statusSelect').value;
    
    try {
        const response = await fetch(`/api/admin/tickets/${ticketId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ status: newStatus })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×¡×˜×˜×•×¡ ×›×¨×˜×™×¡ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”! ğŸ”„', 'success');
            loadTickets();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// ×”×•×¡×¤×ª ×ª×’×•×‘×” ×œ×›×¨×˜×™×¡
function showAddResponseModal(ticketId) {
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ’¬ ×”×•×¡×¤×ª ×ª×’×•×‘×” ×œ×›×¨×˜×™×¡</h3>
                <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>×ª×•×›×Ÿ ×”×ª×’×•×‘×”:</label>
                    <textarea id="responseContent" class="form-control" rows="4" 
                              placeholder="×›×ª×‘ ×ª×’×•×‘×” ××• ×¤×ª×¨×•×Ÿ ×œ×‘×¢×™×”..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isInternal"> 
                        ğŸ’¼ ×ª×’×•×‘×” ×¤× ×™××™×ª (×¨×§ ×œ××“××™× ×™×)
                    </label>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="executeAddResponse(${ticketId}); this.closest('.modal').remove();">
                        ğŸ’¬ ×©×œ×— ×ª×’×•×‘×”
                    </button>
                    <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                        âŒ ×‘×˜×œ
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

async function executeAddResponse(ticketId) {
    const content = document.getElementById('responseContent').value.trim();
    const isInternal = document.getElementById('isInternal').checked;
    
    if (!content) {
        showNotification('×× × ×”×›× ×¡ ×ª×•×›×Ÿ ×œ×ª×’×•×‘×”', 'warning');
        return;
    }
    
    try {
        const response = await fetch(`/api/admin/tickets/${ticketId}/response`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ content, is_internal: isInternal ? 1 : 0 })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('×ª×’×•×‘×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”! ğŸ’¬', 'success');
            loadTickets();
        } else {
            showNotification(data.error || '×©×’×™××” ×‘×”×•×¡×¤×ª ×ª×’×•×‘×”', 'error');
        }
    } catch (error) {
        showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
    }
}

// === ×¤×•× ×§×¦×™×•×ª ×“×•×—×•×ª ===

// ×˜×¢×™× ×ª ×“×•×—×•×ª
async function loadReports() {
   try {
       // ×“×•×— ×—×™×¤×•×©×™×
       const searchResponse = await fetch('/api/admin/reports/searches', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (searchResponse.ok) {
           const searchData = await searchResponse.json();
           displaySearchReport(searchData);
       }
       
       // ×“×¤×•×¡×™ ×¢×‘×•×“×”
       const patternsResponse = await fetch('/api/admin/reports/work-patterns', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (patternsResponse.ok) {
           const patternsData = await patternsResponse.json();
           displayWorkPatterns(patternsData);
       }
       
   } catch (error) {
       console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×“×•×—×•×ª:', error);
   }
}

function displaySearchReport(data) {
   const tbody = document.getElementById('searchReportBody');
   
   if (data.length === 0) {
       tbody.innerHTML = `
           <tr>
               <td colspan="6" class="text-center">
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ“Š</div>
                       <h3>××™×Ÿ × ×ª×•× ×™ ×—×™×¤×•×©×™×</h3>
                   </div>
               </td>
           </tr>
       `;
       return;
   }
   
   tbody.innerHTML = data.map(row => `
       <tr>
           <td>${row.full_name || row.username}</td>
           <td>${row.search_date}</td>
           <td><strong>${row.total_searches}</strong></td>
           <td>${row.unique_searches}</td>
           <td>${Math.round(row.avg_results * 100) / 100}</td>
           <td>8 ×©×¢×•×ª</td>
       </tr>
   `).join('');
}

function displayWorkPatterns(data) {
   // ×”×¦×’×ª ×’×¨×¤×™× - ×ª×•×›×œ ×œ×”×•×¡×™×£ Chart.js ×›××Ÿ
   console.log('Work patterns data:', data);
}

// ×¢×“×›×•×Ÿ ×“×•×—×•×ª ×¢× ×¡×™× ×•× ×™×
function updateReports() {
   const fromDate = document.getElementById('fromDate').value;
   const toDate = document.getElementById('toDate').value;
   const userId = document.getElementById('userReportFilter').value;
   
   // ×˜×¢×™× ×” ××—×“×© ×¢× ×¤×¨××˜×¨×™×
   loadReports();
}

// ×™×™×¦×•× ×“×•×—×•×ª
async function exportReports() {
   try {
       const fromDate = document.getElementById('fromDate').value;
       const toDate = document.getElementById('toDate').value;
       
       let url = '/api/admin/export/reports';
       const params = new URLSearchParams();
       
       if (fromDate) params.append('from_date', fromDate);
       if (toDate) params.append('to_date', toDate);
       
       if (params.toString()) {
           url += '?' + params.toString();
       }
       
       const response = await fetch(url, {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const blob = await response.blob();
           const downloadUrl = window.URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = downloadUrl;
           a.download = 'search_reports_export.csv';
           document.body.appendChild(a);
           a.click();
           window.URL.revokeObjectURL(downloadUrl);
           document.body.removeChild(a);
           showNotification('×“×•×—×•×ª ×™×•×¦××• ×‘×”×¦×œ×—×”! ğŸ“Š', 'success');
       } else {
           showNotification('×©×’×™××” ×‘×™×™×¦×•× ×“×•×—×•×ª', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// ×™×¦×™×¨×ª ×“×•×— ××•×ª××
function generateReport() {
   showNotification('×¤×•× ×§×¦×™×™×ª ×™×¦×™×¨×ª ×“×•×— ××•×ª×× ×ª×ª×•×•×¡×£ ×‘×§×¨×•×‘', 'info');
}

// === ×¤×•× ×§×¦×™×•×ª ×”×¢×œ××ª ×§×‘×¦×™× ===

// ×‘×—×™×¨×ª ×§×•×‘×¥
function handleFileSelect(input) {
   const file = input.files[0];
   if (file) {
       displayFileDetails(file);
   }
}

// drag & drop
function handleDrop(e) {
   e.preventDefault();
   e.currentTarget.classList.remove('dragover');
   
   const files = e.dataTransfer.files;
   if (files.length > 0) {
       displayFileDetails(files[0]);
   }
}

function displayFileDetails(file) {
   document.getElementById('fileName').value = file.name;
   document.getElementById('fileSize').value = formatFileSize(file.size);
   document.getElementById('fileType').value = file.type || 'text/csv';
   
   document.getElementById('fileDetails').classList.remove('hidden');
}

function formatFileSize(bytes) {
   if (bytes === 0) return '0 Bytes';
   const k = 1024;
   const sizes = ['Bytes', 'KB', 'MB', 'GB'];
   const i = Math.floor(Math.log(bytes) / Math.log(k));
   return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// ×”×¢×œ××ª ×§×•×‘×¥ CSV
async function uploadCSV() {
   const fileInput = document.getElementById('csvFile');
   const file = fileInput.files[0];
   
   if (!file) {
       showNotification('×× × ×‘×—×¨ ×§×•×‘×¥ CSV', 'warning');
       return;
   }
   
   const formData = new FormData();
   formData.append('csvFile', file);
   
   // ×”×¦×’×ª progress bar
   document.getElementById('uploadProgress').classList.remove('hidden');
   const progressBar = document.getElementById('progressBar');
   const progressText = document.getElementById('progressText');
   
   try {
       // ×©×™××•×© ×‘-XMLHttpRequest ×œ×¦×•×¨×š progress tracking
       const xhr = new XMLHttpRequest();
       
       xhr.upload.addEventListener('progress', (e) => {
           if (e.lengthComputable) {
               const percentComplete = (e.loaded / e.total) * 100;
               progressBar.style.width = percentComplete + '%';
               progressText.textContent = Math.round(percentComplete) + '%';
           }
       });
       
       xhr.addEventListener('load', () => {
           if (xhr.status === 200) {
               const response = JSON.parse(xhr.responseText);
               showNotification(`×”×•×¢×œ×• ×‘×”×¦×œ×—×” ${response.message}! ğŸ“„`, 'success');
               cancelUpload();
               loadUploadHistory();
           } else {
               const error = JSON.parse(xhr.responseText);
               showNotification(error.error || '×©×’×™××” ×‘×”×¢×œ××”', 'error');
           }
       });
       
       xhr.addEventListener('error', () => {
           showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×‘×”×¢×œ××”', 'error');
       });
       
       xhr.open('POST', '/api/admin/upload-csv');
       xhr.setRequestHeader('Authorization', `Bearer ${authToken}`);
       xhr.send(formData);
       
   } catch (error) {
       showNotification('×©×’×™××” ×‘×”×¢×œ××ª ×§×•×‘×¥', 'error');
       console.error('Upload error:', error);
   }
}

// ×‘×™×˜×•×œ ×”×¢×œ××”
function cancelUpload() {
   document.getElementById('fileDetails').classList.add('hidden');
   document.getElementById('uploadProgress').classList.add('hidden');
   document.getElementById('csvFile').value = '';
   document.getElementById('progressBar').style.width = '0%';
   document.getElementById('progressText').textContent = '0%';
}

// ×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×™×ª ×”×¢×œ××•×ª
async function loadUploadHistory() {
   try {
       const response = await fetch('/api/admin/upload-history', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const history = await response.json();
           displayUploadHistory(history);
       }
   } catch (error) {
       console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×™×ª ×”×¢×œ××•×ª:', error);
   }
}

function displayUploadHistory(history) {
   const tbody = document.getElementById('uploadHistoryBody');
   
   if (history.length === 0) {
       tbody.innerHTML = `
           <tr>
               <td colspan="7" class="text-center">
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ“š</div>
                       <h3>××™×Ÿ ×”×™×¡×˜×•×¨×™×™×ª ×”×¢×œ××•×ª</h3>
                   </div>
               </td>
           </tr>
       `;
       return;
   }
   
   tbody.innerHTML = history.map(item => `
       <tr>
           <td>${new Date(item.created_at).toLocaleDateString('he-IL')}</td>
           <td><strong>${item.file_name || '×œ× ×™×“×•×¢'}</strong></td>
           <td>${item.full_name || item.username}</td>
           <td><strong>${item.uploaded_count || 0}</strong></td>
           <td>${item.duplicates_count || 0}</td>
           <td>${item.errors_count || 0}</td>
           <td>
               <span class="badge ${item.errors_count > 0 ? 'badge-warning' : 'badge-success'}">
                   ${item.errors_count > 0 ? '×¢× ×©×’×™××•×ª' : '×”×•×©×œ×'}
               </span>
           </td>
       </tr>
   `).join('');
}

function extractNumberFromDetails(details, type) {
   if (!details) return '0';
   const regex = new RegExp(`(\\d+)\\s+${type}`, 'i');
   const match = details.match(regex);
   return match ? match[1] : '0';
}

// ×”×•×¨×“×ª ×ª×‘× ×™×ª CSV
async function downloadTemplate() {
   try {
       const response = await fetch('/api/admin/template/donors-csv', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const blob = await response.blob();
           const url = window.URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = 'donors_template.csv';
           document.body.appendChild(a);
           a.click();
           window.URL.revokeObjectURL(url);
           document.body.removeChild(a);
           showNotification('×ª×‘× ×™×ª CSV ×”×•×¨×“×” ×‘×”×¦×œ×—×”! ğŸ“‹', 'success');
       } else {
           showNotification('×©×’×™××” ×‘×”×•×¨×“×ª ×ª×‘× ×™×ª', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// ×‘×“×™×§×ª ××™×›×•×ª × ×ª×•× ×™×
async function showDataQuality() {
   try {
       const response = await fetch('/api/admin/data-quality', {
           method: 'POST',
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const data = await response.json();
           displayDataQualityModal(data);
       } else {
           showNotification('×©×’×™××” ×‘×‘×“×™×§×ª ××™×›×•×ª × ×ª×•× ×™×', 'error');
       }
   } catch (error) {
   showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

function displayDataQualityModal(data) {
   const modal = document.createElement('div');
   modal.className = 'modal show';
   modal.innerHTML = `
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ” ×‘×“×™×§×ª ××™×›×•×ª × ×ª×•× ×™×</h3>
               <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
           </div>
           <div>
               <div class="message info">
                   <span>ğŸ“Š ×ª×•×¦××•×ª ×‘×“×™×§×ª ××™×›×•×ª ×”× ×ª×•× ×™× ×‘××¢×¨×›×ª</span>
               </div>
               
               <div style="margin: 20px 0;">
                   <h4>ğŸ” ×‘×¢×™×•×ª ×©× ××¦××•:</h4>
                   
                   <div class="card" style="margin: 10px 0; padding: 15px;">
                       <h5>ğŸ‘¤ ×ª×•×¨××™× ×œ×œ× ×©×</h5>
                       <p><strong>${data['×ª×•×¨××™× ×œ×œ× ×©×'] || 0}</strong> ×ª×•×¨××™×</p>
                   </div>
                   
                   <div class="card" style="margin: 10px 0; padding: 15px;">
                       <h5>ğŸ“ ×ª×•×¨××™× ×œ×œ× ×˜×œ×¤×•×Ÿ</h5>
                       <p><strong>${data['×ª×•×¨××™× ×œ×œ× ×˜×œ×¤×•×Ÿ'] || 0}</strong> ×ª×•×¨××™×</p>
                   </div>
                   
                   <div class="card" style="margin: 10px 0; padding: 15px;">
                       <h5>ğŸ“§ ××™××™×™×œ×™× ×œ× ×ª×§×™× ×™×</h5>
                       <p><strong>${data['××™××™×™×œ×™× ×œ× ×ª×§×™× ×™×'] || 0}</strong> ×ª×•×¨××™×</p>
                   </div>
                   
                   <div class="card" style="margin: 10px 0; padding: 15px;">
                       <h5>ğŸ”„ ×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ</h5>
                       <p><strong>${Array.isArray(data['×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ']) ? data['×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ'].length : 0}</strong> ×§×‘×•×¦×•×ª ×›×¤×™×œ×•×ª</p>
                       ${Array.isArray(data['×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ']) && data['×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ'].length > 0 ? `
                           <details style="margin-top: 10px;">
                               <summary>×”×¦×’ ×›×¤×™×œ×•×™×•×ª</summary>
                               <ul style="margin-top: 10px;">
                                   ${data['×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ'].slice(0, 10).map(dup => 
                                       `<li>${dup.phone} - ${dup.count} ×¤×¢××™×</li>`
                                   ).join('')}
                                   ${data['×›×¤×™×œ×•×™×•×ª ×‘×˜×œ×¤×•×Ÿ'].length > 10 ? '<li>...×•×¢×•×“</li>' : ''}
                               </ul>
                           </details>
                       ` : ''}
                   </div>
               </div>
               
               <div style="text-align: center; margin-top: 25px;">
                   <button class="btn btn-warning" onclick="cleanupDuplicates(); this.closest('.modal').remove();">
                       ğŸ§¹ × ×§×” ×›×¤×™×œ×•×™×•×ª
                   </button>
                   <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                       âŒ ×¡×’×•×¨
                   </button>
               </div>
           </div>
       </div>
   `;
   document.body.appendChild(modal);
}

// × ×™×§×•×™ ×›×¤×™×œ×•×™×•×ª
async function cleanupDuplicates() {
   if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ× ×§×•×ª ×›×¤×™×œ×•×™×•×ª? ×¤×¢×•×œ×” ×–×• ×ª×©××•×¨ ×¨×§ ××ª ×”×¨×©×•××” ×”×—×“×©×” ×‘×™×•×ª×¨ ××›×œ ×§×‘×•×¦×”.')) {
       return;
   }
   
   try {
       const response = await fetch('/api/admin/cleanup-duplicates', {
           method: 'POST',
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       const data = await response.json();
       
       if (response.ok) {
           showNotification(`${data.removed} ×›×¤×™×œ×•×™×•×ª ×”×•×¡×¨×• ×‘×”×¦×œ×—×”! ğŸ§¹`, 'success');
           loadDonors(); // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
       } else {
           showNotification(data.error || '×©×’×™××” ×‘× ×™×§×•×™ ×›×¤×™×œ×•×™×•×ª', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// === ×¤×•× ×§×¦×™×•×ª ×œ×•×’×™ ××¢×¨×›×ª ===

// ×˜×¢×™× ×ª ×œ×•×’×™×
async function loadLogs() {
   try {
       showLoading('logsTableBody');
       
       const params = new URLSearchParams();
       const userFilter = document.getElementById('logUserFilter')?.value;
       const actionFilter = document.getElementById('logActionFilter')?.value;
       const fromDate = document.getElementById('logFromDate')?.value;
       const toDate = document.getElementById('logToDate')?.value;
       
       if (userFilter) params.append('user_id', userFilter);
       if (actionFilter) params.append('action', actionFilter);
       if (fromDate) params.append('from_date', fromDate);
       if (toDate) params.append('to_date', toDate);
       
       const response = await fetch(`/api/admin/logs?${params.toString()}`, {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const data = await response.json();
           displayLogs(data.logs);
           updateLogsPagination(data);
       } else {
           throw new Error('×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×’×™×');
       }
   } catch (error) {
       console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×’×™×:', error);
       document.getElementById('logsTableBody').innerHTML = 
           '<tr><td colspan="7" class="text-center">×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×</td></tr>';
   }
}

function displayLogs(logs) {
   const tbody = document.getElementById('logsTableBody');
   
   if (logs.length === 0) {
       tbody.innerHTML = `
           <tr>
               <td colspan="7" class="text-center">
                   <div class="empty-state">
                       <div class="empty-state-icon">ğŸ“‹</div>
                       <h3>××™×Ÿ ×œ×•×’×™× ×œ×”×¦×’×”</h3>
                       <p>× ×¡×” ×œ×©× ×•×ª ××ª ×”×¡×™× ×•× ×™×</p>
                   </div>
               </td>
           </tr>
       `;
       return;
   }
   
   tbody.innerHTML = logs.map(log => `
       <tr>
           <td>${new Date(log.created_at).toLocaleString('he-IL')}</td>
           <td>${log.full_name || log.username || '×œ× ×™×“×•×¢'}</td>
           <td>
               <span class="badge ${getActionBadge(log.action)}">
                   ${getActivityText(log.action)}
               </span>
           </td>
           <td>${log.target_type || ''}</td>
           <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
               ${log.details || ''}
           </td>
           <td>${log.ip_address || ''}</td>
           <td style="max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
               ${log.user_agent ? log.user_agent.split(' ')[0] : ''}
           </td>
       </tr>
   `).join('');
}

function getActionBadge(action) {
   const badgeMap = {
       'LOGIN_SUCCESS': 'badge-success',
       'LOGIN_FAILED': 'badge-danger',
       'SEARCH': 'badge-info',
       'CREATE_DONOR': 'badge-success',
       'UPDATE_DONOR': 'badge-warning',
       'DELETE_DONOR': 'badge-danger',
       'CSV_UPLOAD': 'badge-success',
       'CREATE_USER': 'badge-success',
       'UPDATE_USER': 'badge-warning',
       'DELETE_USER': 'badge-danger'
   };
   return badgeMap[action] || 'badge-secondary';
}

function updateLogsPagination(data) {
   // ×¢×“×›×•×Ÿ ×¢××•×“×•× ×™× ×œ×œ×•×’×™×
   updatePagination('logsPagination', data.total);
}

// ×¡×™× ×•×Ÿ ×œ×•×’×™×
function filterLogs() {
   loadLogs();
}

// × ×™×§×•×™ ×œ×•×’×™× ×™×©× ×™×
async function clearOldLogs() {
   const days = prompt('××—×§ ×œ×•×’×™× ×”×™×©× ×™× ××›××” ×™××™×? (×‘×¨×™×¨×ª ××—×“×œ: 90)');
   const daysOld = parseInt(days) || 90;
   
   if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×œ×•×’×™× ×”×™×©× ×™× ×-${daysOld} ×™××™×?`)) {
       return;
   }
   
   try {
       const response = await fetch('/api/admin/logs/cleanup', {
           method: 'DELETE',
           headers: {
               'Content-Type': 'application/json',
               'Authorization': `Bearer ${authToken}`
           },
           body: JSON.stringify({ days_old: daysOld })
       });
       
       const data = await response.json();
       
       if (response.ok) {
           showNotification(`${data.deleted} ×¨×©×•××•×ª ×œ×•×’ × ×•×§×• ×‘×”×¦×œ×—×”! ğŸ—‘ï¸`, 'success');
           loadLogs();
       } else {
           showNotification(data.error || '×©×’×™××” ×‘× ×™×§×•×™ ×œ×•×’×™×', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// ×™×™×¦×•× ×œ×•×’×™×
async function exportLogs() {
   try {
       const params = new URLSearchParams();
       const userFilter = document.getElementById('logUserFilter')?.value;
       const actionFilter = document.getElementById('logActionFilter')?.value;
       const fromDate = document.getElementById('logFromDate')?.value;
       const toDate = document.getElementById('logToDate')?.value;
       
       if (userFilter) params.append('user_id', userFilter);
       if (actionFilter) params.append('action', actionFilter);
       if (fromDate) params.append('from_date', fromDate);
       if (toDate) params.append('to_date', toDate);
       
       const response = await fetch(`/api/admin/export/logs?${params.toString()}`, {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const blob = await response.blob();
           const url = window.URL.createObjectURL(blob);
           const a = document.createElement('a');
           a.href = url;
           a.download = 'system_logs_export.csv';
           document.body.appendChild(a);
           a.click();
           window.URL.revokeObjectURL(url);
           document.body.removeChild(a);
           showNotification('×œ×•×’×™× ×™×•×¦××• ×‘×”×¦×œ×—×”! ğŸ“‹', 'success');
       } else {
           showNotification('×©×’×™××” ×‘×™×™×¦×•× ×œ×•×’×™×', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// === ×¤×•× ×§×¦×™×•×ª ××¢×¨×›×ª ×›×œ×œ×™×•×ª ===

// ×¨×¢× ×•×Ÿ ×¤×¢×™×œ×•×ª
function refreshActivity() {
   loadRecentActivity();
   showNotification('×¤×¢×™×œ×•×ª ×¨×•×¢× ×”! ğŸ”„', 'info');
}

// ×”×’×“×¨×•×ª ××¢×¨×›×ª
function showSystemSettings() {
   const modal = document.createElement('div');
   modal.className = 'modal show';
   modal.innerHTML = `
       <div class="modal-content">
           <div class="modal-header">
               <h3>âš™ï¸ ×”×’×“×¨×•×ª ××¢×¨×›×ª</h3>
               <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
           </div>
           <div>
               <div class="message info">
                   <span>ğŸ”§ ×”×’×“×¨×•×ª ××¢×¨×›×ª ×•×ª×—×–×•×§×”</span>
               </div>
               
               <div class="form-group">
                   <label>ğŸ—‘ï¸ × ×™×§×•×™ × ×ª×•× ×™×:</label>
                   <div style="margin: 10px 0;">
                       <button class="btn btn-warning" onclick="clearOldLogs(); this.closest('.modal').remove();">
                           ğŸ“‹ × ×§×” ×œ×•×’×™× ×™×©× ×™×
                       </button>
                       <button class="btn btn-warning" onclick="cleanupDuplicates(); this.closest('.modal').remove();">
                           ğŸ”„ × ×§×” ×›×¤×™×œ×•×™×•×ª
                       </button>
                   </div>
               </div>
               
               <div class="form-group">
                   <label>ğŸ’¾ ×’×™×‘×•×™ ×•×©×—×–×•×¨:</label>
                   <div style="margin: 10px 0;">
                       <button class="btn btn-info" onclick="createBackup(); this.closest('.modal').remove();">
                           ğŸ’¾ ×¦×•×¨ ×’×™×‘×•×™
                       </button>
                       <button class="btn btn-success" onclick="checkSystemHealth(); this.closest('.modal').remove();">
                           ğŸ¥ ×‘×“×•×§ ×ª×§×™× ×•×ª ××¢×¨×›×ª
                       </button>
                   </div>
               </div>
               
               <div class="form-group">
                   <label>ğŸ“Š ×™×™×¦×•× × ×ª×•× ×™×:</label>
                   <div style="margin: 10px 0;">
                       <button class="btn btn-secondary" onclick="exportDonors();">
                           ğŸ‘¥ ×™×™×¦× ×ª×•×¨××™×
                       </button>
                       <button class="btn btn-secondary" onclick="exportReports();">
                           ğŸ“ˆ ×™×™×¦× ×“×•×—×•×ª
                       </button>
                       <button class="btn btn-secondary" onclick="exportLogs();">
                           ğŸ“‹ ×™×™×¦× ×œ×•×’×™×
                       </button>
                   </div>
               </div>
           </div>
       </div>
   `;
   document.body.appendChild(modal);
}

// ×™×¦×™×¨×ª ×’×™×‘×•×™
async function createBackup() {
   try {
       const response = await fetch('/api/admin/backup', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       const data = await response.json();
       
       if (response.ok) {
           showNotification(`×’×™×‘×•×™ × ×•×¦×¨ ×‘×”×¦×œ×—×”! ğŸ’¾\n× ×©××¨ ×‘: ${data.backupPath}`, 'success');
       } else {
           showNotification(data.error || '×©×’×™××” ×‘×™×¦×™×¨×ª ×’×™×‘×•×™', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

// ×‘×“×™×§×ª ×ª×§×™× ×•×ª ××¢×¨×›×ª
async function checkSystemHealth() {
   try {
       const response = await fetch('/api/admin/system-health', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (response.ok) {
           const data = await response.json();
           displaySystemHealthModal(data);
       } else {
           showNotification('×©×’×™××” ×‘×‘×“×™×§×ª ×ª×§×™× ×•×ª', 'error');
       }
   } catch (error) {
       showNotification('×©×’×™××ª ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª', 'error');
   }
}

function displaySystemHealthModal(data) {
   const modal = document.createElement('div');
   modal.className = 'modal show';
   modal.innerHTML = `
       <div class="modal-content">
           <div class="modal-header">
               <h3>ğŸ¥ ×‘×“×™×§×ª ×ª×§×™× ×•×ª ××¢×¨×›×ª</h3>
               <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
           </div>
           <div>
               <div class="message ${data.overallStatus === 'HEALTHY' ? 'success' : data.overallStatus === 'WARNING' ? 'warning' : 'error'}">
                   <span>ğŸ“Š ×¡×˜×˜×•×¡ ×›×œ×œ×™: <strong>${getHealthStatusText(data.overallStatus)}</strong></span>
               </div>
               
               <div style="margin: 20px 0;">
                   <h4>ğŸ” ×‘×“×™×§×•×ª ××¢×¨×›×ª:</h4>
                   
                   ${data.checks.map(check => `
                       <div class="card" style="margin: 10px 0; padding: 15px;">
                           <div style="display: flex; justify-content: space-between; align-items: center;">
                               <h5>${check.component}</h5>
                               <span class="badge ${getHealthBadge(check.status)}">
                                   ${check.status}
                               </span>
                           </div>
                           <p style="margin: 5px 0 0 0;">${check.message}</p>
                       </div>
                   `).join('')}
               </div>
               
               <div style="text-align: center; margin-top: 25px;">
                   <small class="text-muted">
                       ğŸ“… × ×‘×“×§ ×‘: ${new Date(data.timestamp).toLocaleString('he-IL')}
                   </small>
               </div>
           </div>
       </div>
   `;
   document.body.appendChild(modal);
}

function getHealthStatusText(status) {
   const statusMap = {
       'HEALTHY': '×ª×§×™×Ÿ âœ…',
       'WARNING': '××–×”×¨×” âš ï¸',
       'UNHEALTHY': '×œ× ×ª×§×™×Ÿ âŒ'
   };
   return statusMap[status] || status;
}

function getHealthBadge(status) {
   const badgeMap = {
       'OK': 'badge-success',
       'WARNING': 'badge-warning',
       'ERROR': 'badge-danger'
   };
   return badgeMap[status] || 'badge-secondary';
}

// ×¡×§×™×¨×ª ×›×¨×˜×™×¡×™×
function showTicketsOverview() {
   showTab('tickets');
}

// ×‘×“×™×§×ª ×ª×§×™× ×•×ª ××¢×¨×›×ª ××”×™×¨
function showSystemHealth() {
   checkSystemHealth();
}

// ×™×™×¦×•× × ×ª×•× ×™ ××¢×¨×›×ª
function exportSystemData() {
   showSystemSettings();
}

// === ×¢×–×¨×™× × ×•×¡×¤×™× ===

// ×”×•×“×¢×” ×œ×¢×“×›×•×Ÿ ×–××Ÿ ×××ª
setInterval(() => {
   // ×¢×“×›×•×Ÿ ×–××Ÿ ×××ª ×©×œ × ×ª×•× ×™× ×‘×œ×•×— ×”×‘×§×¨×” ×× ×× ×—× ×• ×‘×œ×©×•× ×™×ª dashboard
   const activeTab = document.querySelector('.nav-tab.active');
   if (activeTab && activeTab.textContent.includes('×œ×•×— ×‘×§×¨×”')) {
       loadDashboardData();
   }
}, 300000); // ×›×œ 5 ×“×§×•×ª

// ×”×•×¡×¤×ª ×§×™×¦×•×¨×™ ××§×œ×“×ª
document.addEventListener('keydown', function(e) {
   // Ctrl/Cmd + Shift + N = ××©×ª××© ×—×“×©
   if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'N') {
       e.preventDefault();
       showAddUserModal();
   }
   
   // Ctrl/Cmd + Shift + D = ×ª×•×¨× ×—×“×©
   if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'D') {
       e.preventDefault();
       showAddDonorModal();
   }
   
   // Ctrl/Cmd + Shift + M = ×”×•×“×¢×” ×—×“×©×”
   if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'M') {
       e.preventDefault();
       showCreateMessageModal();
   }
   
   // Escape = ×¡×’×™×¨×ª ××•×“×œ×™×
   if (e.key === 'Escape') {
       const openModals = document.querySelectorAll('.modal.show');
       openModals.forEach(modal => {
           modal.classList.remove('show');
           document.body.style.overflow = 'auto';
       });
   }
});

// ×‘×“×™×§×ª ×—×™×‘×•×¨ ×ª×§×•×¤×ª×™×ª
setInterval(async () => {
   try {
       const response = await fetch('/api/admin/dashboard', {
           headers: { 'Authorization': `Bearer ${authToken}` }
       });
       
       if (!response.ok) {
           if (response.status === 401 || response.status === 403) {
               showNotification('×”×—×™×‘×•×¨ ×¤×’ ×ª×•×§×£ - ××¤× ×” ×œ×“×£ ×”×ª×—×‘×¨×•×ª', 'warning');
               setTimeout(() => logout(), 2000);
           }
       }
   } catch (error) {
       console.warn('âš ï¸ ×‘×¢×™×™×ª ×—×™×‘×•×¨ ×–×× ×™×ª ×œ×©×¨×ª');
   }
}, 300000); // ×›×œ 5 ×“×§×•×ª

// ×¤×•× ×§×¦×™×” ×œ×¡×™× ×›×¨×•×Ÿ ×™×“× ×™
async function manualAirtableSync() {
    const button = document.getElementById('syncButton');
    const status = document.getElementById('syncStatus');
    
    // ×”×©×‘×ª×ª ×›×¤×ª×•×¨ ×•××¦×‘ ×˜×¢×™× ×”
    button.disabled = true;
    button.innerHTML = 'ğŸ”„ ××¡× ×›×¨×Ÿ...';
    status.innerHTML = '<div class="message info">ğŸ”„ ××ª×—×™×œ ×¡×™× ×›×¨×•×Ÿ ×¢× Airtable...</div>';
    
    try {
        const response = await fetch('/api/admin/sync-airtable', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
            status.innerHTML = `
                <div class="message success">
                    <h4>âœ… ×¡×™× ×›×¨×•×Ÿ ×”×•×©×œ× ×‘×”×¦×œ×—×”!</h4>
                    <ul>
                        <li>ğŸ“Š ×¡×”"×› ×¢×•×‘×“×•: ${data.details.totalProcessed} ×¨×©×•××•×ª</li>
                        <li>ğŸ†• ×—×“×©×™×: ${data.details.newRecords}</li>
                        <li>âœï¸ ×¢×•×“×›× ×•: ${data.details.updatedRecords}</li>
                        <li>â¡ï¸ ×œ×œ× ×©×™× ×•×™: ${data.details.unchangedRecords}</li>
                        <li>âŒ ×©×’×™××•×ª: ${data.details.errors}</li>
                    </ul>
                </div>
            `;
            
            // ×¨×¢× ×•×Ÿ ×“×£ ×”×ª×•×¨××™× ×× ×¤×ª×•×—
            if (window.loadDonors) {
                setTimeout(() => loadDonors(), 1000);
            }
        } else {
            status.innerHTML = `
                <div class="message error">
                    <h4>âŒ ×©×’×™××” ×‘×¡×™× ×›×¨×•×Ÿ</h4>
                    <p>${data.error}</p>
                    <small>${data.details || ''}</small>
                </div>
            `;
        }
    } catch (error) {
        status.innerHTML = `
            <div class="message error">
                <h4>âŒ ×©×’×™××ª ×ª×§×©×•×¨×ª</h4>
                <p>×œ× × ×™×ª×Ÿ ×œ×”×ª×—×‘×¨ ×œ×©×¨×ª</p>
            </div>
        `;
    } finally {
        // ×”×—×–×¨×ª ×›×¤×ª×•×¨ ×œ××¦×‘ ×¨×’×™×œ
        button.disabled = false;
        button.innerHTML = 'ğŸ”„ ×¢×“×›×Ÿ ×ª×•×¨××™× ×-Airtable ×¢×›×©×™×•';
    }
}

console.log('âœ… ×›×œ ×”×¤×•× ×§×¦×™×•×ª × ×•×¡×¤×• ×œ×¤×× ×œ ×”××“××™×Ÿ ×‘×”×¦×œ×—×”!');
   </script>
</body>
</html>